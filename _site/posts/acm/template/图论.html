<!DOCTYPE html>

<head>
  <title>
    图论 &middot; wu-kan
  </title>
  
  <meta name="viewport"  content="width=device-width, initial-scale=1.0, maximum-scale=1"  />
  
  <meta http-equiv="X-UA-Compatible"  content="IE=edge"  />
  
  <meta http-equiv="content-type"  content="text/html; charset=utf-8"  />
  
  <meta name="google-site-verification"  content="YIKi1rBnyUaS-DMYiluseI5kZzTwjCkTFmKkSkMZDJk"  />
  
  <meta name="baidu-site-verification"  content="bEFDJ1LvXb"  />
  
  <meta name="yandex-verification"  content="52253e02830b443c"  />
  
  <link rel="profile"  href="//gmpg.org/xfn/11"  />
  
  <link rel="alternate"  href="/atom.xml"  title="RSS"  type="application/rss+xml"  />
  
  <link rel="apple-touch-icon-precomposed"  href="//www.gravatar.com/avatar/a12c5fff23dde00df79af9aca4e7b6e4?d=wavatar&s=144"  />
  
  <link rel="shortcut icon"  href="//www.gravatar.com/avatar/a12c5fff23dde00df79af9aca4e7b6e4?d=wavatar&s=32"  />
  
  <link rel="stylesheet"  href="//cdn.jsdelivr.net/gh/wu-kan/wu-kan.github.io/public/css/poole.css"  />
  
  <link rel="stylesheet"  href="//cdn.jsdelivr.net/gh/wu-kan/wu-kan.github.io/public/css/syntax.css"  />
  
  <link rel="stylesheet"  href="//cdn.jsdelivr.net/gh/wu-kan/wu-kan.github.io/public/css/lanyon.css"  />
  
  <link rel="stylesheet"  href="/public/css/wu-kan.css"  />
  
  <link rel="stylesheet"  href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.css"  />
  
</head>

<body
  class="theme-base-0d layout-reverse sidebar-overlay">
  
  <script  src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js" >
  </script>
  
  <script  src="//cdn.jsdelivr.net/npm/ribbon.js/dist/ribbon.min.js" >
  </script>
  
  <script  src="//cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget/autoload.js" >
  </script>
  
  <script  src="/public/js/prism.js" >
  </script>
  
  <script  src="/public/js/mermaid.js"  js="//cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"  stylesheet="//cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.css"  markdown_expand="true" >
  </script>
  
  <script  src="/public/js/katex.js"  js="//cdn.jsdelivr.net/npm/katex/dist/katex.min.js"  auto_render="//cdn.jsdelivr.net/npm/katex/dist/contrib/auto-render.min.js"  stylesheet="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css"  delimiters="true" >
  </script>
  
  <script  src="/public/js/baidu_push.js" >
  </script>
  
  <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
  <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox" />
  <!-- Toggleable sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-item">
      
      <div class="ih-item circle effect right_to_left">
        <a class="blog-button" title="WuK">
          <img class="img" src="//www.gravatar.com/avatar/a12c5fff23dde00df79af9aca4e7b6e4?d=wavatar&s=600" alt="img" />
          <small class="info info-back">
            <br/>SYSU17级在读<br/>计科超算方向<br/>永远喜欢水野爱<br/>田宫例四驱车<br/>ACM&ASC
          </small>
        </a>
      </div>
      
      <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=100% height=52 src="//music.163.com/outchain/player?type=0&id=155059595&auto=0&height=32"></iframe>
      <div class="sidebar-social">
        
        <a href="/atom.xml" title="rss">
          <i class="fas fa-rss fa-fw"></i>
        </a>
        
        <a href="mailto:wu.kan@foxmail.com" title="wu.kan@foxmail.com">
          <i class="fas fa-envelope fa-fw"></i>
        </a>
        
        <a href="//codeforces.com/profile/WuK" title="WuK">
          <i class="fas fa-chart-bar fw"></i>
        </a>
        
        <a href="//vjudge.net/user/WuK" title="WuK">
          <i class="fas fa-smile fa-fw"></i>
        </a>
        
        <a href="" title="942759535">
          <i class="fab fa-qq fa-fw"></i>
        </a>
        
        <a href="" title="Wu-_-Kan">
          <i class="fab fa-weixin fa-fw"></i>
        </a>
        
        <a href="//github.com/wu-kan" title="github">
          <i class="fab fa-github fa-fw"></i>
        </a>
        
        <a href="//www.zhihu.com/people/wu.kan/activities" title="zhihu">
          <i class="fab fa-zhihu fa-fw"></i>
        </a>
        
      </div>
    </div>
    <nav class="sidebar-nav">
      
      <a class="sidebar-nav-item" href="/">
        <i class="fas fa-home fa-fw"></i> 首页
      </a>
      
      <a class="sidebar-nav-item" href="/about">
        <i class="fab fa-readme fa-fw"></i> 关于
      </a>
      
      <a class="sidebar-nav-item" href="/comments">
        <i class="fas fa-comments fa-fw"></i> 留言
      </a>
      
      <a class="sidebar-nav-item" href="/tags">
        <i class="fas fa-tags fa-fw"></i> 标签
      </a>
      
      <a class="sidebar-nav-item" href="/archive">
        <i class="fas fa-archive fa-fw"></i> 归档
      </a>
      
    </nav>
    <div class="sidebar-item">
      
      <div>
        <script src="/public/simple-jekyll-search/autoloader.js"></script>
      </div>
      
      
      <div>
        <script src="/public/js/jekyll_table_of_contents.js"></script>
      </div>
      
      
      <div>
        <script src="/public/js/run_time.js"></script>
      </div>
      
      
      <div>
        <i class="fas fa-eye fa-fw"></i>
        <span id="busuanzi_value_page_pv"></span>次
      </div>
      <div>
        <i class="fas fa-paw fa-fw"></i>
        <span id="busuanzi_value_site_pv"></span>枚
      </div>
      <div>
        <i class="fas fa-user-friends fa-fw"></i>
        <span id="busuanzi_value_site_uv"></span>人
      </div>
      <script src="//cdn.jsdelivr.net/npm/busuanzi/bsz.pure.mini.js"></script>
      
      
      <div>
        <i class="fas fa-user-edit fa-fw"></i>
        2019-11-09 17:38:24
      </div>
      
      
      <div>
        <i class="fas fa-copyright fa-fw"></i>
        2019
        WuK
        <script async defer src="https://buttons.github.io/buttons.js"></script><a class="github-button" aria-label="Star wu-kan/wu-kan.github.io on GitHub" href="https://github.com/wu-kan/wu-kan.github.io" data-icon="octicon-star" data-show-count="true">Star</a>
      </div>
      
    </div>
  </div>
  <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
  <div class="wrap">
    <h1 class="masthead masthead-title">
      <div class="container">
        图论
        <a href="/">
          <small>wu-kan</small>
        </a>
      </div>
    </h1>
    <div class="container content">
      <div class="post">
  
  <small class="post-date">
    
    <i class="fas fa-calendar-day"></i>
    02 Feb 2019
    
    
    <i class="fas fa-file-word"></i>
    20692字
    
    
    <i class="fas fa-coffee"></i>
    69分
    
    
    <span id="/posts/acm/template/%E5%9B%BE%E8%AE%BA" class="leancloud-visitors" data-flag-title="图论">
      <i class="far fa-eye"></i>
      <span class="leancloud-visitors-count"></span>次
    </span>
    
    
    <i class="fas fa-tag"></i>
    ICPC模板
    
    </br>
    <i class="fab fa-creative-commons"></i> <a rel="license" href="//creativecommons.org/licenses/by-sa/4.0/deed.zh">BY-SA 4.0</a>（除特别声明或转载文章外）
  </small>
  
  
  <div class="post-content">
    <p>这里用类似邻接表的方法存图。有的算法可能需要邻接矩阵，详见线性代数部分。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">Vertex</span>
	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">o</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>		<span class="c1">//相关出边和入边编号
</span>		<span class="kt">int</span> <span class="n">siz</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">dfn</span><span class="p">;</span> <span class="c1">//树链剖分中使用，依次代表子树节点数、深度、所在链的顶端节点、dfs序
</span>	<span class="p">};</span>
	<span class="k">struct</span> <span class="n">Edge</span> <span class="o">:</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span>
	<span class="p">{</span>
		<span class="n">ll</span> <span class="n">len</span><span class="p">,</span> <span class="n">cap</span><span class="p">;</span> <span class="c1">//边长、容量，图论算法使用
</span>	<span class="p">};</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Vertex</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span> <span class="c1">//点集
</span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="n">e</span><span class="p">;</span>   <span class="c1">//边集
</span>	<span class="n">Graph</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">v</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="k">const</span> <span class="n">Edge</span> <span class="o">&amp;</span><span class="n">ed</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ed</span><span class="p">.</span><span class="n">first</span> <span class="o">==</span> <span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">)</span>
			<span class="k">return</span><span class="p">;</span> <span class="c1">//如果有需要请拆点
</span>		<span class="n">v</span><span class="p">[</span><span class="n">ed</span><span class="p">.</span><span class="n">first</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">v</span><span class="p">[</span><span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">].</span><span class="n">i</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">e</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">ch</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">e</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">]].</span><span class="n">second</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//u的第i个孩子节点
</span>	<span class="kt">int</span> <span class="n">fa</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">e</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">i</span><span class="p">[</span><span class="n">i</span><span class="p">]].</span><span class="n">first</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//u的第i个父节点
</span><span class="p">};</span>
</code></pre></div></div>

<h2 id="最短路">最短路</h2>

<h3 id="dijkstra算法">Dijkstra算法</h3>

<p><a href="https://vjudge.net/solution/19427495">使用示例</a>，适用于边权为正的情况（无论有向图还是无向图），用于求单源最短路。</p>

<p>直接给出其优先队列优化的版本。另外，由于<code class="highlighter-rouge">priority_queue</code>并不提供修改优先级的操作，为避免重复扩展，这里选择将新元素直接插入队列并在运行时判断该点是否被处理，并不影响结果的正确性。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Dijkstra</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">d</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">;</span>
	<span class="n">Dijkstra</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">d</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">INF</span><span class="p">);</span>
		<span class="n">p</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">ll</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">q</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">make_pair</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="p">));</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">();)</span>
		<span class="p">{</span>
			<span class="n">ll</span> <span class="n">dis</span> <span class="o">=</span> <span class="o">-</span><span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">first</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">second</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">pop</span><span class="p">(),</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dis</span><span class="p">)</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span>
					<span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
					<span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">make_pair</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">],</span> <span class="n">to</span><span class="p">));</span>
				<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="bellmanford算法">BellmanFord算法</h3>

<p><a href="https://vjudge.net/solution/16970652">使用示例</a>，直接给出其队列优化、国内称之为SPFA算法的版本。较之Dijkstra算法，此算法不够快速稳定但是可以允许负边存在，当s到达负权回路时会直接返回0。稀疏图上性能优秀。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">BellmanFord</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">d</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">;</span>
	<span class="n">BellmanFord</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">bool</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">d</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">INF</span><span class="p">);</span>
		<span class="n">p</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">cnt</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">flag</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">d</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">deque</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">flag</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span> <span class="n">q</span><span class="p">.</span><span class="n">pop_front</span><span class="p">())</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">front</span><span class="p">(),</span> <span class="n">i</span> <span class="o">=</span> <span class="n">flag</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span>
					<span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">flag</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
					<span class="p">{</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="o">++</span><span class="n">cnt</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
							<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
						<span class="n">flag</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">to</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">}</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h4 id="差分约束系统">差分约束系统</h4>

<p>按如下方式建图、跑SPFA：</p>

<p>对每个不等式$x_i−x_j\leq d$，从$j$向$i$连一条边，边长为$d$。</p>

<p>若不等号的方向相反，即$x_i−x_j\geq d$，则在不等式两边同时乘以$-1$，变成$x_j−x_i\leq -d$，即从$i$到$j$连一条边，边长为$d$。</p>

<h3 id="floyed求多源最短路">Floyed求多源最短路</h3>

<p>不连通的权置INF。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">floyed</span><span class="p">(</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="c1">// 其实一般手打即可，没必要套这个鬼模板…
</span><span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
					<span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="astar求k短路">Astar求k短路</h3>

<p><a href="https://vjudge.net/solution/16970766">使用示例</a>，在这个比较坑的例子中需要在调用前补一句<code class="highlighter-rouge">if(s==t)++k;</code>。<strong>k下标从0开始，即最短路==第0短路</strong>。</p>

<p>朴素的想法是使用<code class="highlighter-rouge">priority_queue</code>从原点出发向外探索，当取出终点t第k次时就得到第k短路，类似bfs的思想，缺陷是越往后状态数越多。</p>

<p>我们在反向图上从$t\to s$跑Astar算法，通过优先展开到s近的状态，使搜索方向靠近答案，而不是一层一层全都展开，估价函数$f\approx g+h$，f是估计的s到t的距离，g是到达当前点已经点的花费，h是预计剩下的花费。这里h取当前点的距离到s距离，可通过从s跑一遍Dijkstra可以预处理得出。</p>

<p>Astar算法是只有到达终点的时候才能统计答案，这导致可能拓展很多个状态才能得到一个用来更新答案的有效状态。例如一个n元环，当我们到达终点之后,可能还要拓展n次才能得到下一个状态，于是时间复杂度就被卡到$O(nk)$。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Astar</span> <span class="o">:</span> <span class="n">Dijkstra</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">ans</span><span class="p">;</span>
	<span class="n">Astar</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Dijkstra</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Dijkstra</span><span class="o">::</span><span class="n">ask</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
		<span class="n">ans</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">INF</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">INF</span><span class="p">)</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">cnt</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">ll</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">q</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">make_pair</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">t</span><span class="p">));</span> <span class="n">cnt</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">k</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">();)</span>
		<span class="p">{</span>
			<span class="n">ll</span> <span class="n">dis</span> <span class="o">=</span> <span class="o">-</span><span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">first</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">second</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">u</span> <span class="o">==</span> <span class="n">s</span><span class="p">)</span>
				<span class="n">ans</span><span class="p">[</span><span class="n">cnt</span><span class="p">[</span><span class="n">s</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dis</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">pop</span><span class="p">(),</span> <span class="o">++</span><span class="n">cnt</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">)</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">i</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">i</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">make_pair</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">first</span><span class="p">]</span> <span class="o">-</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span> <span class="o">-</span> <span class="n">dis</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">first</span><span class="p">));</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="网络流">网络流</h2>

<h3 id="isap求最大流">ISAP求最大流</h3>

<p><a href="https://vjudge.net/solution/16970964">使用示例</a></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">ISAP</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">flow</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">f</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">h</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">gap</span><span class="p">;</span>
	<span class="n">ISAP</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="n">Edge</span> <span class="n">ed</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">ed</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">),</span> <span class="n">ed</span><span class="p">.</span><span class="n">cap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">,</span> <span class="n">ll</span> <span class="n">r</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">u</span> <span class="o">==</span> <span class="n">t</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
		<span class="n">ll</span> <span class="n">_f</span><span class="p">,</span> <span class="n">_r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">i</span> <span class="o">=</span> <span class="n">cur</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">h</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">==</span> <span class="n">h</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">_f</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">min</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">_r</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">cap</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">]));</span>
				<span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">_r</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">_r</span> <span class="o">==</span> <span class="n">r</span> <span class="o">||</span> <span class="n">h</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
					<span class="k">return</span> <span class="n">_r</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!--</span><span class="n">gap</span><span class="p">[</span><span class="n">h</span><span class="p">[</span><span class="n">u</span><span class="p">]])</span>
			<span class="n">h</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
		<span class="k">return</span> <span class="o">++</span><span class="n">gap</span><span class="p">[</span><span class="o">++</span><span class="n">h</span><span class="p">[</span><span class="n">u</span><span class="p">]],</span> <span class="n">cur</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">_r</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">h</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">cur</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">gap</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="cm">/*
		for (deque&lt;int&gt; q(h[t] = gap[t] = 1, t); !q.empty(); q.pop_front()) //优化，加了能快一点
			for (int i = 0, u = q.front(), k, to; i &lt; v[u].o.size(); ++i)
				if (to = e[v[u].o[i]].second, !h[to])
					++gap[h[to] = h[u] + 1], q.push_back(to);
		*/</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">flow</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span> <span class="n">h</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();)</span>
			<span class="n">flow</span> <span class="o">+=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">INF</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="primaldual求费用流">PrimalDual求费用流</h3>

<p><a href="https://vjudge.net/solution/16971249">使用示例</a>，定义一条边的费用为流量*边长，求总费用最小的最大流。性能优秀，只能跑非负权图。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">PrimalDual</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">flow</span><span class="p">,</span> <span class="n">cost</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">f</span><span class="p">;</span>
	<span class="n">PrimalDual</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="n">Edge</span> <span class="n">ed</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">ed</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">),</span> <span class="n">ed</span><span class="p">.</span><span class="n">cap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">len</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">)</span> <span class="c1">//询问s到t的最小费用最大流，答案存在flow、cost中
</span>	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">d</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">INF</span><span class="p">),</span> <span class="n">h</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">flow</span> <span class="o">=</span> <span class="n">cost</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);;)</span>
		<span class="p">{</span>
			<span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">ll</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">q</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">make_pair</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="p">));</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">();)</span>
			<span class="p">{</span>
				<span class="n">ll</span> <span class="n">dis</span> <span class="o">=</span> <span class="o">-</span><span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">first</span><span class="p">;</span>
				<span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">second</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">pop</span><span class="p">(),</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dis</span><span class="p">)</span>
					<span class="k">continue</span><span class="p">;</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span>
						<span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">cap</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
					<span class="p">{</span>
						<span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="p">[</span><span class="n">to</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
						<span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">make_pair</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">],</span> <span class="n">to</span><span class="p">));</span>
					<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">INF</span><span class="p">)</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">INF</span><span class="p">)</span>
					<span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
			<span class="n">ll</span> <span class="n">_f</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">s</span><span class="p">;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">first</span><span class="p">)</span>
				<span class="n">_f</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">_f</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">cap</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]]);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">s</span><span class="p">;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">first</span><span class="p">)</span>
				<span class="n">cost</span> <span class="o">+=</span> <span class="n">_f</span> <span class="o">*</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">len</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_f</span><span class="p">;</span>
			<span class="n">flow</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="ek求费用流">EK求费用流</h3>

<p><a href="https://vjudge.net/solution/16971149">使用示例</a>，定义一条边的费用为流量*边长，求总费用最小的最大流。BellmanFord算法找增广路，可能被卡但是可以跑负费用流（最大费用流）。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">EdmondKarp</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">flow</span><span class="p">,</span> <span class="n">cost</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">f</span><span class="p">;</span>
	<span class="n">EdmondKarp</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="n">Edge</span> <span class="n">ed</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">ed</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">),</span> <span class="n">ed</span><span class="p">.</span><span class="n">cap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">len</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">flow</span> <span class="o">=</span> <span class="n">cost</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);;)</span>
		<span class="p">{</span>
			<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">d</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">INF</span><span class="p">);</span>
			<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">flag</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">d</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">deque</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span> <span class="n">q</span><span class="p">.</span><span class="n">pop_front</span><span class="p">())</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">front</span><span class="p">(),</span> <span class="n">i</span> <span class="o">=</span> <span class="n">flag</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span>
						<span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">cap</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
						<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">flag</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
							<span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">to</span><span class="p">),</span> <span class="n">flag</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
					<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">INF</span><span class="p">)</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="n">ll</span> <span class="n">_f</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">s</span><span class="p">;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">first</span><span class="p">)</span>
				<span class="n">_f</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">_f</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">cap</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]]);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">s</span><span class="p">;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">first</span><span class="p">)</span>
				<span class="n">cost</span> <span class="o">+=</span> <span class="n">_f</span> <span class="o">*</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">len</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_f</span><span class="p">;</span>
			<span class="n">flow</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="zkw求费用流">ZKW求费用流</h3>

<p><a href="https://vjudge.net/solution/16971099">使用示例</a>，定义一条边的费用为流量*边长，求总费用最小的最大流。</p>

<p>对于最终流量较大，而费用取值范围不大的图，或者是增广路径比较短的图（如二分图），zkw算法都会比较快，原因是充分发挥优势。比如流多说明可以同一费用反复增广，费用窄说明不用改太多距离标号就会有新增广路，增广路径短可以显著改善最坏情况，因为即使每次就只增加一条边也可以很快凑成最短路。如果恰恰相反，流量不大，费用不小，增广路还较长，就不适合 zkw 算法了。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">struct</span> <span class="n">ZKW</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">flow</span><span class="p">,</span> <span class="n">cost</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vis</span><span class="p">;</span>
	<span class="n">ZKW</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="n">Edge</span> <span class="n">ed</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">ed</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">),</span> <span class="n">ed</span><span class="p">.</span><span class="n">cap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">len</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">,</span> <span class="n">ll</span> <span class="n">r</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">u</span> <span class="o">==</span> <span class="n">t</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">ll</span> <span class="n">_f</span> <span class="o">=</span> <span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="n">_r</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">h</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span> <span class="o">==</span> <span class="n">h</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
				<span class="n">_f</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">min</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">_r</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">cap</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">])),</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">_r</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">_r</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">h</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">vis</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">flow</span> <span class="o">=</span> <span class="n">cost</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);;)</span>
		<span class="p">{</span>
			<span class="n">ll</span> <span class="n">_f</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">INF</span><span class="p">),</span> <span class="n">d</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
			<span class="n">flow</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">cost</span> <span class="o">+=</span> <span class="n">_f</span> <span class="o">*</span> <span class="n">h</span><span class="p">[</span><span class="n">s</span><span class="p">];</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">u</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">u</span><span class="p">)</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span> <span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">cap</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
						<span class="n">d</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">first</span><span class="p">]);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">==</span> <span class="n">INF</span><span class="p">)</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
					<span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d</span><span class="p">,</span> <span class="n">vis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="上下界有源汇网络流">上下界有源汇网络流</h3>

<p>T向S连容量正无穷的边，将有源汇转化为无源汇。每条边容量减去下界，设$in[i]$表示流入i的下界之和减去流出i的下界之和。新建超级源汇SS,TT，对于$in[i]&gt;0$的点，SS向i连容量为$in[i]$的边。对于$in[i]&lt;0$的点，i向TT连容量为$−in[i]$的边。</p>

<p>求出以 SS,TT 为源汇的最大流，如果等于$\sum in<a href="in[i] &gt; 0">i</a>$则存在可行流。再求出以S,T为源汇的最大流即为最大流。</p>

<p>费用流：建完图后等价于求以SS,TT为源汇的的费用流。</p>

<p>上下界费用流：先把下界的费用加入答案。</p>

<h3 id="判断边是否属于某一割集">判断边是否属于某一割集</h3>

<p>在残余网络 (还有流量的边) 中求强连通分量，顶点不在同一 SCC 且满流的边。</p>

<p>判断边是否为全部最小割集的边： 在上一条的基础上，还要满足起点与 S 在同一 SCC，且终点与T在同一SCC。</p>

<h3 id="线性规划转费用流">线性规划转费用流</h3>

<p>首先添加松弛变量，将不等号都变为等号。分别用下一个式子减去上一个式子，如果每个变量只出现了两次且符号一正一负，那么可以转化为费用流。对于每个式子建立一个点，那么每个变量对应一条边，从一个点流出，向另一个点流入。这样，对于等式右边的常数，如果是正的，对应从源点向该点连一条流量C，费用0的边；如果是负的对应从该点向汇点连一条流量−C，费用0的边。对于每个变量，从它系数为正的式子向系数为负的式子连一条容量为 inf，费用为它在目标函数里系数的边。这样网络流模型就构造完毕了。</p>

<h2 id="欧拉路">欧拉路</h2>

<p><a href="https://vjudge.net/solution/16970884">使用示例</a>，给定无孤立结点图G，若存在一条路，经过图中每边一次且仅一次，该条路称为欧拉路。</p>

<ul>
  <li>无向图：当仅当该图所有顶点的度数为偶数（此时为回路），或除两个度数为奇数外（作为路径的起点和终点）、其余全为偶数。</li>
  <li>有向图：当仅当该图所有顶点出度=入度（此时为回路），或一个顶点出度=入度+1（作为起点）、另一个顶点入度=出度+1（作为终点）、其他顶点出度=入度。</li>
</ul>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Fleury</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vis</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">p</span><span class="p">;</span>
	<span class="n">Fleury</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">i</span> <span class="o">=</span> <span class="n">cur</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">i</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="c1">//遍历原图的反向图，这里加了一个“当前弧”优化
</span>			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">i</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">k</span> <span class="o">^</span> <span class="mi">1</span><span class="p">])</span>   <span class="c1">//无向图需要同时检查反向边未被访问过
</span>			<span class="p">{</span>
				<span class="n">vis</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="n">dfs</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">first</span><span class="p">);</span>
				<span class="n">p</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
			<span class="p">}</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">()</span> <span class="c1">//查询欧拉回路，路径上边的序号按顺序存在p中
</span>	<span class="p">{</span>
		<span class="n">vis</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">cur</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">p</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">i</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">dfs</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
		<span class="n">dfs</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="混合图欧拉回路判定">混合图欧拉回路判定</h3>

<p>首先给无向边随便定一个方向，设$\deg x$为x连出去的边数−连入x的边数。若存在$\deg x$为奇数，或者图不连通，则无解。否则建立源点S，汇点T。对于一个点x，若$\deg x&gt;0$，则S向x连边，容量$\frac{\deg x}{2}$；若$\deg x&lt;0$，则x向T连边，容量$-\frac{\deg x}{2}$。 对于一条定了向的无向边$x\to y$，x向y连边，容量1，求出最大流，若与 S 和T连的每条边都满流，则有解。</p>

<h2 id="连通性">连通性</h2>

<h3 id="无向图求割和双连通分量">无向图求割和双连通分量</h3>

<p><a href="https://vjudge.net/solution/19427352">使用示例1</a></p>

<p><a href="https://vjudge.net/solution/19427379">使用示例2</a></p>

<ul>
  <li>割边：在连通图中，删除了连通图的某条边后，图不再连通。这样的边被称为割边，也叫做桥。</li>
  <li>割点：在连通图中，删除了连通图的某个点以及与这个点相连的边后，图不再连通。这样的点被称为割点。构造dfs搜索树，在树上有两类节点可以成为割点：
    <ul>
      <li>对根节点u，若其有两棵或两棵以上的子树，则该根结点u为割点；</li>
      <li>对非根非叶节点u，若其中的某棵子树的节点均没有指向u的祖先节点的回边，说明删除u之后，根结点与该棵子树的节点不再连通；则节点u为割点。</li>
    </ul>
  </li>
</ul>

<p>对于一个无向图的子图，当删除其中任意一条边后，不改变图内点的连通性，这样的子图叫做边的双连通子图。而当子图的边数达到最大时，叫做边的双连通分量。原理是图中所有割边再求一次SCC，可<strong>直接</strong>使用求SCC的代码。</p>

<p>对于一个无向图的子图，当删除其中任意一个点后，不改变图内点的连通性，这样的子图叫做点的双连通子图。而当子图的边数达到最大时，叫做点的双连通分量。下面给出求点双连通分量的代码。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">BiconnectedConnectedComponenet</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">dep</span><span class="p">,</span> <span class="n">bid</span><span class="p">,</span> <span class="n">stak</span><span class="p">,</span> <span class="n">cutPoint</span><span class="p">,</span> <span class="n">cutEdge</span><span class="p">;</span> <span class="c1">//bid边的端点所属双连通块
</span>	<span class="n">BiconnectedConnectedComponenet</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">dep</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">bid</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">cutPoint</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">cutEdge</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
				<span class="n">dfs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fa</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">low</span> <span class="o">=</span> <span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">fa</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">?</span> <span class="n">dep</span><span class="p">[</span><span class="n">fa</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">lowto</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">to</span> <span class="o">!=</span> <span class="n">fa</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
				<span class="p">{</span>
					<span class="n">stak</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
					<span class="n">low</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">lowto</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">u</span><span class="p">));</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">lowto</span> <span class="o">&gt;</span> <span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
						<span class="n">cutEdge</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">cutEdge</span><span class="p">[</span><span class="n">k</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">lowto</span> <span class="o">&gt;=</span> <span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
						<span class="k">for</span> <span class="p">(</span><span class="n">cutPoint</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">fa</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">||</span> <span class="n">i</span><span class="p">;;)</span>
						<span class="p">{</span>
							<span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">stak</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
							<span class="n">stak</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
							<span class="n">bid</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">bid</span><span class="p">[</span><span class="n">x</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
							<span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">k</span><span class="p">)</span>
								<span class="k">break</span><span class="p">;</span>
						<span class="p">}</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
				<span class="p">{</span>
					<span class="n">stak</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
					<span class="n">low</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">dep</span><span class="p">[</span><span class="n">to</span><span class="p">]);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="k">return</span> <span class="n">low</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h4 id="双连通图的构造">双连通图的构造</h4>

<p>先求出所有的桥，然后删除这些桥边，剩下的每个连通块都是一个双连通子图。把每个双连通子图收缩为一个顶点，再把桥边加回来，最后的这个图一定是一棵树，边连通度为1。统计出树中度为1的节点的个数，即为叶节点的个数，记为<code class="highlighter-rouge">leaf</code>。至少在树上添加<code class="highlighter-rouge">(leaf+1)/2</code>条边，就能使树达到边双连通：先把两个最近公共祖先最远的两个叶节点之间连接一条边，这样可以把这两个点到祖先的路径上所有点收缩到一起，因为一个形成的环一定是双连通的；然后再找两个最近公共祖先最远的两个叶节点，这样一对一对找完，恰好是<code class="highlighter-rouge">(leaf+1)/2</code>次，把所有点收缩到了一起。</p>

<h3 id="无向图求边双连通分量有向图求强连通分量">无向图求边双连通分量&amp;有向图求强连通分量</h3>

<p><a href="https://vjudge.net/solution/19427182">无向图求边双连通分量</a></p>

<p><a href="https://vjudge.net/solution/19427243">有向图求强连通分量</a></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">StronglyConnectedComponenet</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">dep</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">stak</span><span class="p">;</span> <span class="c1">//sid=点所属连通块
</span>	<span class="n">StronglyConnectedComponenet</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">dep</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">sid</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
				<span class="n">dfs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fa</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">low</span> <span class="o">=</span> <span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">fa</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">?</span> <span class="n">dep</span><span class="p">[</span><span class="n">fa</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">stak</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">to</span> <span class="o">!=</span> <span class="n">fa</span> <span class="cm">/*, 1*/</span><span class="p">)</span> <span class="c1">//求强连通分量把注释去掉，即允许走回边
</span>			<span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
					<span class="n">low</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">dfs</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">u</span><span class="p">));</span>
				<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sid</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
					<span class="n">low</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">dep</span><span class="p">[</span><span class="n">to</span><span class="p">]);</span>
			<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">low</span> <span class="o">==</span> <span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
			<span class="k">for</span> <span class="p">(;;)</span>
			<span class="p">{</span>
				<span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">stak</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
				<span class="n">stak</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
				<span class="n">sid</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">u</span><span class="p">)</span>
					<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="k">return</span> <span class="n">low</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h4 id="2-sat">2-SAT</h4>

<p><a href="https://vjudge.net/solution/19427243">使用示例</a>，n个布尔变量$x_0\ldots x_{n-1}$，逻辑表达式$Y=(A_0+B_0)(A_1+B_1)\ldots(A_{m-1}+B_{m-1})$，其中$A_i,B_i\in{x_j,\overline{x_j}}$，判断是否存在$x_0\ldots x_{n-1}$的取值使得Y值为1。因为$A+B=(\overline A\to B)(\overline B\to A)$，所以对于一个要求$A+B$，我们连$\overline A\to B,\overline B\to A$两条边。如果有一条边$A\to B$，意味着如果A成立那么B必然成立。若$\exists i,x_i,\overline{x_i}\in$同一SCC，则不存在。</p>

<h5 id="2-sat暴力求字典序最小的解">2-SAT暴力求字典序最小的解</h5>

<p><a href="https://vjudge.net/solution/22373123">使用示例</a>，时间复杂度最坏为为$O(VE)$。</p>

<p>要求顶点数<code class="highlighter-rouge">v.size()</code>是偶数，最后输出结果在<code class="highlighter-rouge">ok中</code>。不满足任意i<code class="highlighter-rouge">ok[i]^ok[i^1]==1</code>时，<code class="highlighter-rouge">ask</code>函数返回<code class="highlighter-rouge">false</code>。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">TwoSat</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ok</span><span class="p">;</span>
	<span class="n">TwoSat</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">addOR</span><span class="p">(</span><span class="kt">int</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">q</span><span class="p">)</span> <span class="p">{</span> <span class="n">add</span><span class="p">({</span><span class="n">p</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">}),</span> <span class="n">add</span><span class="p">({</span><span class="n">q</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">});</span> <span class="p">}</span>
	<span class="kt">int</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">stak</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ok</span><span class="p">[</span><span class="n">u</span> <span class="o">^</span> <span class="mi">1</span><span class="p">])</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ok</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">ok</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">stak</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">:</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dfs</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">stak</span><span class="p">))</span>
				<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">ok</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ok</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">ok</span><span class="p">[</span><span class="n">i</span> <span class="o">^</span> <span class="mi">1</span><span class="p">])</span>
			<span class="p">{</span>
				<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">stak</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dfs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">stak</span><span class="p">))</span>
				<span class="p">{</span>
					<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">stak</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
						<span class="n">ok</span><span class="p">[</span><span class="n">stak</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dfs</span><span class="p">(</span><span class="n">i</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stak</span><span class="p">))</span>
						<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="二分图">二分图</h2>

<p>二分图的一个等价定义是：不含有含奇数条边的环的图。</p>

<p>完美匹配图中所有的顶点都是匹配点。</p>

<p>二分图的最小点覆盖（最小割）是指最少的顶点数使得二分图G中的每条边都至少与其中一个点相关联。二分图中，最小割=最大匹配。</p>

<p>二分图的最小边覆盖（最大独立集）是指用尽量少的不相交简单路径覆盖二分图中的所有顶点。二分图中，最小点覆盖+最小边覆盖=总点数。</p>

<p>Hall定理：二分图中的两部分顶点组成的集合分别为 X,Y ，则有一组无公共点的边，一端恰好为组成 X 的点的充分必要条件是：X 中的任意 k 个点至少与 Y 中的 k 个点相邻。对于区间图只需要考虑极端情况，线段树维护。</p>

<p>关键点：一定在最大匹配中的点。 求出任意一个最大匹配，那么只需要考虑哪些匹配点不一定在。 假设是考虑左侧的点，右侧类似： 将匹配边从右往左，非匹配边从左到右，从左侧每个未匹配点开始DFS到的匹配点都不是关键点。</p>

<p>关键边：求出任意一个最大匹配，将匹配边从右到左，剩余边从左到右，求出 SCC。 对于一条边：若它位于当前匹配中，那么若两端点位于同一SCC，则是可能在，否则必定在；若它不位于当前匹配中，那么若两端点位于同一 SCC，则是可能在，否则必定不在。</p>

<h3 id="hungary求最大匹配">Hungary求最大匹配</h3>

<p><a href="https://vjudge.net/solution/21880920">使用示例</a></p>

<p>左边nl个点$0\ldots nl-1$，右边nr个点$0\ldots nr-1$，取<code class="highlighter-rouge">n=max(nl,nr)</code>，左i右j间相连则<code class="highlighter-rouge">g[i].push_back(j);</code>。</p>

<p>生成<code class="highlighter-rouge">fl[i]</code>表示左边第i个匹配右边第<code class="highlighter-rouge">fl[i]</code>个，<code class="highlighter-rouge">fr</code>同理。时间复杂度$O(n^3)$。未匹配的值为<code class="highlighter-rouge">fl[i] == N</code>。匹配是一个边集，其中任意两条边都没有公共顶点；扫一遍<code class="highlighter-rouge">fl</code>或<code class="highlighter-rouge">fr</code>判断有多少不等于<code class="highlighter-rouge">N</code>即为最大匹配数。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Hungary</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">g</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">fl</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">fr</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">vr</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
	<span class="kt">int</span> <span class="nf">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rt</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">y</span> <span class="o">:</span> <span class="n">g</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">vr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="n">rt</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">vr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">rt</span><span class="p">,</span> <span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span> <span class="o">||</span> <span class="n">dfs</span><span class="p">(</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">],</span> <span class="n">rt</span><span class="p">))</span>
					<span class="k">return</span> <span class="n">fl</span><span class="p">[</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="nf">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">fill</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">fl</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">fr</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">vr</span><span class="p">,</span> <span class="n">vr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
				<span class="n">dfs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span> <span class="c1">//找完全匹配时如果返回值为0可直接return
</span>	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="hopcroftkarp求最大匹配">HopcroftKarp求最大匹配</h3>

<p><a href="https://vjudge.net/solution/21880796">使用示例</a>，时间复杂度$O(\sqrt{\vert V\vert }\vert E\vert )$，稀疏图上效果明显。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">HopcroftKarp</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">g</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">fl</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">fr</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">hl</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">hr</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
	<span class="kt">bool</span> <span class="nf">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">hl</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">hl</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">y</span> <span class="o">:</span> <span class="n">g</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">hr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">hr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="p">,</span> <span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span> <span class="o">||</span> <span class="n">dfs</span><span class="p">(</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]))</span>
					<span class="k">return</span> <span class="n">fl</span><span class="p">[</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="nf">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">fill</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">fl</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">fr</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">x</span><span class="p">)</span>
			<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">y</span> <span class="o">:</span> <span class="n">g</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">fl</span><span class="p">[</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">ql</span><span class="p">,</span> <span class="n">qr</span><span class="p">,</span> <span class="n">ok</span><span class="p">;;)</span>
		<span class="p">{</span>
			<span class="n">fill</span><span class="p">(</span><span class="n">hl</span><span class="p">,</span> <span class="n">hl</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">hr</span><span class="p">,</span> <span class="n">hr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">ql</span> <span class="o">=</span> <span class="n">qr</span> <span class="o">=</span> <span class="n">ok</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">x</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
					<span class="n">hl</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">qr</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">ql</span> <span class="o">&lt;</span> <span class="n">qr</span><span class="p">)</span>
				<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">y</span> <span class="o">:</span> <span class="n">g</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">ql</span><span class="o">++</span><span class="p">]])</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">hr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="n">hr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">hl</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">ql</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
							<span class="n">ok</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
						<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">hl</span><span class="p">[</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
							<span class="n">hl</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">qr</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]]</span> <span class="o">=</span> <span class="n">hr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
					<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ok</span><span class="p">)</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">x</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
					<span class="n">dfs</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="kuhnmunkres求最优完备匹配">KuhnMunkres求最优完备匹配</h3>

<p><a href="https://vjudge.net/solution/21880965">使用示例</a>。</p>

<p>左x右y代价<code class="highlighter-rouge">a[x][y]</code>。最大费用流时，a初始化0；最大费用最大流时，a初始化<code class="highlighter-rouge">-N*INF</code>。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">KuhnMunkres</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">a</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="n">N</span><span class="p">],</span> <span class="n">hl</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">hr</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">slk</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">fl</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">fr</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">vl</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">vr</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">pre</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">ql</span><span class="p">,</span> <span class="n">qr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="nf">check</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">N</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">vr</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">qr</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">fl</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">N</span><span class="p">)</span>
			<span class="n">swap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">fr</span><span class="p">[</span><span class="n">fl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="p">]]);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="nf">bfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">fill</span><span class="p">(</span><span class="n">slk</span><span class="p">,</span> <span class="n">slk</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">INF</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">vl</span><span class="p">,</span> <span class="n">vl</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">vr</span><span class="p">,</span> <span class="n">vr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">vr</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">ql</span> <span class="o">=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">qr</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;;)</span>
		<span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">ll</span> <span class="n">d</span><span class="p">;</span> <span class="n">ql</span> <span class="o">&lt;</span> <span class="n">qr</span><span class="p">;)</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">ql</span><span class="o">++</span><span class="p">];</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">slk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">d</span> <span class="o">=</span> <span class="n">hl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">hr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]))</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
							<span class="n">slk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
						<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">check</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
							<span class="k">return</span><span class="p">;</span>
			<span class="n">ll</span> <span class="n">d</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="n">slk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
					<span class="n">d</span> <span class="o">=</span> <span class="n">slk</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
					<span class="n">hl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
				<span class="k">else</span>
					<span class="n">slk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">d</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">vr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
					<span class="n">hr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">d</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">slk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">check</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
					<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="nf">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">fill</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">fl</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">fr</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">hr</span><span class="p">,</span> <span class="n">hr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">hl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="n">max_element</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">n</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
			<span class="n">bfs</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="带花树">带花树</h2>

<h3 id="一般图最大匹配">一般图最大匹配</h3>

<p><a href="http://uoj.ac/submission/342734">使用示例</a></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Blossom</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">f</span><span class="p">;</span>
	<span class="n">Blossom</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">f</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vis</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">vis</span><span class="p">.</span><span class="n">back</span><span class="p">();</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">s</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
			<span class="p">{</span>
				<span class="n">UnionfindSet</span> <span class="n">ufs</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
				<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">pre</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()),</span> <span class="n">flag</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">2</span><span class="p">);</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">deque</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">q</span><span class="p">.</span><span class="n">pop_front</span><span class="p">())</span>
					<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">front</span><span class="p">(),</span> <span class="n">y</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">]].</span><span class="n">second</span><span class="p">,</span> <span class="n">y</span> <span class="o">!=</span> <span class="n">f</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">flag</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">ufs</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ufs</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
						<span class="p">{</span>
							<span class="k">if</span> <span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
							<span class="p">{</span>
								<span class="k">for</span> <span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="o">++</span><span class="n">cnt</span><span class="p">;;</span> <span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
									<span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
									<span class="p">{</span>
										<span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">a</span> <span class="o">=</span> <span class="n">ufs</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span> <span class="o">==</span> <span class="n">cnt</span><span class="p">)</span>
											<span class="k">break</span><span class="p">;</span>
										<span class="n">vis</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">?</span> <span class="n">pre</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">a</span><span class="p">]]</span> <span class="o">:</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
									<span class="p">}</span>
								<span class="k">if</span> <span class="p">(</span><span class="n">ufs</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="n">a</span><span class="p">)</span>
									<span class="n">pre</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
								<span class="k">if</span> <span class="p">(</span><span class="n">ufs</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="n">a</span><span class="p">)</span>
									<span class="n">pre</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
								<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">},</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
									<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">;</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">a</span><span class="p">;</span> <span class="n">ufs</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">ufs</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">z</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
									<span class="p">{</span>
										<span class="k">if</span> <span class="p">(</span><span class="n">ufs</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">z</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">x</span><span class="p">]])</span> <span class="o">!=</span> <span class="n">a</span><span class="p">)</span>
											<span class="n">pre</span><span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
										<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">flag</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>
											<span class="n">flag</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
										<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">flag</span><span class="p">[</span><span class="n">z</span><span class="p">])</span>
											<span class="n">flag</span><span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">z</span><span class="p">);</span>
									<span class="p">}</span>
							<span class="p">}</span>
							<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
								<span class="n">pre</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">flag</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">flag</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">y</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">y</span><span class="p">]);</span>
							<span class="k">else</span>
							<span class="p">{</span>
								<span class="k">for</span> <span class="p">(</span><span class="n">pre</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span> <span class="n">y</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();)</span>
									<span class="n">swap</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="n">y</span><span class="p">]]);</span>
								<span class="k">break</span><span class="p">;</span>
							<span class="p">}</span>
						<span class="p">}</span>
			<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="树形图">树形图</h2>

<h3 id="最小生成树">最小生成树</h3>

<h4 id="无向图">无向图</h4>

<p>同时给出Prim算法（生成新树）、Kruskal算法（消耗小）。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Prim</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">DisGreater</span>
	<span class="p">{</span>
		<span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Edge</span> <span class="o">&amp;</span><span class="n">e1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Edge</span> <span class="o">&amp;</span><span class="n">e2</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">return</span> <span class="n">e1</span><span class="p">.</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">e2</span><span class="p">.</span><span class="n">len</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">};</span>
	<span class="n">ll</span> <span class="n">ans</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vis</span><span class="p">;</span>
	<span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">Edge</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">DisGreater</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">;</span>
	<span class="n">Prim</span><span class="p">(</span><span class="k">const</span> <span class="n">Graph</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">,</span> <span class="kt">int</span> <span class="n">root</span><span class="p">)</span> <span class="o">:</span> <span class="n">Tree</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">ans</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">vis</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">//生成新树，每条边都要有等长反向边
</span>	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">insert</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">g</span><span class="p">);</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">();)</span>
		<span class="p">{</span>
			<span class="n">Edge</span> <span class="n">ed</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">();</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">pop</span><span class="p">(),</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">])</span>
				<span class="n">insert</span><span class="p">(</span><span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">,</span> <span class="n">g</span><span class="p">),</span> <span class="n">ans</span> <span class="o">+=</span> <span class="n">ed</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="k">const</span> <span class="n">Graph</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">)</span> <span class="c1">//把点和对应的相连的边加入集合
</span>	<span class="p">{</span>
		<span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">g</span><span class="p">.</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">])</span>
				<span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="n">ll</span> <span class="nf">kruskal</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="c1">//会清空边集e，每条边被认作无向边
</span><span class="p">{</span>
	<span class="n">ll</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">UnionFindSet</span> <span class="n">ufs</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">sort</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">e</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">DisGreater</span><span class="p">());</span> <span class="o">!</span><span class="n">e</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span> <span class="n">e</span><span class="p">.</span><span class="n">pop_back</span><span class="p">())</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ufs</span><span class="p">.</span><span class="n">fa</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">from</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ufs</span><span class="p">.</span><span class="n">fa</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">to</span><span class="p">))</span>
		<span class="p">{</span>
			<span class="n">ufs</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">from</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">to</span><span class="p">);</span>
			<span class="n">ret</span> <span class="o">+=</span> <span class="n">e</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">len</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="k">return</span> <span class="cm">/*ufs.siz&gt;1?INF:*/</span> <span class="n">ret</span><span class="p">;</span> <span class="c1">//视情况选择去注释
</span><span class="p">}</span>
</code></pre></div></div>

<h4 id="有向图">有向图</h4>

<p><a href="https://vjudge.net/solution/16971789">使用示例</a></p>

<p>指定以root为根，如果没有限定根那么新建一个虚拟点作为根，向所有边连边长<strong>最大边长+1</strong>的边，在最后生成的图中去掉此边。时间复杂度$O(VE)$。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ll</span> <span class="nf">zhuLiu</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">,</span> <span class="kt">int</span> <span class="n">root</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="c1">//不存在返回INF
</span><span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">ll</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;;)</span>
	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">in</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">INF</span><span class="p">);</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">pre</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">first</span> <span class="o">==</span> <span class="p">(</span><span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">second</span><span class="p">))</span>
				<span class="n">swap</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="o">--</span><span class="p">],</span> <span class="n">e</span><span class="p">.</span><span class="n">back</span><span class="p">()),</span> <span class="n">e</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">in</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">len</span><span class="p">)</span>
				<span class="n">in</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">len</span><span class="p">,</span> <span class="n">pre</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">first</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">in</span> <span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">in</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">INF</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">INF</span><span class="p">;</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">id</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">vis</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
		<span class="kt">int</span> <span class="n">tn</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">ret</span> <span class="o">+=</span> <span class="n">in</span> <span class="p">[</span><span class="n">v</span> <span class="o">=</span> <span class="n">i</span><span class="p">];</span> <span class="n">vis</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="o">&amp;&amp;</span> <span class="n">id</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="n">n</span> <span class="o">&amp;&amp;</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">root</span><span class="p">;</span> <span class="n">v</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>
				<span class="n">vis</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">!=</span> <span class="n">root</span> <span class="o">&amp;&amp;</span> <span class="n">id</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="n">n</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="n">v</span><span class="p">];</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">v</span><span class="p">;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
					<span class="n">id</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">tn</span><span class="p">;</span>
				<span class="n">id</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">tn</span><span class="o">++</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">tn</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">id</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">n</span><span class="p">)</span>
				<span class="n">id</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tn</span><span class="o">++</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">first</span> <span class="o">=</span> <span class="n">id</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">first</span><span class="p">])</span> <span class="o">!=</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">second</span> <span class="o">=</span> <span class="n">id</span><span class="p">[</span><span class="n">v</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">second</span><span class="p">]))</span>
				<span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">len</span> <span class="o">-=</span> <span class="n">in</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
		<span class="n">n</span> <span class="o">=</span> <span class="n">tn</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span> <span class="n">id</span><span class="p">[</span><span class="n">root</span><span class="p">];</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="树链剖分与lca">树链剖分与LCA</h3>

<p><a href="https://vjudge.net/solution/16971586">使用示例</a></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Diagram</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">Fenwick</span> <span class="n">data</span><span class="p">;</span> <span class="c1">//暂用树状数组作为默认数据结构
</span>	<span class="n">Diagram</span><span class="p">(</span><span class="k">const</span> <span class="n">Graph</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">,</span> <span class="kt">int</span> <span class="n">root</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()),</span> <span class="n">data</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
	<span class="p">{</span>
		<span class="n">build</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">g</span><span class="p">);</span>
		<span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">root</span><span class="p">].</span><span class="n">dfn</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">root</span><span class="p">].</span><span class="n">dep</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">dfs</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">root</span><span class="p">].</span><span class="n">top</span> <span class="o">=</span> <span class="n">root</span><span class="p">,</span> <span class="n">cnt</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">build</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="k">const</span> <span class="n">Graph</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">)</span> <span class="c1">//无向图dfs建树，且重边在最前，u为根节点
</span>	<span class="p">{</span>
		<span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">siz</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="o">!</span><span class="n">v</span><span class="p">[</span><span class="n">to</span><span class="p">].</span><span class="n">siz</span><span class="p">)</span> <span class="c1">//没访问过的点siz默认0
</span>			<span class="p">{</span>
				<span class="n">build</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">g</span><span class="p">);</span>
				<span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">siz</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">to</span><span class="p">].</span><span class="n">siz</span><span class="p">;</span>
				<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">ch</span><span class="p">(</span><span class="n">u</span><span class="p">)].</span><span class="n">siz</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">to</span><span class="p">].</span><span class="n">siz</span><span class="p">)</span> <span class="c1">//重边移到最前
</span>					<span class="n">swap</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">front</span><span class="p">(),</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">back</span><span class="p">());</span>
			<span class="p">}</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">cnt</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">v</span><span class="p">[</span><span class="n">to</span> <span class="o">=</span> <span class="n">ch</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">i</span><span class="p">)].</span><span class="n">dfn</span> <span class="o">=</span> <span class="o">++</span><span class="n">cnt</span><span class="p">;</span>
			<span class="n">v</span><span class="p">[</span><span class="n">to</span><span class="p">].</span><span class="n">top</span> <span class="o">=</span> <span class="n">i</span> <span class="o">?</span> <span class="n">to</span> <span class="o">:</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">top</span><span class="p">;</span>
			<span class="n">v</span><span class="p">[</span><span class="n">to</span><span class="p">].</span><span class="n">dep</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">dep</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">dfs</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">cnt</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">lca</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(;</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span> <span class="o">!=</span> <span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">top</span><span class="p">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">fa</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">))</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dep</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dep</span><span class="p">)</span>
				<span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dep</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">dep</span><span class="p">)</span>
			<span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">y</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">ll</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(;</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span> <span class="o">!=</span> <span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">top</span><span class="p">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">fa</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">))</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dep</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dep</span><span class="p">)</span>
				<span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
			<span class="n">ans</span> <span class="o">+=</span> <span class="n">data</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dfn</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dfn</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dep</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">dep</span><span class="p">)</span>
			<span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">ans</span> <span class="o">+=</span> <span class="n">data</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">dfn</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dfn</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="n">ll</span> <span class="n">pv</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(;</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span> <span class="o">!=</span> <span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">top</span><span class="p">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">fa</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">))</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dep</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dep</span><span class="p">)</span>
				<span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
			<span class="n">data</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dfn</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dfn</span><span class="p">,</span> <span class="n">pv</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dep</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">dep</span><span class="p">)</span>
			<span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
		<span class="n">data</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">dfn</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dfn</span><span class="p">,</span> <span class="n">pv</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="点剖点分治">点剖（点分治）</h3>

<p><a href="https://vjudge.net/solution/16971666">使用示例</a>，零号点为虚节点。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">TreeDiv</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">root</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">mx</span><span class="p">,</span> <span class="n">siz</span><span class="p">,</span> <span class="n">vis</span><span class="p">;</span>
	<span class="n">TreeDiv</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">mx</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">siz</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">vis</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">dfsRoot</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fa</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">mx</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">siz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">to</span> <span class="o">!=</span> <span class="n">fa</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">dfsRoot</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">u</span><span class="p">),</span> <span class="n">siz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+=</span> <span class="n">siz</span><span class="p">[</span><span class="n">to</span><span class="p">],</span> <span class="n">mx</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">siz</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
					<span class="n">mx</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">siz</span><span class="p">[</span><span class="n">to</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">mx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="o">++</span><span class="n">siz</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
			<span class="n">mx</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">mx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">siz</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">mx</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
			<span class="n">root</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">dfsDis</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fa</span><span class="p">,</span> <span class="n">ll</span> <span class="n">d</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="c1">//用d更新答案
</span>		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">to</span> <span class="o">!=</span> <span class="n">fa</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
				<span class="n">dfsDis</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">d</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">cal</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">ll</span> <span class="n">d</span><span class="p">)</span> <span class="c1">//返回符合要求的点对数
</span>	<span class="p">{</span>
		<span class="k">return</span> <span class="n">dfsDis</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="cm">/*得到答案*/</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">dfsRoot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">ans</span> <span class="o">+=</span> <span class="n">cal</span><span class="p">(</span><span class="n">u</span> <span class="o">=</span> <span class="n">root</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
				<span class="n">ans</span> <span class="o">-=</span> <span class="n">cal</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">),</span> <span class="n">mx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">siz</span><span class="p">[</span><span class="n">to</span><span class="p">],</span> <span class="n">dfs</span><span class="p">(</span><span class="n">to</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

  </div>
  
  
  <div class="reward">
    <button id="rewardButton" disable="enable"
      onclick="var qr = document.getElementById('rewardQRs'); qr.style.display = (qr.style.display === 'block') ? 'none' : 'block';">
      如果我的博客帮助到你，可以请我喝一杯咖啡~
    </button>
    <div id="rewardQRs">
      <table>
        <tr>
          
          <td id="wechat" class="reward_qr">
            <img id="wechat_qr" src="/public/image/wechatpay.jpg" alt="WuKwechat">
          </td>
          
          <td id="alipay" class="reward_qr">
            <img id="alipay_qr" src="/public/image/alipay.jpg" alt="WuKalipay">
          </td>
          
        </tr>
      </table>
    </div>
  </div>
  
</div>


<script src="/public/js/valine.js"></script>


    </div>
  </div>
  <label for="sidebar-checkbox" class="sidebar-toggle fas fa-bars"></label>
</body>

</html>
