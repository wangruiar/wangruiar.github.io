<h2 id="accessing-the-database">Accessing the Database</h2>

<p>The first laboratory exercise is to connect to a database, populate it with data, and run very simple SQL queries.</p>

<ul>
  <li>In case a shared database is provided for course students, user accounts need to be created on the database. Otherwise, the lab should also cover setting up a database system. Information on setting up a database may be found <a href="https://www.db-book.com/db6/lab-dir/index.html">here</a></li>
  <li>The next step is to connect to the database. Although most databases have their own text-based interface, we recommend using a graphical interface such as the database browser of the Netbeans IDE, or a database specific interface. More information on accessing these interfaces may be found <a href="https://www.db-book.com/db6/lab-dir/index.html">here</a>.</li>
  <li>The next step is to create tables and load sample data. Scripts for these tasks can be found <a href="http://db-book.com/db6/lab-dir/sample_tables-dir/index.html">here</a>.</li>
  <li>Try out some queries, and see what they do. Some example queries:
    <ul>
      <li>select * from instructor</li>
      <li>select name from instructor where dept_name = ‘Comp. Sci.’ and salary &gt; 70000</li>
      <li>select * from instructor, department where instructor.dept_name = department.dept_name</li>
    </ul>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; CREATE DATABASE school<span class="p">;</span>
mysql&gt; use school<span class="p">;</span>
mysql&gt; <span class="nb">source</span> <span class="se">\p</span>ath<span class="se">\t</span>o<span class="se">\D</span>DL-MySQL.sql
mysql&gt; <span class="nb">source</span> <span class="se">\p</span>ath<span class="se">\t</span>o<span class="se">\s</span>mallRelationsInsertFile.sql
</code></pre></div></div>

<h2 id="basic-sql">Basic SQL</h2>

<p>This lab covers simple SQL queries. A sample lab (for a 2 to 3 hour session) can be found <a href="https://www.db-book.com/db6/lab-dir/labexercises-dir/Lab1.html">here</a>.</p>

<h3 id="find-the-names-of-all-the-instructors-from-biology-department">Find the names of all the instructors from Biology department</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">name</span> <span class="k">from</span> <span class="n">instructor</span> <span class="k">where</span> <span class="n">dept_name</span> <span class="o">=</span> <span class="s1">'Biology'</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-------+</span>
<span class="o">|</span> <span class="n">name</span>  <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+</span>
<span class="o">|</span> <span class="n">Crick</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">02</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="find-the-names-of-courses-in-computer-science-department-which-have-3-credits">Find the names of courses in Computer science department which have 3 credits</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">title</span> <span class="k">from</span> <span class="n">course</span> <span class="k">where</span> <span class="n">credits</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------------------------+</span>
<span class="o">|</span> <span class="n">title</span>                     <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------------+</span>
<span class="o">|</span> <span class="n">Computational</span> <span class="n">Biology</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">Robotics</span>                  <span class="o">|</span>
<span class="o">|</span> <span class="n">Image</span> <span class="n">Processing</span>          <span class="o">|</span>
<span class="o">|</span> <span class="k">Database</span> <span class="k">System</span> <span class="n">Concepts</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Intro</span><span class="p">.</span> <span class="k">to</span> <span class="n">Digital</span> <span class="n">Systems</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Investment</span> <span class="n">Banking</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">World</span> <span class="n">History</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">Music</span> <span class="n">Video</span> <span class="n">Production</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------------+</span>
<span class="mi">8</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="for-the-student-with-id-12345-or-any-other-value-show-all-course-id-and-title-of-all-courses-registered-for-by-the-student">For the student with ID 12345 (or any other value), show all course id and title of all courses registered for by the student</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">course_id</span><span class="p">,</span> <span class="n">title</span>
    <span class="o">-&gt;</span> <span class="k">from</span> <span class="n">takes</span> <span class="k">natural</span> <span class="k">join</span> <span class="n">course</span>
    <span class="o">-&gt;</span> <span class="k">where</span> <span class="n">ID</span> <span class="o">=</span> <span class="mi">12345</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-----------+----------------------------+</span>
<span class="o">|</span> <span class="n">course_id</span> <span class="o">|</span> <span class="n">title</span>                      <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------+----------------------------+</span>
<span class="o">|</span> <span class="n">CS</span><span class="o">-</span><span class="mi">101</span>    <span class="o">|</span> <span class="n">Intro</span><span class="p">.</span> <span class="k">to</span> <span class="n">Computer</span> <span class="n">Science</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">CS</span><span class="o">-</span><span class="mi">190</span>    <span class="o">|</span> <span class="n">Game</span> <span class="n">Design</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">CS</span><span class="o">-</span><span class="mi">315</span>    <span class="o">|</span> <span class="n">Robotics</span>                   <span class="o">|</span>
<span class="o">|</span> <span class="n">CS</span><span class="o">-</span><span class="mi">347</span>    <span class="o">|</span> <span class="k">Database</span> <span class="k">System</span> <span class="n">Concepts</span>   <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------+----------------------------+</span>
<span class="mi">4</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">02</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="as-above-but-show-the-total-number-of-credits-for-such-courses-taken-by-that-student-dont-display-the-tot-creds-value-from-the-student-table-you-should-use-sql-aggregation-on-courses-taken-by-the-student">As above, but show the total number of credits for such courses (taken by that student). Don’t display the tot creds value from the student table, you should use SQL aggregation on courses taken by the student</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">sum</span><span class="p">(</span><span class="n">credits</span><span class="p">)</span>
    <span class="o">-&gt;</span> <span class="k">from</span> <span class="n">takes</span> <span class="k">natural</span> <span class="k">join</span> <span class="n">course</span>
    <span class="o">-&gt;</span> <span class="k">where</span> <span class="n">ID</span> <span class="o">=</span> <span class="mi">12345</span><span class="p">;</span>
<span class="o">+</span><span class="c1">--------------+</span>
<span class="o">|</span> <span class="k">sum</span><span class="p">(</span><span class="n">credits</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+</span>
<span class="o">|</span>           <span class="mi">14</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">02</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="as-above-but-display-the-total-credits-for-each-of-the-students-along-with-the-id-of-the-student-dont-bother-about-the-name-of-the-student-dont-bother-about-students-who-have-not-registered-for-any-course-they-can-be-omitted">As above, but display the total credits for each of the students, along with the ID of the student; don’t bother about the name of the student. (Don’t bother about students who have not registered for any course, they can be omitted)</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">ID</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">credits</span><span class="p">)</span>
    <span class="o">-&gt;</span> <span class="k">from</span> <span class="n">takes</span> <span class="k">natural</span> <span class="k">join</span> <span class="n">course</span>
    <span class="o">-&gt;</span> <span class="k">group</span> <span class="k">by</span> <span class="n">ID</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-------+--------------+</span>
<span class="o">|</span> <span class="n">ID</span>    <span class="o">|</span> <span class="k">sum</span><span class="p">(</span><span class="n">credits</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+--------------+</span>
<span class="o">|</span> <span class="mi">98988</span> <span class="o">|</span>            <span class="mi">8</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">00128</span> <span class="o">|</span>            <span class="mi">7</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">12345</span> <span class="o">|</span>           <span class="mi">14</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">45678</span> <span class="o">|</span>           <span class="mi">11</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">54321</span> <span class="o">|</span>            <span class="mi">8</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">76543</span> <span class="o">|</span>            <span class="mi">7</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">98765</span> <span class="o">|</span>            <span class="mi">7</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">76653</span> <span class="o">|</span>            <span class="mi">3</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">23121</span> <span class="o">|</span>            <span class="mi">3</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">19991</span> <span class="o">|</span>            <span class="mi">3</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">55739</span> <span class="o">|</span>            <span class="mi">3</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">44553</span> <span class="o">|</span>            <span class="mi">4</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+--------------+</span>
<span class="mi">12</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">02</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="find-the-names-of-all-students-who-have-taken-any-comp-sci-course-ever-there-should-be-no-duplicate-names">Find the names of all students who have taken any Comp. Sci. course ever (there should be no duplicate names)</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">distinct</span> <span class="n">S</span><span class="p">.</span><span class="n">name</span> <span class="k">from</span> <span class="n">student</span> <span class="k">as</span> <span class="n">S</span><span class="p">,</span>
    <span class="o">-&gt;</span> <span class="p">(</span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">takes</span> <span class="k">natural</span> <span class="k">join</span> <span class="n">course</span><span class="p">)</span> <span class="k">as</span> <span class="k">C</span>
    <span class="o">-&gt;</span> <span class="k">where</span> <span class="n">S</span><span class="p">.</span><span class="n">ID</span> <span class="o">=</span> <span class="k">C</span><span class="p">.</span><span class="n">ID</span> <span class="k">and</span> <span class="k">C</span><span class="p">.</span><span class="n">dept_name</span> <span class="o">=</span> <span class="s1">'Comp. Sci.'</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----------+</span>
<span class="o">|</span> <span class="n">name</span>     <span class="o">|</span>
<span class="o">+</span><span class="c1">----------+</span>
<span class="o">|</span> <span class="n">Zhang</span>    <span class="o">|</span>
<span class="o">|</span> <span class="n">Shankar</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Levy</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">Williams</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Brown</span>    <span class="o">|</span>
<span class="o">|</span> <span class="n">Bourikas</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----------+</span>
<span class="mi">6</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="display-the-ids-of-all-instructors-who-have-never-taught-a-couse-note-1-oracle-uses-the-keyword-minus-in-place-of-except-2-interpret-taught-as-taught-or-is-scheduled-to-teach">Display the IDs of all instructors who have never taught a couse. Note: (1) Oracle uses the keyword minus in place of except; (2) interpret ”taught” as ”taught or is scheduled to teach”</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">ID</span> <span class="k">from</span> <span class="n">instructor</span>
    <span class="o">-&gt;</span> <span class="k">where</span> <span class="n">ID</span> <span class="k">not</span> <span class="k">in</span> <span class="p">(</span>
    <span class="o">-&gt;</span>   <span class="k">select</span> <span class="n">ID</span>
    <span class="o">-&gt;</span>   <span class="k">from</span> <span class="n">instructor</span> <span class="k">natural</span> <span class="k">join</span> <span class="n">teaches</span><span class="p">);</span>
<span class="o">+</span><span class="c1">-------+</span>
<span class="o">|</span> <span class="n">ID</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+</span>
<span class="o">|</span> <span class="mi">76543</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">58583</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">33456</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+</span>
<span class="mi">3</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">02</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="as-above-but-display-the-names-of-the-instructors-also-not-just-the-ids">As above, but display the names of the instructors also, not just the IDs</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="n">ID</span> <span class="k">from</span> <span class="n">instructor</span>
    <span class="o">-&gt;</span> <span class="k">where</span> <span class="n">ID</span> <span class="k">not</span> <span class="k">in</span> <span class="p">(</span><span class="k">select</span> <span class="n">ID</span> <span class="k">from</span> <span class="n">instructor</span> <span class="k">natural</span> <span class="k">join</span> <span class="n">teaches</span><span class="p">);</span>
<span class="o">+</span><span class="c1">-----------+-------+</span>
<span class="o">|</span> <span class="n">name</span>      <span class="o">|</span> <span class="n">ID</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------+-------+</span>
<span class="o">|</span> <span class="n">Gold</span>      <span class="o">|</span> <span class="mi">33456</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Califieri</span> <span class="o">|</span> <span class="mi">58583</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Singh</span>     <span class="o">|</span> <span class="mi">76543</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------+-------+</span>
<span class="mi">3</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="you-need-to-create-a-movie-database-create-three-tables-one-for-actorsaid-name-one-for-moviesmid-title-and-one-for-actor-rolemid-aid-rolename-use-appropriate-data-types-for-each-of-the-attributes-and-add-appropriate-primaryforeign-key-constraints">You need to create a movie database. Create three tables, one for actors(AID, name), one for movies(MID, title) and one for actor role(MID, AID, rolename). Use appropriate data types for each of the attributes, and add appropriate primary/foreign key constraints</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">create</span> <span class="k">table</span> <span class="n">actors</span> <span class="p">(</span>
  <span class="n">AID</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
  <span class="n">name</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
  <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">AID</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">movies</span> <span class="p">(</span>
  <span class="n">MID</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
  <span class="n">title</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
  <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">MID</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">actor_role</span> <span class="p">(</span>
  <span class="n">MID</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
  <span class="n">AID</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
  <span class="n">rolename</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
  <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">MID</span><span class="p">,</span><span class="n">AID</span><span class="p">,</span><span class="n">rolename</span><span class="p">),</span>
  <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">MID</span><span class="p">)</span> <span class="k">references</span> <span class="n">movies</span><span class="p">(</span><span class="n">MID</span><span class="p">),</span>
  <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">AID</span><span class="p">)</span> <span class="k">references</span> <span class="n">actors</span><span class="p">(</span><span class="n">AID</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<h3 id="insert-data-to-the-above-tables-approx-3-to-6-rows-in-each-table-including-data-for-actor-charlie-chaplin-and-for-yourself-using-your-roll-number-as-id">Insert data to the above tables (approx 3 to 6 rows in each table), including data for actor ”Charlie Chaplin”, and for yourself (using your roll number as ID)</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">delete</span> <span class="k">from</span> <span class="n">actor_role</span><span class="p">;</span>
<span class="k">delete</span> <span class="k">from</span> <span class="n">actors</span><span class="p">;</span>
<span class="k">delete</span> <span class="k">from</span> <span class="n">movies</span><span class="p">;</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">actors</span> <span class="k">values</span> <span class="p">(</span><span class="s1">'01'</span><span class="p">,</span><span class="s1">'Charlie Chaplin'</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">movies</span> <span class="k">values</span> <span class="p">(</span><span class="s1">'M1'</span><span class="p">,</span><span class="s1">'City Lights'</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">actor_role</span> <span class="k">values</span> <span class="p">(</span><span class="s1">'M1'</span><span class="p">,</span><span class="s1">'01'</span><span class="p">,</span><span class="s1">'Tramp'</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">actors</span> <span class="k">values</span> <span class="p">(</span><span class="s1">'02'</span><span class="p">,</span><span class="s1">'Stephen Chow'</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">movies</span> <span class="k">values</span> <span class="p">(</span><span class="s1">'M2'</span><span class="p">,</span><span class="s1">'Kung Fu Hustle'</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">actor_role</span> <span class="k">values</span> <span class="p">(</span><span class="s1">'M2'</span><span class="p">,</span><span class="s1">'02'</span><span class="p">,</span><span class="s1">'Kung Fu Hustle'</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">actors</span> <span class="k">values</span> <span class="p">(</span><span class="s1">'03'</span><span class="p">,</span><span class="s1">'Jay Chou'</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">movies</span> <span class="k">values</span> <span class="p">(</span><span class="s1">'M3'</span><span class="p">,</span><span class="s1">'Initial D'</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">actor_role</span> <span class="k">values</span> <span class="p">(</span><span class="s1">'M3'</span><span class="p">,</span><span class="s1">'03'</span><span class="p">,</span><span class="s1">'Fujiwara Takumi'</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">actors</span> <span class="k">values</span> <span class="p">(</span><span class="s1">'04'</span><span class="p">,</span><span class="s1">'Kan Wu'</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="write-a-query-to-list-all-movies-in-which-actor-charlie-chaplin-has-acted-along-with-the-number-of-roles-he-had-in-that-movie">Write a query to list all movies in which actor ”Charlie Chaplin” has acted, along with the number of roles he had in that movie</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="n">rolename</span><span class="p">)</span>
    <span class="o">-&gt;</span> <span class="k">from</span> <span class="n">actor_role</span> <span class="k">natural</span> <span class="k">join</span> <span class="n">movies</span> <span class="k">natural</span> <span class="k">join</span> <span class="n">actors</span>
    <span class="o">-&gt;</span> <span class="k">where</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">'Charlie Chaplin'</span> <span class="k">group</span> <span class="k">by</span> <span class="n">MID</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-----------------+-------------+-----------------+</span>
<span class="o">|</span> <span class="n">name</span>            <span class="o">|</span> <span class="n">title</span>       <span class="o">|</span> <span class="k">count</span><span class="p">(</span><span class="n">rolename</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------+-------------+-----------------+</span>
<span class="o">|</span> <span class="n">Charlie</span> <span class="n">Chaplin</span> <span class="o">|</span> <span class="n">City</span> <span class="n">Lights</span> <span class="o">|</span>               <span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------+-------------+-----------------+</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="write-a-query-to-list-all-actors-who-have-not-acted-in-any-movie">Write a query to list all actors who have not acted in any movie</h3>

<p>没错就是我了。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">name</span> <span class="k">from</span> <span class="n">actors</span>
    <span class="o">-&gt;</span> <span class="k">where</span> <span class="n">name</span> <span class="k">not</span> <span class="k">in</span> <span class="p">(</span>
    <span class="o">-&gt;</span>   <span class="k">select</span> <span class="k">distinct</span> <span class="n">name</span>
    <span class="o">-&gt;</span>   <span class="k">from</span> <span class="n">actor_role</span> <span class="k">natural</span> <span class="k">join</span> <span class="n">actors</span><span class="p">);</span>
<span class="o">+</span><span class="c1">--------+</span>
<span class="o">|</span> <span class="n">name</span>   <span class="o">|</span>
<span class="o">+</span><span class="c1">--------+</span>
<span class="o">|</span> <span class="n">Kan</span> <span class="n">Wu</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">--------+</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="list-names-of-actors-along-with-titles-of-movies-they-have-acted-in-if-they-have-not-acted-in-any-movie-show-the-movie-title-as-null-do-not-use-sql-outerjoin-syntax-here-write-it-from-scratch">List names of actors, along with titles of movies they have acted in. If they have not acted in any movie, show the movie title as null. (Do not use SQL outerjoin syntax here, write it from scratch.)</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ERROR</span> <span class="mi">1248</span> <span class="p">(</span><span class="mi">42000</span><span class="p">):</span> <span class="k">Every</span> <span class="n">derived</span> <span class="k">table</span> <span class="n">must</span> <span class="n">have</span> <span class="n">its</span> <span class="n">own</span> <span class="k">alias</span>
</code></pre></div></div>

<p>这里遇到一个问题，每个子查询都要有一个别名。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="p">(</span>
    <span class="o">-&gt;</span> <span class="p">(</span><span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="n">title</span>
    <span class="o">-&gt;</span> <span class="k">from</span> <span class="n">actors</span><span class="p">,</span> <span class="n">movies</span><span class="p">,</span> <span class="n">actor_role</span>
    <span class="o">-&gt;</span> <span class="k">where</span> <span class="n">actors</span><span class="p">.</span><span class="n">AID</span> <span class="o">=</span> <span class="n">actor_role</span><span class="p">.</span><span class="n">AID</span> <span class="k">and</span> <span class="n">movies</span><span class="p">.</span><span class="n">MID</span> <span class="o">=</span> <span class="n">actor_role</span><span class="p">.</span><span class="n">MID</span><span class="p">)</span>
    <span class="o">-&gt;</span> <span class="k">union</span>
    <span class="o">-&gt;</span> <span class="p">(</span><span class="k">select</span> <span class="n">name</span> <span class="k">as</span> <span class="n">name</span><span class="p">,</span> <span class="k">null</span> <span class="k">as</span> <span class="n">title</span> <span class="k">from</span>
    <span class="o">-&gt;</span> <span class="p">(</span><span class="k">select</span> <span class="n">name</span> <span class="k">from</span> <span class="n">actors</span>
    <span class="o">-&gt;</span> <span class="k">where</span> <span class="n">name</span> <span class="k">not</span> <span class="k">in</span>
    <span class="o">-&gt;</span> <span class="p">(</span><span class="k">select</span> <span class="k">distinct</span> <span class="n">name</span>
    <span class="o">-&gt;</span> <span class="k">from</span> <span class="n">actor_role</span> <span class="k">natural</span> <span class="k">join</span> <span class="n">actors</span><span class="p">)</span>
    <span class="o">-&gt;</span> <span class="p">)</span> <span class="k">as</span> <span class="n">alias1</span><span class="p">)</span>
    <span class="o">-&gt;</span> <span class="p">)</span> <span class="k">as</span> <span class="n">alias2</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-----------------+----------------+</span>
<span class="o">|</span> <span class="n">name</span>            <span class="o">|</span> <span class="n">title</span>          <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------+----------------+</span>
<span class="o">|</span> <span class="n">Charlie</span> <span class="n">Chaplin</span> <span class="o">|</span> <span class="n">City</span> <span class="n">Lights</span>    <span class="o">|</span>
<span class="o">|</span> <span class="n">Stephen</span> <span class="n">Chow</span>    <span class="o">|</span> <span class="n">Kung</span> <span class="n">Fu</span> <span class="n">Hustle</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Jay</span> <span class="n">Chou</span>        <span class="o">|</span> <span class="n">Initial</span> <span class="n">D</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">Kan</span> <span class="n">Wu</span>          <span class="o">|</span> <span class="k">NULL</span>           <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------+----------------+</span>
<span class="mi">4</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="intermediate-sql">Intermediate SQL</h2>

<p>This lab covers more complex SQL queries. A sample lab (for a 2 to 3 hour session) can be found <a href="https://www.db-book.com/db6/lab-dir/labexercises-dir/Lab2.html">here</a>.</p>

<h3 id="find-the-maximum-and-minimum-enrollment-across-all-sections-considering-only-sections-that-had-some-enrollment-dont-worry-about-those-that-had-no-students-taking-that-section">Find the maximum and minimum enrollment across all sections, considering only sections that had some enrollment, don’t worry about those that had no students taking that section</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">enrollment</span><span class="p">),</span> <span class="k">min</span><span class="p">(</span><span class="n">enrollment</span><span class="p">)</span>
    <span class="o">-&gt;</span> <span class="k">from</span> <span class="p">(</span><span class="k">select</span> <span class="n">sec_id</span><span class="p">,</span> <span class="n">semester</span><span class="p">,</span> <span class="k">year</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="k">distinct</span> <span class="n">id</span><span class="p">)</span> <span class="k">as</span> <span class="n">enrollment</span>
    <span class="o">-&gt;</span> <span class="k">from</span> <span class="n">takes</span>
    <span class="o">-&gt;</span> <span class="k">group</span> <span class="k">by</span> <span class="n">sec_id</span><span class="p">,</span> <span class="n">semester</span><span class="p">,</span> <span class="k">year</span><span class="p">)</span> <span class="k">as</span> <span class="n">alias1</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-----------------+-----------------+</span>
<span class="o">|</span> <span class="k">max</span><span class="p">(</span><span class="n">enrollment</span><span class="p">)</span> <span class="o">|</span> <span class="k">min</span><span class="p">(</span><span class="n">enrollment</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------+-----------------+</span>
<span class="o">|</span>               <span class="mi">7</span> <span class="o">|</span>               <span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------+-----------------+</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">02</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="find-all-sections-that-had-the-maximum-enrollment-along-with-the-enrollment-using-a-subquery">Find all sections that had the maximum enrollment (along with the enrollment), using a subquery</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">with</span> <span class="n">T</span><span class="p">(</span><span class="n">sec_id</span><span class="p">,</span> <span class="n">semester</span><span class="p">,</span> <span class="k">year</span><span class="p">,</span> <span class="n">enrollment</span><span class="p">)</span> <span class="k">as</span> <span class="p">(</span><span class="k">select</span> <span class="n">sec_id</span><span class="p">,</span> <span class="n">semester</span><span class="p">,</span> <span class="k">year</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="k">distinct</span> <span class="n">id</span><span class="p">)</span><span class="k">from</span> <span class="n">takes</span> <span class="k">group</span> <span class="k">by</span> <span class="n">sec_id</span><span class="p">,</span> <span class="n">semester</span><span class="p">,</span> <span class="k">year</span><span class="p">)</span>
    <span class="o">-&gt;</span> <span class="k">select</span> <span class="n">T</span><span class="p">.</span><span class="n">sec_id</span><span class="p">,</span> <span class="n">T</span><span class="p">.</span><span class="n">semester</span><span class="p">,</span> <span class="n">T</span><span class="p">.</span><span class="k">year</span><span class="p">,</span> <span class="n">T</span><span class="p">.</span><span class="n">enrollment</span> <span class="k">from</span> <span class="n">T</span><span class="p">,</span> <span class="p">(</span><span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">enrollment</span><span class="p">)</span> <span class="k">as</span> <span class="n">ma</span><span class="p">,</span> <span class="k">min</span><span class="p">(</span><span class="n">enrollment</span><span class="p">)</span> <span class="k">from</span> <span class="n">T</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp</span>
    <span class="o">-&gt;</span> <span class="k">where</span> <span class="n">T</span><span class="p">.</span><span class="n">enrollment</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="n">ma</span><span class="p">;</span>
<span class="o">+</span><span class="c1">--------+----------+------+------------+</span>
<span class="o">|</span> <span class="n">sec_id</span> <span class="o">|</span> <span class="n">semester</span> <span class="o">|</span> <span class="k">year</span> <span class="o">|</span> <span class="n">enrollment</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">--------+----------+------+------------+</span>
<span class="o">|</span> <span class="mi">1</span>      <span class="o">|</span> <span class="n">Fall</span>     <span class="o">|</span> <span class="mi">2009</span> <span class="o">|</span>          <span class="mi">7</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">--------+----------+------+------------+</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="as-in-in-q1-but-now-also-include-sections-with-no-students-taking-them-the-enrollment-for-such-sections-should-be-treated-as-0-do-this-in-two-diﬀerent-ways-and-create-require-data-for-testing">As in in Q1, but now also include sections with no students taking them; the enrollment for such sections should be treated as 0. Do this in two diﬀerent ways (and create require data for testing)</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">delete</span> <span class="k">from</span> <span class="n">course</span> <span class="k">where</span> <span class="n">course_id</span> <span class="o">=</span> <span class="s1">'CS-001'</span><span class="p">;</span>
<span class="k">delete</span> <span class="k">from</span> <span class="n">section</span> <span class="k">where</span> <span class="n">sec_id</span> <span class="o">=</span> <span class="s1">'1'</span> <span class="k">and</span> <span class="n">semester</span> <span class="o">=</span> <span class="s1">'Fall'</span> <span class="k">and</span> <span class="k">year</span> <span class="o">=</span> <span class="s1">'2010'</span><span class="p">;</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">course</span><span class="p">(</span><span class="n">course_id</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">'CS-001'</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">section</span><span class="p">(</span><span class="n">course_id</span><span class="p">,</span> <span class="n">sec_id</span><span class="p">,</span> <span class="n">semester</span><span class="p">,</span> <span class="k">year</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">'CS-001'</span><span class="p">,</span><span class="s1">'1'</span><span class="p">,</span><span class="s1">'Fall'</span><span class="p">,</span><span class="s1">'2010'</span><span class="p">);</span>
</code></pre></div></div>

<h4 id="using-a-scalar-subquery">Using a scalar subquery</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">distinct</span> <span class="n">sec_id</span><span class="p">,</span> <span class="n">semester</span><span class="p">,</span> <span class="k">year</span><span class="p">,</span> <span class="p">(</span>
    <span class="o">-&gt;</span>   <span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="k">distinct</span> <span class="n">id</span><span class="p">)</span> <span class="k">from</span> <span class="n">takes</span>
    <span class="o">-&gt;</span>   <span class="k">where</span> <span class="p">(</span>
    <span class="o">-&gt;</span>     <span class="n">takes</span><span class="p">.</span><span class="n">sec_id</span><span class="p">,</span> <span class="n">takes</span><span class="p">.</span><span class="n">semester</span><span class="p">,</span> <span class="n">takes</span><span class="p">.</span><span class="k">year</span>
    <span class="o">-&gt;</span>   <span class="p">)</span> <span class="o">=</span> <span class="p">(</span>
    <span class="o">-&gt;</span>     <span class="n">section</span><span class="p">.</span><span class="n">sec_id</span><span class="p">,</span> <span class="n">section</span><span class="p">.</span><span class="n">semester</span><span class="p">,</span> <span class="n">section</span><span class="p">.</span><span class="k">year</span><span class="p">))</span>
    <span class="o">-&gt;</span> <span class="k">as</span> <span class="n">cnt</span> <span class="k">from</span> <span class="n">section</span><span class="p">;</span>
<span class="o">+</span><span class="c1">--------+----------+------+------+</span>
<span class="o">|</span> <span class="n">sec_id</span> <span class="o">|</span> <span class="n">semester</span> <span class="o">|</span> <span class="k">year</span> <span class="o">|</span> <span class="n">cnt</span>  <span class="o">|</span>
<span class="o">+</span><span class="c1">--------+----------+------+------+</span>
<span class="o">|</span> <span class="mi">1</span>      <span class="o">|</span> <span class="n">Fall</span>     <span class="o">|</span> <span class="mi">2010</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">1</span>      <span class="o">|</span> <span class="n">Fall</span>     <span class="o">|</span> <span class="mi">2009</span> <span class="o">|</span>    <span class="mi">7</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">1</span>      <span class="o">|</span> <span class="n">Spring</span>   <span class="o">|</span> <span class="mi">2010</span> <span class="o">|</span>    <span class="mi">6</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">1</span>      <span class="o">|</span> <span class="n">Summer</span>   <span class="o">|</span> <span class="mi">2009</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">1</span>      <span class="o">|</span> <span class="n">Summer</span>   <span class="o">|</span> <span class="mi">2010</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">1</span>      <span class="o">|</span> <span class="n">Spring</span>   <span class="o">|</span> <span class="mi">2009</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">2</span>      <span class="o">|</span> <span class="n">Spring</span>   <span class="o">|</span> <span class="mi">2009</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">2</span>      <span class="o">|</span> <span class="n">Spring</span>   <span class="o">|</span> <span class="mi">2010</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">--------+----------+------+------+</span>
<span class="mi">8</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="using-aggregation-on-a-left-outer-join-use-the-sql-natural-left-outer-join-syntax">Using aggregation on a left outer join (use the SQL natural left outer join syntax)</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">distinct</span> <span class="n">sec_id</span><span class="p">,</span> <span class="n">semester</span><span class="p">,</span> <span class="k">year</span><span class="p">,</span> <span class="n">ifnull</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="o">-&gt;</span> <span class="k">from</span> <span class="n">section</span> <span class="k">left</span> <span class="k">outer</span> <span class="k">join</span> <span class="p">(</span>
    <span class="o">-&gt;</span>   <span class="k">select</span> <span class="n">sec_id</span><span class="p">,</span> <span class="n">semester</span><span class="p">,</span> <span class="k">year</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="k">distinct</span> <span class="n">id</span><span class="p">)</span> <span class="k">as</span> <span class="n">cnt</span>
    <span class="o">-&gt;</span>   <span class="k">from</span> <span class="n">takes</span> <span class="k">group</span> <span class="k">by</span> <span class="n">sec_id</span><span class="p">,</span> <span class="n">semester</span><span class="p">,</span> <span class="k">year</span><span class="p">)</span> <span class="k">as</span> <span class="n">T</span>
    <span class="o">-&gt;</span> <span class="k">using</span> <span class="p">(</span><span class="n">sec_id</span><span class="p">,</span> <span class="n">semester</span><span class="p">,</span> <span class="k">year</span><span class="p">);</span>
<span class="o">+</span><span class="c1">--------+----------+------+---------------+</span>
<span class="o">|</span> <span class="n">sec_id</span> <span class="o">|</span> <span class="n">semester</span> <span class="o">|</span> <span class="k">year</span> <span class="o">|</span> <span class="n">ifnull</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">--------+----------+------+---------------+</span>
<span class="o">|</span> <span class="mi">1</span>      <span class="o">|</span> <span class="n">Fall</span>     <span class="o">|</span> <span class="mi">2010</span> <span class="o">|</span>             <span class="mi">0</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">1</span>      <span class="o">|</span> <span class="n">Fall</span>     <span class="o">|</span> <span class="mi">2009</span> <span class="o">|</span>             <span class="mi">7</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">1</span>      <span class="o">|</span> <span class="n">Spring</span>   <span class="o">|</span> <span class="mi">2010</span> <span class="o">|</span>             <span class="mi">6</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">1</span>      <span class="o">|</span> <span class="n">Summer</span>   <span class="o">|</span> <span class="mi">2009</span> <span class="o">|</span>             <span class="mi">1</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">1</span>      <span class="o">|</span> <span class="n">Summer</span>   <span class="o">|</span> <span class="mi">2010</span> <span class="o">|</span>             <span class="mi">1</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">1</span>      <span class="o">|</span> <span class="n">Spring</span>   <span class="o">|</span> <span class="mi">2009</span> <span class="o">|</span>             <span class="mi">1</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">2</span>      <span class="o">|</span> <span class="n">Spring</span>   <span class="o">|</span> <span class="mi">2009</span> <span class="o">|</span>             <span class="mi">2</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">2</span>      <span class="o">|</span> <span class="n">Spring</span>   <span class="o">|</span> <span class="mi">2010</span> <span class="o">|</span>             <span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">--------+----------+------+---------------+</span>
<span class="mi">8</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="find-all-courses-whose-identifier-starts-with-the-string-cs-1">Find all courses whose identifier starts with the string ”CS-1”</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">course_id</span><span class="p">,</span> <span class="n">title</span>
    <span class="o">-&gt;</span> <span class="k">from</span> <span class="n">section</span> <span class="k">natural</span> <span class="k">join</span> <span class="n">course</span>
    <span class="o">-&gt;</span> <span class="k">where</span> <span class="n">course_id</span> <span class="k">like</span> <span class="s1">'CS-1%'</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-----------+----------------------------+</span>
<span class="o">|</span> <span class="n">course_id</span> <span class="o">|</span> <span class="n">title</span>                      <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------+----------------------------+</span>
<span class="o">|</span> <span class="n">CS</span><span class="o">-</span><span class="mi">101</span>    <span class="o">|</span> <span class="n">Intro</span><span class="p">.</span> <span class="k">to</span> <span class="n">Computer</span> <span class="n">Science</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">CS</span><span class="o">-</span><span class="mi">101</span>    <span class="o">|</span> <span class="n">Intro</span><span class="p">.</span> <span class="k">to</span> <span class="n">Computer</span> <span class="n">Science</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">CS</span><span class="o">-</span><span class="mi">190</span>    <span class="o">|</span> <span class="n">Game</span> <span class="n">Design</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">CS</span><span class="o">-</span><span class="mi">190</span>    <span class="o">|</span> <span class="n">Game</span> <span class="n">Design</span>                <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------+----------------------------+</span>
<span class="mi">4</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="find-instructors-who-have-taught-all-the-above-courses">Find instructors who have taught all the above courses</h3>

<h4 id="using-the-not-exists--except--structure">Using the ”not exists … except …” structure</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">distinct</span> <span class="n">ID</span><span class="p">,</span> <span class="n">name</span> <span class="k">from</span> <span class="p">(</span>
    <span class="o">-&gt;</span>   <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">teaches</span> <span class="k">natural</span> <span class="k">join</span> <span class="n">instructor</span><span class="p">)</span>
    <span class="o">-&gt;</span> <span class="k">as</span> <span class="n">T</span> <span class="k">where</span> <span class="k">not</span> <span class="k">exists</span> <span class="p">(</span>
    <span class="o">-&gt;</span>   <span class="k">select</span> <span class="n">cs_course</span><span class="p">.</span><span class="n">course_id</span> <span class="k">from</span> <span class="p">(</span>
    <span class="o">-&gt;</span>     <span class="k">select</span> <span class="n">course_id</span> <span class="k">from</span> <span class="n">course</span>
    <span class="o">-&gt;</span>     <span class="k">where</span> <span class="n">course_id</span> <span class="k">like</span> <span class="s1">'CS-1%'</span><span class="p">)</span>
    <span class="o">-&gt;</span>   <span class="k">as</span> <span class="n">cs_course</span> <span class="k">where</span> <span class="n">cs_course</span><span class="p">.</span><span class="n">course_id</span> <span class="k">not</span> <span class="k">in</span> <span class="p">(</span>
    <span class="o">-&gt;</span>     <span class="k">select</span> <span class="n">course_id</span> <span class="k">from</span> <span class="p">(</span>
    <span class="o">-&gt;</span>       <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">teaches</span> <span class="k">natural</span> <span class="k">join</span> <span class="n">instructor</span><span class="p">)</span>
    <span class="o">-&gt;</span>     <span class="k">as</span> <span class="n">S</span> <span class="k">where</span> <span class="n">S</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">T</span><span class="p">.</span><span class="n">name</span><span class="p">));</span>
<span class="n">Empty</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="using-matching-of-counts-which-we-covered-in-class-dont-forget-the-distinct-clause">Using matching of counts which we covered in class (don’t forget the distinct clause!)</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">with</span> <span class="n">S</span><span class="p">(</span><span class="n">course_id</span><span class="p">)</span> <span class="k">as</span> <span class="p">(</span>
    <span class="o">-&gt;</span>   <span class="k">select</span> <span class="k">distinct</span> <span class="n">course_id</span>
    <span class="o">-&gt;</span>   <span class="k">from</span> <span class="n">teaches</span> <span class="k">natural</span> <span class="k">join</span> <span class="n">instructor</span>
    <span class="o">-&gt;</span>   <span class="k">where</span> <span class="n">course_id</span> <span class="k">like</span> <span class="s1">'CS-1%'</span><span class="p">)</span>
    <span class="o">-&gt;</span> <span class="k">select</span> <span class="k">distinct</span> <span class="n">ID</span><span class="p">,</span> <span class="n">name</span> <span class="k">from</span> <span class="p">(</span>
    <span class="o">-&gt;</span>   <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">teaches</span> <span class="k">natural</span> <span class="k">join</span> <span class="n">instructor</span><span class="p">)</span> <span class="k">as</span> <span class="n">T</span>
    <span class="o">-&gt;</span> <span class="k">where</span> <span class="p">((</span><span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="n">course_id</span><span class="p">)</span> <span class="k">from</span> <span class="n">S</span><span class="p">)</span><span class="o">=</span><span class="p">(</span>
    <span class="o">-&gt;</span>   <span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="k">distinct</span> <span class="n">course_id</span><span class="p">)</span>
    <span class="o">-&gt;</span>   <span class="k">from</span> <span class="n">teaches</span> <span class="k">natural</span> <span class="k">join</span> <span class="n">instructor</span>
    <span class="o">-&gt;</span>   <span class="k">where</span> <span class="n">name</span> <span class="o">=</span> <span class="n">T</span><span class="p">.</span><span class="n">name</span> <span class="k">and</span> <span class="n">course_id</span> <span class="k">like</span> <span class="s1">'CS-1%'</span>
    <span class="o">-&gt;</span> <span class="p">));</span>
<span class="n">Empty</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="insert-each-instructor-as-a-student-with-tot-creds--0-in-the-same-department">Insert each instructor as a student, with tot creds = 0, in the same department</h3>

<p>这里报错是因为学生ID和教师ID冲突。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">insert</span> <span class="k">into</span> <span class="n">student</span>
    <span class="o">-&gt;</span> <span class="k">select</span> <span class="n">ID</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dept_name</span><span class="p">,</span> <span class="s1">'0'</span>
    <span class="o">-&gt;</span> <span class="k">from</span> <span class="n">instructor</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1062</span> <span class="p">(</span><span class="mi">23000</span><span class="p">):</span> <span class="n">Duplicate</span> <span class="n">entry</span> <span class="s1">'76543'</span> <span class="k">for</span> <span class="k">key</span> <span class="s1">'PRIMARY'</span>
</code></pre></div></div>

<h3 id="now-delete-all-the-newly-added-students-above-note-already-existing-students-who-happened-to-have-tot-creds--0-should-not-get-deleted">Now delete all the newly added ”students” above (note: already existing students who happened to have tot creds = 0 should not get deleted)</h3>

<p>因为上一问报错了，因此这一问实际上什么都没删除。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">delete</span> <span class="k">from</span> <span class="n">student</span>
    <span class="o">-&gt;</span> <span class="k">where</span> <span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dept_name</span><span class="p">)</span> <span class="k">in</span> <span class="p">(</span>
    <span class="o">-&gt;</span>   <span class="k">select</span> <span class="n">ID</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dept_name</span>
    <span class="o">-&gt;</span>   <span class="k">from</span> <span class="n">instructor</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="some-of-you-may-have-noticed-that-the-tot-creds-value-for-students-did-not-match-the-credits-from-courses-they-have-taken-write-and-execute-query-to-update-tot-creds-based-on-the-credits-passed-to-bring-the-database-back-to-consistency-this-query-is-provided-in-the-bookslides">Some of you may have noticed that the tot creds value for students did not match the credits from courses they have taken. Write and execute query to update tot creds based on the credits passed, to bring the database back to consistency. (This query is provided in the book/slides.)</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">update</span> <span class="n">student</span> <span class="k">as</span> <span class="n">S</span> <span class="k">set</span> <span class="n">tot_cred</span> <span class="o">=</span> <span class="p">(</span>
    <span class="o">-&gt;</span>   <span class="k">select</span> <span class="k">sum</span><span class="p">(</span><span class="n">credits</span><span class="p">)</span>
    <span class="o">-&gt;</span>   <span class="k">from</span> <span class="n">takes</span> <span class="k">natural</span> <span class="k">join</span> <span class="n">course</span>
    <span class="o">-&gt;</span>   <span class="k">where</span> <span class="n">S</span><span class="p">.</span><span class="n">ID</span> <span class="o">=</span> <span class="n">takes</span><span class="p">.</span><span class="n">ID</span> <span class="k">and</span> <span class="n">takes</span><span class="p">.</span><span class="n">grade</span> <span class="k">is</span> <span class="k">not</span> <span class="k">null</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">13</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">03</span> <span class="n">sec</span><span class="p">)</span>
<span class="k">Rows</span> <span class="n">matched</span><span class="p">:</span> <span class="mi">13</span>  <span class="n">Changed</span><span class="p">:</span> <span class="mi">13</span>  <span class="n">Warnings</span><span class="p">:</span> <span class="mi">0</span>
</code></pre></div></div>

<h3 id="update-the-salary-of-each-instructor-to-10000-times-the-number-of-course-sections-they-have-taught">Update the salary of each instructor to 10000 times the number of course sections they have taught</h3>

<p>这一步出现报错，和数据库的约束条件冲突。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">update</span> <span class="n">instructor</span> <span class="k">as</span> <span class="n">I</span> <span class="k">set</span> <span class="n">salary</span> <span class="o">=</span> <span class="mi">10000</span> <span class="o">*</span> <span class="p">(</span>
    <span class="o">-&gt;</span>   <span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="k">distinct</span> <span class="n">sec_id</span><span class="p">,</span> <span class="n">semester</span><span class="p">,</span> <span class="k">year</span><span class="p">)</span>
    <span class="o">-&gt;</span>   <span class="k">from</span> <span class="n">teaches</span> <span class="k">as</span> <span class="n">T</span> <span class="k">where</span> <span class="n">I</span><span class="p">.</span><span class="n">ID</span> <span class="o">=</span> <span class="n">T</span><span class="p">.</span><span class="n">ID</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">3819</span> <span class="p">(</span><span class="n">HY000</span><span class="p">):</span> <span class="k">Check</span> <span class="k">constraint</span> <span class="s1">'instructor_chk_1'</span> <span class="k">is</span> <span class="n">violated</span><span class="p">.</span>
</code></pre></div></div>

<h3 id="create-your-own-query-define-what-you-want-to-do-in-english-then-write-the-query-in-sql-make-it-as-difficult-as-you-wish-the-harder-the-better">Create your own query: define what you want to do in English, then write the query in SQL. Make it as difficult as you wish, the harder the better</h3>

<p>这里统计的是上过任何一门由计算机系开设课程的学生数量。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="n">S</span><span class="p">.</span><span class="n">name</span><span class="p">)</span> <span class="k">from</span> <span class="n">student</span> <span class="k">as</span> <span class="n">S</span><span class="p">,(</span>
    <span class="o">-&gt;</span>   <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">takes</span> <span class="k">natural</span> <span class="k">join</span> <span class="n">course</span><span class="p">)</span> <span class="k">as</span> <span class="k">C</span>
    <span class="o">-&gt;</span> <span class="k">where</span> <span class="n">S</span><span class="p">.</span><span class="n">ID</span> <span class="o">=</span> <span class="k">C</span><span class="p">.</span><span class="n">ID</span> <span class="k">and</span> <span class="k">C</span><span class="p">.</span><span class="n">dept_name</span> <span class="o">=</span> <span class="s1">'Comp. Sci.'</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------------+</span>
<span class="o">|</span> <span class="k">count</span><span class="p">(</span><span class="n">S</span><span class="p">.</span><span class="n">name</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------+</span>
<span class="o">|</span>            <span class="mi">15</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------+</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>
