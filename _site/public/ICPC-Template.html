<!DOCTYPE html>

<head>
  <title>
     &middot; wu-kan
  </title>
</head>

<body>
  
  <h1>
    <a href="/posts/acm/template/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">
      数据结构
    </a>
  </h1>
  <p>以下数据结构均采用ll作为值类型，应用时根据需求调整。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">ll</span><span class="p">;</span>
<span class="k">const</span> <span class="n">ll</span> <span class="n">INF</span> <span class="o">=</span> <span class="mf">1e9</span><span class="p">;</span>  <span class="c1">//表示（值）正无穷，且两个正无穷相加不会溢出
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">NPOS</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">//表示（下标）不存在
</span></code></pre></div></div>

<h2 id="离散化">离散化</h2>

<p>在vector基础上的离散化，使用push_back()向其中插值，init()排序并离散化，ask查询离散化之后的值，at/[]运算符查离散前的值。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Ranker</span> <span class="o">:</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span>
<span class="p">{</span>
	<span class="kt">void</span> <span class="n">init</span><span class="p">()</span> <span class="p">{</span> <span class="n">sort</span><span class="p">(</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span><span class="p">()),</span> <span class="n">resize</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span><span class="p">())</span> <span class="o">-</span> <span class="n">begin</span><span class="p">());</span> <span class="p">}</span>
	<span class="kt">int</span> <span class="n">ask</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">lower_bound</span><span class="p">(</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span><span class="p">(),</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">begin</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="并查集">并查集</h2>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">UnionfindSet</span> <span class="o">:</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span>
<span class="p">{</span>
	<span class="n">UnionfindSet</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">merge</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">w</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">ask</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="n">u</span> <span class="o">=</span> <span class="n">ask</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">w</span> <span class="o">!=</span> <span class="n">u</span><span class="p">)</span>
			<span class="n">at</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">at</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">!=</span> <span class="n">u</span> <span class="o">?</span> <span class="n">at</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">=</span> <span class="n">ask</span><span class="p">(</span><span class="n">at</span><span class="p">(</span><span class="n">u</span><span class="p">))</span> <span class="o">:</span> <span class="n">u</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="单调队列和单调栈">单调队列和单调栈</h2>

<p><a href="https://vjudge.net/solution/18456407">使用示例</a></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">ll</span><span class="o">&gt;</span> <span class="n">pil</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">Monotone</span> <span class="o">:</span> <span class="n">deque</span><span class="o">&lt;</span><span class="n">pil</span><span class="o">&gt;</span>
<span class="p">{</span>
	<span class="kt">void</span> <span class="n">push</span><span class="p">(</span><span class="k">const</span> <span class="n">pil</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">back</span><span class="p">().</span><span class="n">second</span> <span class="o">&gt;=</span> <span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="p">)</span>
			<span class="n">pop_back</span><span class="p">();</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="n">p</span><span class="p">.</span><span class="n">first</span> <span class="o">-</span> <span class="n">front</span><span class="p">().</span><span class="n">first</span> <span class="o">&gt;=</span> <span class="n">k</span><span class="p">;)</span>
			<span class="n">pop_front</span><span class="p">();</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="st表">ST表</h2>

<p><a href="https://vjudge.net/solution/14470893">使用示例</a></p>

<p>$O(n\log n)$预处理，$O(1)$求静态区间最小值。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
//可选优化
#define log2(n) LOG2[n]
struct Log : vector&lt;ll&gt;
{
	Log(int N, ll E) : vector&lt;ll&gt;(N, -1)
	{
		for (int i = 1; i &lt; N; ++i)
			at(i) = at(i / E) + 1;
	}
} LOG2(N, 2);
*/</span>
<span class="k">struct</span> <span class="n">SparseTable</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;&gt;</span> <span class="n">f</span><span class="p">;</span>
	<span class="n">SparseTable</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">)</span> <span class="o">:</span> <span class="n">f</span><span class="p">(</span><span class="n">log2</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">f</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">k</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="n">f</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">k</span><span class="p">)]);</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="n">log2</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">k</span><span class="p">)]);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="树状数组">树状数组</h2>

<p>模板中Base是对应的基础版本，支持单点修改区间查询。</p>

<h3 id="一维">一维</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Fenwick</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">BaseFenwick</span>
	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
		<span class="n">BaseFenwick</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">v</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
		<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">ll</span> <span class="n">w</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">for</span> <span class="p">(;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">x</span> <span class="o">+=</span> <span class="n">x</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">x</span><span class="p">)</span>
				<span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+=</span> <span class="n">w</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">ll</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">ll</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(;</span> <span class="n">x</span><span class="p">;</span> <span class="n">x</span> <span class="o">-=</span> <span class="n">x</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">x</span><span class="p">)</span>
				<span class="n">ans</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
			<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">};</span>
	<span class="n">pair</span><span class="o">&lt;</span><span class="n">BaseFenwick</span><span class="p">,</span> <span class="n">BaseFenwick</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">;</span>
	<span class="n">Fenwick</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">p</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">ll</span> <span class="n">w</span><span class="p">)</span> <span class="p">{</span> <span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="p">),</span> <span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="n">w</span><span class="p">);</span> <span class="p">}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="n">ll</span> <span class="n">w</span><span class="p">)</span> <span class="p">{</span> <span class="n">add</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">w</span><span class="p">),</span> <span class="n">add</span><span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">w</span><span class="p">);</span> <span class="p">}</span>
	<span class="n">ll</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="p">}</span>
	<span class="n">ll</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ask</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">ask</span><span class="p">(</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="二维">二维</h3>

<p>高维的数据结构只要每一维维护低一维的数据（树套树）即可。其余数据结构亦同理。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Fenwick2</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">BaseFenwick2</span>
	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">Fenwick</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
		<span class="n">BaseFenwick2</span><span class="p">(</span><span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">)</span> <span class="o">:</span> <span class="n">v</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="p">{}</span>
		<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">,</span> <span class="n">ll</span> <span class="n">w</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">for</span> <span class="p">(;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">x</span> <span class="o">+=</span> <span class="n">x</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">x</span><span class="p">)</span>
				<span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">ll</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">ll</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(;</span> <span class="n">x</span><span class="p">;</span> <span class="n">x</span> <span class="o">-=</span> <span class="n">x</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">x</span><span class="p">)</span>
				<span class="n">ans</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">ask</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">};</span>
	<span class="n">pair</span><span class="o">&lt;</span><span class="n">BaseFenwick2</span><span class="p">,</span> <span class="n">BaseFenwick2</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">;</span>
	<span class="n">Fenwick2</span><span class="p">(</span><span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">)</span> <span class="o">:</span> <span class="n">p</span><span class="p">(</span><span class="n">BaseFenwick2</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="n">BaseFenwick2</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">,</span> <span class="n">ll</span> <span class="n">w</span><span class="p">)</span> <span class="p">{</span> <span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">),</span> <span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="n">w</span><span class="p">);</span> <span class="p">}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">,</span> <span class="n">ll</span> <span class="n">w</span><span class="p">)</span> <span class="p">{</span> <span class="n">add</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">),</span> <span class="n">add</span><span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="n">w</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//(l,b)~(r,t)
</span>	<span class="n">ll</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span> <span class="p">}</span>
	<span class="n">ll</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ask</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">ask</span><span class="p">(</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span> <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="动态开点线段树">动态开点线段树</h2>

<p><a href="https://vjudge.net/solution/21600921">使用示例</a>，支持区间线性变换、区间查询（最大值最小值区间和）。</p>

<p>这样写改可持久化也很方便，只要改<code class="highlighter-rouge">down</code>函数为每次都新建节点即可，<a href="https://vjudge.net/solution/21600829">示例</a>。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">SegmentTree</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">Seg</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">;</span>
		<span class="n">ll</span> <span class="n">min</span><span class="p">,</span> <span class="n">max</span><span class="p">,</span> <span class="n">sum</span><span class="p">;</span>
		<span class="kt">void</span> <span class="nf">upd</span><span class="p">(</span><span class="n">ll</span> <span class="n">mul</span><span class="p">,</span> <span class="n">ll</span> <span class="n">add</span><span class="p">)</span> <span class="p">{</span> <span class="n">min</span> <span class="o">=</span> <span class="n">min</span> <span class="o">*</span> <span class="n">mul</span> <span class="o">+</span> <span class="n">add</span><span class="p">,</span> <span class="n">max</span> <span class="o">=</span> <span class="n">max</span> <span class="o">*</span> <span class="n">mul</span> <span class="o">+</span> <span class="n">add</span><span class="p">,</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">sum</span> <span class="o">*</span> <span class="n">mul</span> <span class="o">+</span> <span class="n">add</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> <span class="p">}</span>
		<span class="k">friend</span> <span class="n">Seg</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span> <span class="n">Seg</span> <span class="o">&amp;</span><span class="n">lc</span><span class="p">,</span> <span class="k">const</span> <span class="n">Seg</span> <span class="o">&amp;</span><span class="n">rc</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">{</span><span class="n">lc</span><span class="p">.</span><span class="n">l</span><span class="p">,</span> <span class="n">rc</span><span class="p">.</span><span class="n">r</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">lc</span><span class="p">.</span><span class="n">min</span><span class="p">,</span> <span class="n">rc</span><span class="p">.</span><span class="n">min</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">lc</span><span class="p">.</span><span class="n">max</span><span class="p">,</span> <span class="n">rc</span><span class="p">.</span><span class="n">max</span><span class="p">),</span> <span class="n">lc</span><span class="p">.</span><span class="n">sum</span> <span class="o">+</span> <span class="n">rc</span><span class="p">.</span><span class="n">sum</span><span class="p">};</span> <span class="p">}</span>
	<span class="p">};</span>
	<span class="k">struct</span> <span class="n">Node</span> <span class="o">:</span> <span class="n">Seg</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">lc</span><span class="p">,</span> <span class="n">rc</span><span class="p">;</span>
		<span class="n">ll</span> <span class="n">mul</span><span class="p">,</span> <span class="n">add</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
	<span class="n">SegmentTree</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span> <span class="n">build</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span> <span class="p">}</span>
	<span class="kt">void</span> <span class="n">build</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">rt</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
		<span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">({});</span>
		<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">Seg</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">({</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">});</span>
		<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">lc</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">rc</span> <span class="o">=</span> <span class="n">NPOS</span><span class="p">;</span>
		<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">add</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="c1">//if (l &lt; r) //动态开点的时候注释掉本行和下一行
</span>		<span class="c1">//down(rt), v[rt].Seg::operator=(v[v[rt].lc] + v[v[rt].rc]);
</span>	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">down</span><span class="p">(</span><span class="kt">int</span> <span class="n">rt</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">l</span> <span class="o">+</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">r</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">l</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">lc</span> <span class="o">==</span> <span class="n">NPOS</span><span class="p">)</span>
			<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">lc</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">build</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">);</span>
		<span class="c1">//else //非可持久化的时候注释掉本行和下一行
</span>		<span class="c1">//v.push_back(v[v[rt].lc]), v[rt].lc = v.size() - 1;
</span>		<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">rc</span> <span class="o">==</span> <span class="n">NPOS</span><span class="p">)</span>
			<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">rc</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">build</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">r</span><span class="p">);</span>
		<span class="c1">//else //非可持久化的时候注释掉本行和下一行
</span>		<span class="c1">//v.push_back(v[v[rt].rc]), v[rt].rc = v.size() - 1;
</span>		<span class="n">upd</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">lc</span><span class="p">].</span><span class="n">l</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">lc</span><span class="p">].</span><span class="n">r</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">mul</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">add</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">lc</span><span class="p">);</span>
		<span class="n">upd</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">rc</span><span class="p">].</span><span class="n">l</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">rc</span><span class="p">].</span><span class="n">r</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">mul</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">add</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">rc</span><span class="p">);</span>
		<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">add</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">upd</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="n">ll</span> <span class="n">mul</span><span class="p">,</span> <span class="n">ll</span> <span class="n">add</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">mul</span> <span class="o">*=</span> <span class="n">mul</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">add</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">add</span> <span class="o">*</span> <span class="n">mul</span> <span class="o">+</span> <span class="n">add</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">upd</span><span class="p">(</span><span class="n">mul</span><span class="p">,</span> <span class="n">add</span><span class="p">);</span>
		<span class="n">down</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">lc</span><span class="p">].</span><span class="n">r</span><span class="p">)</span>
			<span class="n">upd</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">mul</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">lc</span><span class="p">);</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">rc</span><span class="p">].</span><span class="n">l</span><span class="p">)</span>
			<span class="n">upd</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">mul</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">rc</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">upd</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">lc</span><span class="p">].</span><span class="n">r</span><span class="p">,</span> <span class="n">mul</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">lc</span><span class="p">),</span> <span class="n">upd</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">rc</span><span class="p">].</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">mul</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">rc</span><span class="p">);</span>
		<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">Seg</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">lc</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">rc</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="n">Seg</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">];</span>
		<span class="n">down</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">lc</span><span class="p">].</span><span class="n">r</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">ask</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">lc</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">rc</span><span class="p">].</span><span class="n">l</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">ask</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">rc</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">ask</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">lc</span><span class="p">].</span><span class="n">r</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">lc</span><span class="p">)</span> <span class="o">+</span> <span class="n">ask</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">rc</span><span class="p">].</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">rc</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="无旋treap">无旋Treap</h2>

<h3 id="按子树大小分裂">按子树大小分裂</h3>

<p><a href="https://vjudge.net/solution/18405379">使用示例</a></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">FhqTreap</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">Node</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">ch</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">siz</span><span class="p">,</span> <span class="n">rev</span><span class="p">;</span>
		<span class="n">ll</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">min</span><span class="p">,</span> <span class="n">add</span><span class="p">;</span>
		<span class="kt">void</span> <span class="nf">upd</span><span class="p">(</span><span class="n">ll</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">val</span> <span class="o">+=</span> <span class="n">v</span><span class="p">,</span> <span class="n">min</span> <span class="o">+=</span> <span class="n">v</span><span class="p">,</span> <span class="n">add</span> <span class="o">+=</span> <span class="n">v</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
				<span class="n">rev</span> <span class="o">^=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">swap</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">};</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">root</span><span class="p">;</span>
	<span class="n">FhqTreap</span><span class="p">()</span> <span class="o">:</span> <span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">root</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">down</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">k</span><span class="p">)</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">ch</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">ch</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="n">v</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">i</span><span class="p">]].</span><span class="n">upd</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">add</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">rev</span><span class="p">);</span>
		<span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">add</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">rev</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">up</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">k</span><span class="p">)</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">siz</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">min</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">val</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">ch</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">ch</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">siz</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">i</span><span class="p">]].</span><span class="n">siz</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">min</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">min</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">i</span><span class="p">]].</span><span class="n">min</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">merge</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">a</span> <span class="o">||</span> <span class="o">!</span><span class="n">b</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">a</span><span class="p">].</span><span class="n">key</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">b</span><span class="p">].</span><span class="n">key</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">down</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">v</span><span class="p">[</span><span class="n">a</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">a</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">b</span><span class="p">),</span> <span class="n">up</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">a</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">down</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">v</span><span class="p">[</span><span class="n">b</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">b</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">up</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">b</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">split</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">s</span><span class="p">)</span>
			<span class="n">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">a</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="n">siz</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">)</span>
			<span class="n">down</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">split</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">a</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">a</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="n">siz</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">a</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="p">),</span> <span class="n">up</span><span class="p">(</span><span class="n">l</span> <span class="o">=</span> <span class="n">a</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">down</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">split</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">a</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">a</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">up</span><span class="p">(</span><span class="n">r</span> <span class="o">=</span> <span class="n">a</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">push_back</span><span class="p">(</span><span class="n">ll</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Node</span><span class="p">{{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rand</span><span class="p">(),</span> <span class="n">d</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">d</span><span class="p">}),</span> <span class="n">root</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> <span class="p">}</span>
	<span class="kt">void</span> <span class="n">insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">ll</span> <span class="n">d</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Node</span><span class="p">{{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rand</span><span class="p">(),</span> <span class="n">d</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">d</span><span class="p">});</span>
		<span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
		<span class="n">split</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">root</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">merge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">b</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">erase</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
		<span class="n">split</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">split</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="n">root</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">Node</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
		<span class="n">split</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="n">split</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
		<span class="n">Node</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">b</span><span class="p">];</span>
		<span class="k">return</span> <span class="n">root</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">merge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">c</span><span class="p">),</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">upd</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="n">ll</span> <span class="n">add</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rev</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
		<span class="n">split</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="n">split</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">v</span><span class="p">[</span><span class="n">b</span><span class="p">].</span><span class="n">upd</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">rev</span><span class="p">),</span> <span class="n">root</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">merge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">c</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">revolve</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">d</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">split</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="n">split</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">split</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="n">d</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span> <span class="o">%</span> <span class="n">e</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span> <span class="n">root</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">merge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">merge</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">b</span><span class="p">)),</span> <span class="n">c</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="按值大小分裂">按值大小分裂</h3>

<p><a href="https://vjudge.net/solution/18405431">使用示例</a>，即排序树。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">FhqTreap</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">Node</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">ch</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">siz</span><span class="p">;</span>
		<span class="n">ll</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">root</span><span class="p">;</span>
	<span class="n">FhqTreap</span><span class="p">()</span> <span class="o">:</span> <span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">root</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">up</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span> <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">siz</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="n">siz</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">]].</span><span class="n">siz</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
	<span class="kt">int</span> <span class="n">merge</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">a</span> <span class="o">||</span> <span class="o">!</span><span class="n">b</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">a</span><span class="p">].</span><span class="n">key</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">b</span><span class="p">].</span><span class="n">key</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">a</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">a</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">b</span><span class="p">),</span> <span class="n">up</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">a</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">b</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">b</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">up</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">b</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">splitVal</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">ll</span> <span class="n">w</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">)</span> <span class="c1">//按值将树划分，使得左子树上的值恰小于w
</span>	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">a</span><span class="p">)</span>
			<span class="n">l</span> <span class="o">=</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">a</span><span class="p">].</span><span class="n">val</span> <span class="o">&gt;</span> <span class="n">w</span><span class="p">)</span>
			<span class="n">splitVal</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">a</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">w</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">a</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">up</span><span class="p">(</span><span class="n">r</span> <span class="o">=</span> <span class="n">a</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">splitVal</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">a</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">w</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">a</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="p">),</span> <span class="n">up</span><span class="p">(</span><span class="n">l</span> <span class="o">=</span> <span class="n">a</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">insert</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
		<span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Node</span><span class="p">{{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="mi">1</span><span class="p">,</span> <span class="n">rand</span><span class="p">(),</span> <span class="n">x</span><span class="p">}),</span> <span class="n">splitVal</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">root</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">merge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">b</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">erase</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
		<span class="n">splitVal</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">splitVal</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="n">root</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">merge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">merge</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">c</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="n">c</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">b</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">kth</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">root</span><span class="p">,</span> <span class="n">ls</span><span class="p">;;)</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ls</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="n">siz</span><span class="p">,</span> <span class="n">ls</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">k</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">val</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ls</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">)</span>
				<span class="n">k</span> <span class="o">-=</span> <span class="n">ls</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
			<span class="k">else</span>
				<span class="n">u</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">lower_bound</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">upper_bound</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> <span class="p">}</span>
	<span class="kt">int</span> <span class="n">upper_bound</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">ret</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">splitVal</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">a</span><span class="p">].</span><span class="n">siz</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="莫队">莫队</h2>

<p><a href="https://vjudge.net/solution/14265915">使用示例</a></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Mo</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">Query</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">id</span><span class="p">;</span>
		<span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">)</span> <span class="k">const</span>
		<span class="p">{</span>
			<span class="k">return</span> <span class="n">l</span> <span class="o">/</span> <span class="n">BS</span> <span class="o">!=</span> <span class="n">n</span><span class="p">.</span><span class="n">l</span> <span class="o">/</span> <span class="n">BS</span> <span class="o">?</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">.</span><span class="n">l</span> <span class="o">:</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">.</span><span class="n">r</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">};</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Query</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">;</span>
	<span class="kt">void</span> <span class="nf">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span> <span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Query</span><span class="p">{</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">q</span><span class="p">.</span><span class="n">size</span><span class="p">()});</span> <span class="p">}</span>
	<span class="kt">void</span> <span class="nf">rev</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="nf">cal</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="nf">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">L</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">sort</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">q</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">L</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">)</span>
				<span class="n">rev</span><span class="p">(</span><span class="n">L</span><span class="o">++</span><span class="p">);</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">L</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">)</span>
				<span class="n">rev</span><span class="p">(</span><span class="o">--</span><span class="n">L</span><span class="p">);</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">R</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="p">)</span>
				<span class="n">rev</span><span class="p">(</span><span class="o">++</span><span class="n">R</span><span class="p">);</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">R</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="p">)</span>
				<span class="n">rev</span><span class="p">(</span><span class="n">R</span><span class="o">--</span><span class="p">);</span>
			<span class="n">cal</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="带修莫队">带修莫队</h3>

<p><a href="https://vjudge.net/solution/14269038">使用示例</a></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Mo</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">Update</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">pos</span><span class="p">,</span> <span class="n">NEW</span><span class="p">,</span> <span class="n">OLD</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="k">struct</span> <span class="n">Query</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">t</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">id</span><span class="p">;</span>
		<span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">)</span> <span class="k">const</span>
		<span class="p">{</span>
			<span class="k">return</span> <span class="n">l</span> <span class="o">/</span> <span class="n">BS</span> <span class="o">!=</span> <span class="n">n</span><span class="p">.</span><span class="n">l</span> <span class="o">/</span> <span class="n">BS</span> <span class="o">?</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">.</span><span class="n">l</span> <span class="o">:</span> <span class="n">r</span> <span class="o">/</span> <span class="n">BS</span> <span class="o">!=</span> <span class="n">n</span><span class="p">.</span><span class="n">r</span> <span class="o">/</span> <span class="n">BS</span> <span class="o">?</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">.</span><span class="n">r</span> <span class="o">:</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">.</span><span class="n">t</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">};</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Update</span><span class="o">&gt;</span> <span class="n">cq</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Query</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">T</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">;</span>
	<span class="n">Mo</span><span class="p">()</span> <span class="o">:</span> <span class="n">cq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Query</span><span class="p">{</span><span class="n">cq</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">q</span><span class="p">.</span><span class="n">size</span><span class="p">()});</span> <span class="p">}</span>
	<span class="kt">void</span> <span class="n">update</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="n">cq</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Update</span><span class="p">{</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">]}),</span> <span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>
	<span class="kt">void</span> <span class="n">set</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">d</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
			<span class="k">return</span> <span class="n">rev</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">,</span> <span class="n">rev</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
		<span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">rev</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">cal</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">T</span> <span class="o">=</span> <span class="n">L</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">sort</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">q</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">T</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">t</span><span class="p">)</span>
				<span class="o">++</span><span class="n">T</span><span class="p">,</span> <span class="n">set</span><span class="p">(</span><span class="n">cq</span><span class="p">[</span><span class="n">T</span><span class="p">].</span><span class="n">pos</span><span class="p">,</span> <span class="n">cq</span><span class="p">[</span><span class="n">T</span><span class="p">].</span><span class="n">NEW</span><span class="p">);</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">T</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">t</span><span class="p">)</span>
				<span class="n">set</span><span class="p">(</span><span class="n">cq</span><span class="p">[</span><span class="n">T</span><span class="p">].</span><span class="n">pos</span><span class="p">,</span> <span class="n">cq</span><span class="p">[</span><span class="n">T</span><span class="p">].</span><span class="n">OLD</span><span class="p">),</span> <span class="o">--</span><span class="n">T</span><span class="p">;</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">L</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">)</span>
				<span class="n">rev</span><span class="p">(</span><span class="n">L</span><span class="o">++</span><span class="p">);</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">L</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">)</span>
				<span class="n">rev</span><span class="p">(</span><span class="o">--</span><span class="n">L</span><span class="p">);</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">R</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="p">)</span>
				<span class="n">rev</span><span class="p">(</span><span class="o">++</span><span class="n">R</span><span class="p">);</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">R</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="p">)</span>
				<span class="n">rev</span><span class="p">(</span><span class="n">R</span><span class="o">--</span><span class="p">);</span>
			<span class="n">cal</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="树上莫队">树上莫队</h3>

<p><a href="https://vjudge.net/solution/14284324">使用示例</a></p>

<p>按照欧拉序分块，使用Tarjan在生成欧拉序的同时预处理所有询问的lca，预处理时间复杂度$O(n+q)$。
h为查询图，即如果有一个询问(u,v)，即在h上连$u\to v,v\to u$。多个询问边有序插入h。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">TreeMo</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">Query</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">lca</span><span class="p">,</span> <span class="n">id</span><span class="p">;</span>
		<span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="k">const</span>
		<span class="p">{</span>
			<span class="k">return</span> <span class="n">l</span> <span class="o">/</span> <span class="n">BS</span> <span class="o">!=</span> <span class="n">b</span><span class="p">.</span><span class="n">l</span> <span class="o">/</span> <span class="n">BS</span> <span class="o">?</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">l</span> <span class="o">:</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">r</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">};</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Query</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">dfp</span><span class="p">,</span> <span class="n">dfi</span><span class="p">,</span> <span class="n">dfo</span><span class="p">;</span>
	<span class="n">UnionFindSet</span> <span class="n">ufs</span><span class="p">;</span>
	<span class="n">Graph</span> <span class="n">h</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">;</span>
	<span class="n">TreeMo</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">h</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">dfp</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dfi</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">dfo</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">ufs</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">h</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Edge</span><span class="p">{</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">}),</span> <span class="n">h</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Edge</span><span class="p">{</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">});</span>
		<span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Query</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="p">.</span><span class="n">size</span><span class="p">()});</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">rev</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">cal</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">cnt</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">dfp</span><span class="p">[</span><span class="n">dfi</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="o">++</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="o">!</span><span class="n">dfi</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
				<span class="n">dfs</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">cnt</span><span class="p">),</span> <span class="n">ufs</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">to</span><span class="p">);</span>
		<span class="n">dfp</span><span class="p">[</span><span class="n">dfo</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="o">++</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">id</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">h</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">h</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">id</span> <span class="o">=</span> <span class="n">k</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">to</span> <span class="o">=</span> <span class="n">h</span><span class="p">.</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">dfo</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
			<span class="p">{</span>
				<span class="n">q</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">lca</span> <span class="o">=</span> <span class="n">ufs</span><span class="p">.</span><span class="n">fa</span><span class="p">(</span><span class="n">to</span><span class="p">);</span>
				<span class="n">q</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">l</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">lca</span> <span class="o">!=</span> <span class="n">u</span> <span class="o">?</span> <span class="n">dfo</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">:</span> <span class="n">dfi</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
				<span class="n">q</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">r</span> <span class="o">=</span> <span class="n">dfi</span><span class="p">[</span><span class="n">to</span><span class="p">];</span>
			<span class="p">}</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">root</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">dfs</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">BS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">BS</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">BS</span><span class="p">);</span>
		<span class="n">sort</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">q</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
		<span class="n">L</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">L</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">)</span>
				<span class="n">rev</span><span class="p">(</span><span class="n">dfp</span><span class="p">[</span><span class="n">L</span><span class="o">++</span><span class="p">]);</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">L</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">)</span>
				<span class="n">rev</span><span class="p">(</span><span class="n">dfp</span><span class="p">[</span><span class="o">--</span><span class="n">L</span><span class="p">]);</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">R</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="p">)</span>
				<span class="n">rev</span><span class="p">(</span><span class="n">dfp</span><span class="p">[</span><span class="o">++</span><span class="n">R</span><span class="p">]);</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">R</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="p">)</span>
				<span class="n">rev</span><span class="p">(</span><span class="n">dfp</span><span class="p">[</span><span class="n">R</span><span class="o">--</span><span class="p">]);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">lca</span> <span class="o">!=</span> <span class="n">dfp</span><span class="p">[</span><span class="n">L</span><span class="p">])</span>
				<span class="n">rev</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">lca</span><span class="p">);</span>
			<span class="n">cal</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">lca</span> <span class="o">!=</span> <span class="n">dfp</span><span class="p">[</span><span class="n">L</span><span class="p">])</span>
				<span class="n">rev</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">lca</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="树上带修莫队">树上带修莫队</h3>

<p><a href="https://vjudge.net/solution/14269069">使用示例</a></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">CapitalTreeMo</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">Update</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">pos</span><span class="p">,</span> <span class="n">NEW</span><span class="p">,</span> <span class="n">OLD</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="k">struct</span> <span class="n">Query</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">t</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">lca</span><span class="p">,</span> <span class="n">id</span><span class="p">;</span>
		<span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="k">const</span>
		<span class="p">{</span>
			<span class="k">return</span> <span class="n">l</span> <span class="o">/</span> <span class="n">BS</span> <span class="o">!=</span> <span class="n">b</span><span class="p">.</span><span class="n">l</span> <span class="o">/</span> <span class="n">BS</span> <span class="o">?</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">l</span> <span class="o">:</span> <span class="n">r</span> <span class="o">/</span> <span class="n">BS</span> <span class="o">!=</span> <span class="n">b</span><span class="p">.</span><span class="n">r</span> <span class="o">/</span> <span class="n">BS</span> <span class="o">?</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">r</span> <span class="o">:</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">t</span><span class="p">;</span> <span class="c1">//在BZOJ4129上去掉r/BS还快100ms?
</span>		<span class="p">}</span>
	<span class="p">};</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Update</span><span class="o">&gt;</span> <span class="n">cq</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Query</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">dfp</span><span class="p">,</span> <span class="n">dfi</span><span class="p">,</span> <span class="n">dfo</span><span class="p">;</span>
	<span class="n">UnionFindSet</span> <span class="n">ufs</span><span class="p">;</span>
	<span class="n">Graph</span> <span class="n">h</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">T</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">;</span>
	<span class="n">CapitalTreeMo</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">cq</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">h</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">dfp</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dfi</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">dfo</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">ufs</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">h</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Edge</span><span class="p">{</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">}),</span> <span class="n">h</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Edge</span><span class="p">{</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">});</span>
		<span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Query</span><span class="p">{</span><span class="n">cq</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="p">.</span><span class="n">size</span><span class="p">()});</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">update</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">cq</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Update</span><span class="p">{</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">]}),</span> <span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">cnt</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">dfp</span><span class="p">[</span><span class="n">dfi</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="o">++</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="o">!</span><span class="n">dfi</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
				<span class="n">dfs</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">cnt</span><span class="p">),</span> <span class="n">ufs</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">to</span><span class="p">);</span>
		<span class="n">dfp</span><span class="p">[</span><span class="n">dfo</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="o">++</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">id</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">h</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">h</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">id</span> <span class="o">=</span> <span class="n">k</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">to</span> <span class="o">=</span> <span class="n">h</span><span class="p">.</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">dfo</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
			<span class="p">{</span>
				<span class="n">q</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">lca</span> <span class="o">=</span> <span class="n">ufs</span><span class="p">.</span><span class="n">fa</span><span class="p">(</span><span class="n">to</span><span class="p">);</span>
				<span class="n">q</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">l</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">lca</span> <span class="o">!=</span> <span class="n">u</span> <span class="o">?</span> <span class="n">dfo</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">:</span> <span class="n">dfi</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
				<span class="n">q</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">r</span> <span class="o">=</span> <span class="n">dfi</span><span class="p">[</span><span class="n">to</span><span class="p">];</span>
			<span class="p">}</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">set</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">d</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
			<span class="k">return</span> <span class="n">rev</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">a</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">,</span> <span class="n">rev</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
		<span class="n">a</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">rev</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">cal</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">root</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">dfs</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">BS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">BS</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">BS</span><span class="p">);</span>
		<span class="n">sort</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">q</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
		<span class="n">T</span> <span class="o">=</span> <span class="n">L</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">T</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">t</span><span class="p">)</span>
				<span class="o">++</span><span class="n">T</span><span class="p">,</span> <span class="n">set</span><span class="p">(</span><span class="n">cq</span><span class="p">[</span><span class="n">T</span><span class="p">].</span><span class="n">pos</span><span class="p">,</span> <span class="n">cq</span><span class="p">[</span><span class="n">T</span><span class="p">].</span><span class="n">NEW</span><span class="p">);</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">T</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">t</span><span class="p">)</span>
				<span class="n">set</span><span class="p">(</span><span class="n">cq</span><span class="p">[</span><span class="n">T</span><span class="p">].</span><span class="n">pos</span><span class="p">,</span> <span class="n">cq</span><span class="p">[</span><span class="n">T</span><span class="p">].</span><span class="n">OLD</span><span class="p">),</span> <span class="o">--</span><span class="n">T</span><span class="p">;</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">L</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">)</span>
				<span class="n">rev</span><span class="p">(</span><span class="n">dfp</span><span class="p">[</span><span class="n">L</span><span class="o">++</span><span class="p">]);</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">L</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">)</span>
				<span class="n">rev</span><span class="p">(</span><span class="n">dfp</span><span class="p">[</span><span class="o">--</span><span class="n">L</span><span class="p">]);</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">R</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="p">)</span>
				<span class="n">rev</span><span class="p">(</span><span class="n">dfp</span><span class="p">[</span><span class="o">++</span><span class="n">R</span><span class="p">]);</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">R</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="p">)</span>
				<span class="n">rev</span><span class="p">(</span><span class="n">dfp</span><span class="p">[</span><span class="n">R</span><span class="o">--</span><span class="p">]);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">lca</span> <span class="o">!=</span> <span class="n">dfp</span><span class="p">[</span><span class="n">L</span><span class="p">])</span>
				<span class="n">rev</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">lca</span><span class="p">);</span>
			<span class="n">cal</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">lca</span> <span class="o">!=</span> <span class="n">dfp</span><span class="p">[</span><span class="n">L</span><span class="p">])</span>
				<span class="n">rev</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">lca</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="字符串模式匹配">字符串/模式匹配</h2>

<h3 id="hashstring">HashString</h3>

<p><a href="https://vjudge.net/solution/18293901">使用示例</a>，如果要修改模数或者直接使用<code class="highlighter-rouge">unsigned long long</code>的自然溢出的话直接修改Mod即可。</p>

<p>使用<code class="highlighter-rouge">unsigned long long</code>的自然溢出<a href="https://vjudge.net/solution/18293930">快了5倍</a>，但是容易被卡。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">HashString</span> <span class="o">:</span> <span class="n">Mod</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">;</span>
	<span class="n">HashString</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="n">ll</span> <span class="n">M</span> <span class="o">=</span> <span class="mf">1e9</span> <span class="o">+</span> <span class="mi">7</span><span class="p">,</span> <span class="n">ll</span> <span class="n">P</span> <span class="o">=</span> <span class="mi">131</span><span class="p">)</span> <span class="o">:</span> <span class="n">Mod</span><span class="p">(</span><span class="n">M</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">p</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">mul</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">P</span><span class="p">),</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
			<span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">P</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">pos</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="n">len</span><span class="p">],</span> <span class="o">-</span><span class="n">mul</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">len</span><span class="p">]));</span> <span class="p">}</span> <span class="c1">//从pos位置开始的长度为len的子串的hash值
</span><span class="p">};</span>
</code></pre></div></div>

<h3 id="kmp">KMP</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">KMP</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="n">string</span> <span class="n">s</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">next</span><span class="p">;</span>
	<span class="n">KMP</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="o">:</span> <span class="n">s</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">next</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="n">next</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">j</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">];)</span>
				<span class="n">j</span> <span class="o">=</span> <span class="n">next</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
			<span class="n">next</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">?</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="kt">bool</span> <span class="n">find_in</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">t</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="n">j</span> <span class="o">=</span> <span class="n">next</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="o">++</span><span class="n">j</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
				<span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//不return可得到t中s的所有匹配地址i+1-s.size()
</span>		<span class="p">}</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="ac自动机">AC自动机</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">AhoCorasick</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">Node</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">ch</span><span class="p">[</span><span class="mi">26</span><span class="p">],</span> <span class="n">val</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">last</span><span class="p">;</span>
		<span class="kt">int</span> <span class="o">&amp;</span><span class="n">to</span><span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">return</span> <span class="n">ch</span><span class="p">[</span><span class="n">c</span> <span class="o">-</span> <span class="sc">'a'</span><span class="p">];</span>
		<span class="p">}</span> <span class="c1">//如果不确定c的范围，使用map
</span>	<span class="p">};</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
	<span class="n">AhoCorasick</span><span class="p">()</span> <span class="o">:</span> <span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">getFail</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">deque</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">last</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span> <span class="n">q</span><span class="p">.</span><span class="n">pop_front</span><span class="p">())</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="sc">'a'</span><span class="p">;</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="sc">'z'</span><span class="p">;</span> <span class="o">++</span><span class="n">c</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">front</span><span class="p">(),</span> <span class="n">u</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">r</span><span class="p">].</span><span class="n">to</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">w</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">r</span><span class="p">].</span><span class="n">f</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">r</span> <span class="o">&amp;&amp;</span> <span class="n">u</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
					<span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">f</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">last</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
					<span class="k">continue</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">u</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">v</span><span class="p">[</span><span class="n">r</span><span class="p">].</span><span class="n">to</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">w</span><span class="p">].</span><span class="n">to</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
					<span class="k">continue</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
				<span class="k">while</span> <span class="p">(</span><span class="n">w</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">v</span><span class="p">[</span><span class="n">w</span><span class="p">].</span><span class="n">to</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
					<span class="n">w</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">w</span><span class="p">].</span><span class="n">f</span><span class="p">;</span>
				<span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">f</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">w</span><span class="p">].</span><span class="n">to</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
				<span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">last</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">f</span><span class="p">].</span><span class="n">val</span> <span class="o">?</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">f</span> <span class="o">:</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">f</span><span class="p">].</span><span class="n">last</span><span class="p">;</span>
			<span class="p">}</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">val</span><span class="p">,</span> <span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">u</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">to</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]))</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">to</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
			<span class="p">{</span>
				<span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">to</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
				<span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Node</span><span class="p">());</span>
			<span class="p">}</span>
		<span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">bool</span> <span class="n">find_in</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">//调用需要调用`getFail()`生成失配函数。
</span>	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">u</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">to</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
				<span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">val</span> <span class="o">||</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">last</span><span class="p">)</span>
				<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="暴力回文">暴力回文</h3>

<p><a href="https://vjudge.net/solution/14387201">使用示例</a></p>

<p>时间复杂度$O(n^2)$，常数低，但会被<code class="highlighter-rouge">ababababa</code>这样的数据卡。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">palindrome</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">e</span><span class="p">;</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">b</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];)</span>
			<span class="o">++</span><span class="n">i</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">e</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">b</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="p">[</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">[</span><span class="n">e</span><span class="p">];)</span>
			<span class="o">--</span><span class="n">b</span><span class="p">,</span> <span class="o">++</span><span class="n">e</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ans</span> <span class="o">&lt;</span> <span class="n">e</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>
			<span class="n">ans</span> <span class="o">=</span> <span class="n">e</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span> <span class="c1">//此时[b,e)为最大回文区间
</span>	<span class="p">}</span>
	<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="线性回文">线性回文</h3>

<p><a href="https://vjudge.net/solution/14387164">使用示例</a></p>

<p>对于一个位置i，[i−f[i]+1,i+f[i]−1]是最长的以i为中心的奇回文串，g[i]−i是最长的以i为开头的回文串长度。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Manacher</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">t</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">;</span>
	<span class="n">Manacher</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="o">:</span> <span class="n">t</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">g</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="c1">//t初始值为s中没有出现过的值，g开始为0
</span>	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">t</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">t</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span> <span class="o">?</span> <span class="n">min</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">p</span> <span class="o">-</span> <span class="n">i</span><span class="p">],</span> <span class="n">m</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
				 <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">t</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&amp;&amp;</span>
				 <span class="n">t</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]];)</span>
				<span class="o">++</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">m</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="n">m</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="n">p</span> <span class="o">=</span> <span class="n">i</span><span class="p">];</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">t</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
				<span class="n">g</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">t</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">g</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
				<span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="c1">//多次询问可做一个ST表
</span>	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">e</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ans</span> <span class="o">&lt;</span> <span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span>
				<span class="n">ans</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="回文自动机">回文自动机</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define maxn 2000006
#define lx 26 //如果是字符串的内容是数字，则改为10
</span><span class="k">struct</span> <span class="n">Pam</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">Node</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">ch</span><span class="p">[</span><span class="n">lx</span><span class="p">],</span> <span class="n">fail</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="n">num</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">b</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">c</span><span class="p">[</span><span class="n">maxn</span><span class="p">];</span>
	<span class="kt">void</span> <span class="nf">init</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">len</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fail</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">fail</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">last</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">length</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="nf">get_fail</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">s</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
			<span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">fail</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">x</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="nf">insert</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">p</span> <span class="o">=</span> <span class="n">get_fail</span><span class="p">(</span><span class="n">last</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">b</span><span class="p">[</span><span class="n">p</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="n">n</span><span class="p">]])</span>
		<span class="p">{</span>
			<span class="n">b</span><span class="p">[</span><span class="o">++</span><span class="n">cnt</span><span class="p">].</span><span class="n">len</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">p</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">get_fail</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">p</span><span class="p">].</span><span class="n">fail</span><span class="p">);</span>
			<span class="n">b</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">fail</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">tmp</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="n">n</span><span class="p">]];</span>
			<span class="n">b</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">num</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">fail</span><span class="p">].</span><span class="n">num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">b</span><span class="p">[</span><span class="n">p</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="o">=</span> <span class="n">cnt</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">last</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">p</span><span class="p">].</span><span class="n">ch</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="n">n</span><span class="p">]];</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="nf">solve</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lx</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">length</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">s</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="sc">'a'</span><span class="p">;</span>
			<span class="n">insert</span><span class="p">();</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">"%d "</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="n">last</span><span class="p">].</span><span class="n">num</span><span class="p">);</span>
			<span class="n">k</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">last</span><span class="p">].</span><span class="n">num</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="后缀数组">后缀数组</h3>

<p><a href="https://vjudge.net/solution/14316681">使用示例</a></p>

<p>m：字符集大小。</p>

<p>s：字符串，其中最后一位为加入的0。</p>

<p>sa[i]：字典序第i小的是哪个后缀。</p>

<p>rk[i]：后缀i的排名。</p>

<p>h[i]：lcp(sa[i],sa[i−1])。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">SufArr</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">sa</span><span class="p">,</span> <span class="n">rk</span><span class="p">,</span> <span class="n">h</span><span class="p">;</span>
	<span class="n">SufArr</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">m</span><span class="p">)</span> <span class="o">:</span> <span class="n">sa</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">rk</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">h</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">cnt</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="n">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="o">++</span><span class="n">cnt</span><span class="p">[</span><span class="n">rk</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">cnt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">cnt</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">sa</span><span class="p">[</span><span class="o">--</span><span class="n">cnt</span><span class="p">[</span><span class="n">rk</span><span class="p">[</span><span class="n">i</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="n">sa</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
					<span class="n">j</span> <span class="o">+=</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
				<span class="n">h</span><span class="p">[</span><span class="n">cnt</span><span class="p">[</span><span class="n">rk</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">cnt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sa</span><span class="p">[</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">rk</span><span class="p">[</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">!=</span> <span class="n">rk</span><span class="p">[</span><span class="n">h</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">||</span> <span class="n">rk</span><span class="p">[</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">rk</span><span class="p">[</span><span class="n">h</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="p">])</span>
					<span class="n">cnt</span><span class="p">[</span><span class="o">++</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
				<span class="n">sa</span><span class="p">[</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">swap</span><span class="p">(</span><span class="n">rk</span><span class="p">,</span> <span class="n">sa</span><span class="p">),</span> <span class="n">swap</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">h</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">rk</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">,</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span>
			<span class="k">for</span> <span class="p">(;</span> <span class="o">~</span><span class="n">k</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">s</span><span class="p">[</span><span class="n">sa</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="p">];</span> <span class="n">j</span> <span class="o">=</span> <span class="n">rk</span><span class="p">[</span><span class="n">sa</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="o">--</span><span class="n">k</span><span class="p">)</span>
				<span class="n">h</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

  
  <h1>
    <a href="/posts/acm/template/%E5%9B%BE%E8%AE%BA">
      图论
    </a>
  </h1>
  <p>这里用类似邻接表的方法存图。有的算法可能需要邻接矩阵，详见线性代数部分。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">Vertex</span>
	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">o</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>		<span class="c1">//相关出边和入边编号
</span>		<span class="kt">int</span> <span class="n">siz</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">dfn</span><span class="p">;</span> <span class="c1">//树链剖分中使用，依次代表子树节点数、深度、所在链的顶端节点、dfs序
</span>	<span class="p">};</span>
	<span class="k">struct</span> <span class="n">Edge</span> <span class="o">:</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span>
	<span class="p">{</span>
		<span class="n">ll</span> <span class="n">len</span><span class="p">,</span> <span class="n">cap</span><span class="p">;</span> <span class="c1">//边长、容量，图论算法使用
</span>	<span class="p">};</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Vertex</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span> <span class="c1">//点集
</span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="n">e</span><span class="p">;</span>   <span class="c1">//边集
</span>	<span class="n">Graph</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">v</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="k">const</span> <span class="n">Edge</span> <span class="o">&amp;</span><span class="n">ed</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ed</span><span class="p">.</span><span class="n">first</span> <span class="o">==</span> <span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">)</span>
			<span class="k">return</span><span class="p">;</span> <span class="c1">//如果有需要请拆点
</span>		<span class="n">v</span><span class="p">[</span><span class="n">ed</span><span class="p">.</span><span class="n">first</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">v</span><span class="p">[</span><span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">].</span><span class="n">i</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">e</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">ch</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">e</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">]].</span><span class="n">second</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//u的第i个孩子节点
</span>	<span class="kt">int</span> <span class="n">fa</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">e</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">i</span><span class="p">[</span><span class="n">i</span><span class="p">]].</span><span class="n">first</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//u的第i个父节点
</span><span class="p">};</span>
</code></pre></div></div>

<h2 id="最短路">最短路</h2>

<h3 id="dijkstra算法">Dijkstra算法</h3>

<p><a href="https://vjudge.net/solution/19427495">使用示例</a>，适用于边权为正的情况（无论有向图还是无向图），用于求单源最短路。</p>

<p>直接给出其优先队列优化的版本。另外，由于<code class="highlighter-rouge">priority_queue</code>并不提供修改优先级的操作，为避免重复扩展，这里选择将新元素直接插入队列并在运行时判断该点是否被处理，并不影响结果的正确性。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Dijkstra</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">d</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">;</span>
	<span class="n">Dijkstra</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">d</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">INF</span><span class="p">);</span>
		<span class="n">p</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">ll</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">q</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">make_pair</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="p">));</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">();)</span>
		<span class="p">{</span>
			<span class="n">ll</span> <span class="n">dis</span> <span class="o">=</span> <span class="o">-</span><span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">first</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">second</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">pop</span><span class="p">(),</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dis</span><span class="p">)</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span>
					<span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
					<span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">make_pair</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">],</span> <span class="n">to</span><span class="p">));</span>
				<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="bellmanford算法">BellmanFord算法</h3>

<p><a href="https://vjudge.net/solution/16970652">使用示例</a>，直接给出其队列优化、国内称之为SPFA算法的版本。较之Dijkstra算法，此算法不够快速稳定但是可以允许负边存在，当s到达负权回路时会直接返回0。稀疏图上性能优秀。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">BellmanFord</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">d</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">;</span>
	<span class="n">BellmanFord</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">bool</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">d</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">INF</span><span class="p">);</span>
		<span class="n">p</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">cnt</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">flag</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">d</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">deque</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">flag</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span> <span class="n">q</span><span class="p">.</span><span class="n">pop_front</span><span class="p">())</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">front</span><span class="p">(),</span> <span class="n">i</span> <span class="o">=</span> <span class="n">flag</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span>
					<span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">flag</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
					<span class="p">{</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="o">++</span><span class="n">cnt</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
							<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
						<span class="n">flag</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">to</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">}</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h4 id="差分约束系统">差分约束系统</h4>

<p>按如下方式建图、跑SPFA：</p>

<p>对每个不等式$x_i−x_j\leq d$，从$j$向$i$连一条边，边长为$d$。</p>

<p>若不等号的方向相反，即$x_i−x_j\geq d$，则在不等式两边同时乘以$-1$，变成$x_j−x_i\leq -d$，即从$i$到$j$连一条边，边长为$d$。</p>

<h3 id="floyed求多源最短路">Floyed求多源最短路</h3>

<p>不连通的权置INF。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">floyed</span><span class="p">(</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="c1">// 其实一般手打即可，没必要套这个鬼模板…
</span><span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
					<span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="astar求k短路">Astar求k短路</h3>

<p><a href="https://vjudge.net/solution/16970766">使用示例</a>，在这个比较坑的例子中需要在调用前补一句<code class="highlighter-rouge">if(s==t)++k;</code>。<strong>k下标从0开始，即最短路==第0短路</strong>。</p>

<p>朴素的想法是使用<code class="highlighter-rouge">priority_queue</code>从原点出发向外探索，当取出终点t第k次时就得到第k短路，类似bfs的思想，缺陷是越往后状态数越多。</p>

<p>我们在反向图上从$t\to s$跑Astar算法，通过优先展开到s近的状态，使搜索方向靠近答案，而不是一层一层全都展开，估价函数$f\approx g+h$，f是估计的s到t的距离，g是到达当前点已经点的花费，h是预计剩下的花费。这里h取当前点的距离到s距离，可通过从s跑一遍Dijkstra可以预处理得出。</p>

<p>Astar算法是只有到达终点的时候才能统计答案，这导致可能拓展很多个状态才能得到一个用来更新答案的有效状态。例如一个n元环，当我们到达终点之后,可能还要拓展n次才能得到下一个状态，于是时间复杂度就被卡到$O(nk)$。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Astar</span> <span class="o">:</span> <span class="n">Dijkstra</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">ans</span><span class="p">;</span>
	<span class="n">Astar</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Dijkstra</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Dijkstra</span><span class="o">::</span><span class="n">ask</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
		<span class="n">ans</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">INF</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">INF</span><span class="p">)</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">cnt</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">ll</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">q</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">make_pair</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">t</span><span class="p">));</span> <span class="n">cnt</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">k</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">();)</span>
		<span class="p">{</span>
			<span class="n">ll</span> <span class="n">dis</span> <span class="o">=</span> <span class="o">-</span><span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">first</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">second</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">u</span> <span class="o">==</span> <span class="n">s</span><span class="p">)</span>
				<span class="n">ans</span><span class="p">[</span><span class="n">cnt</span><span class="p">[</span><span class="n">s</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dis</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">pop</span><span class="p">(),</span> <span class="o">++</span><span class="n">cnt</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">)</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">i</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">i</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">make_pair</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">first</span><span class="p">]</span> <span class="o">-</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span> <span class="o">-</span> <span class="n">dis</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">first</span><span class="p">));</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="网络流">网络流</h2>

<h3 id="isap求最大流">ISAP求最大流</h3>

<p><a href="https://vjudge.net/solution/16970964">使用示例</a></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">ISAP</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">flow</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">f</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">h</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">gap</span><span class="p">;</span>
	<span class="n">ISAP</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="n">Edge</span> <span class="n">ed</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">ed</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">),</span> <span class="n">ed</span><span class="p">.</span><span class="n">cap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">,</span> <span class="n">ll</span> <span class="n">r</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">u</span> <span class="o">==</span> <span class="n">t</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
		<span class="n">ll</span> <span class="n">_f</span><span class="p">,</span> <span class="n">_r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">i</span> <span class="o">=</span> <span class="n">cur</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">h</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">==</span> <span class="n">h</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">_f</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">min</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">_r</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">cap</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">]));</span>
				<span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">_r</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">_r</span> <span class="o">==</span> <span class="n">r</span> <span class="o">||</span> <span class="n">h</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
					<span class="k">return</span> <span class="n">_r</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!--</span><span class="n">gap</span><span class="p">[</span><span class="n">h</span><span class="p">[</span><span class="n">u</span><span class="p">]])</span>
			<span class="n">h</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
		<span class="k">return</span> <span class="o">++</span><span class="n">gap</span><span class="p">[</span><span class="o">++</span><span class="n">h</span><span class="p">[</span><span class="n">u</span><span class="p">]],</span> <span class="n">cur</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">_r</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">h</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">cur</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">gap</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="cm">/*
		for (deque&lt;int&gt; q(h[t] = gap[t] = 1, t); !q.empty(); q.pop_front()) //优化，加了能快一点
			for (int i = 0, u = q.front(), k, to; i &lt; v[u].o.size(); ++i)
				if (to = e[v[u].o[i]].second, !h[to])
					++gap[h[to] = h[u] + 1], q.push_back(to);
		*/</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">flow</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span> <span class="n">h</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();)</span>
			<span class="n">flow</span> <span class="o">+=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">INF</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="primaldual求费用流">PrimalDual求费用流</h3>

<p><a href="https://vjudge.net/solution/16971249">使用示例</a>，定义一条边的费用为流量*边长，求总费用最小的最大流。性能优秀，只能跑非负权图。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">PrimalDual</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">flow</span><span class="p">,</span> <span class="n">cost</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">f</span><span class="p">;</span>
	<span class="n">PrimalDual</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="n">Edge</span> <span class="n">ed</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">ed</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">),</span> <span class="n">ed</span><span class="p">.</span><span class="n">cap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">len</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">)</span> <span class="c1">//询问s到t的最小费用最大流，答案存在flow、cost中
</span>	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">d</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">INF</span><span class="p">),</span> <span class="n">h</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">flow</span> <span class="o">=</span> <span class="n">cost</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);;)</span>
		<span class="p">{</span>
			<span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">ll</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">q</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">make_pair</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="p">));</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">();)</span>
			<span class="p">{</span>
				<span class="n">ll</span> <span class="n">dis</span> <span class="o">=</span> <span class="o">-</span><span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">first</span><span class="p">;</span>
				<span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">second</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">pop</span><span class="p">(),</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dis</span><span class="p">)</span>
					<span class="k">continue</span><span class="p">;</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span>
						<span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">cap</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
					<span class="p">{</span>
						<span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="p">[</span><span class="n">to</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
						<span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">make_pair</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">],</span> <span class="n">to</span><span class="p">));</span>
					<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">INF</span><span class="p">)</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">INF</span><span class="p">)</span>
					<span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
			<span class="n">ll</span> <span class="n">_f</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">s</span><span class="p">;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">first</span><span class="p">)</span>
				<span class="n">_f</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">_f</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">cap</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]]);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">s</span><span class="p">;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">first</span><span class="p">)</span>
				<span class="n">cost</span> <span class="o">+=</span> <span class="n">_f</span> <span class="o">*</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">len</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_f</span><span class="p">;</span>
			<span class="n">flow</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="ek求费用流">EK求费用流</h3>

<p><a href="https://vjudge.net/solution/16971149">使用示例</a>，定义一条边的费用为流量*边长，求总费用最小的最大流。BellmanFord算法找增广路，可能被卡但是可以跑负费用流（最大费用流）。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">EdmondKarp</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">flow</span><span class="p">,</span> <span class="n">cost</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">f</span><span class="p">;</span>
	<span class="n">EdmondKarp</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="n">Edge</span> <span class="n">ed</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">ed</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">),</span> <span class="n">ed</span><span class="p">.</span><span class="n">cap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">len</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">flow</span> <span class="o">=</span> <span class="n">cost</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);;)</span>
		<span class="p">{</span>
			<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">d</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">INF</span><span class="p">);</span>
			<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">flag</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">d</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">deque</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span> <span class="n">q</span><span class="p">.</span><span class="n">pop_front</span><span class="p">())</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">front</span><span class="p">(),</span> <span class="n">i</span> <span class="o">=</span> <span class="n">flag</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span>
						<span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">cap</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
						<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">flag</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
							<span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">to</span><span class="p">),</span> <span class="n">flag</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
					<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">INF</span><span class="p">)</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="n">ll</span> <span class="n">_f</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">s</span><span class="p">;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">first</span><span class="p">)</span>
				<span class="n">_f</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">_f</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">cap</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]]);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">s</span><span class="p">;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">first</span><span class="p">)</span>
				<span class="n">cost</span> <span class="o">+=</span> <span class="n">_f</span> <span class="o">*</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">len</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_f</span><span class="p">;</span>
			<span class="n">flow</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="zkw求费用流">ZKW求费用流</h3>

<p><a href="https://vjudge.net/solution/16971099">使用示例</a>，定义一条边的费用为流量*边长，求总费用最小的最大流。</p>

<p>对于最终流量较大，而费用取值范围不大的图，或者是增广路径比较短的图（如二分图），zkw算法都会比较快，原因是充分发挥优势。比如流多说明可以同一费用反复增广，费用窄说明不用改太多距离标号就会有新增广路，增广路径短可以显著改善最坏情况，因为即使每次就只增加一条边也可以很快凑成最短路。如果恰恰相反，流量不大，费用不小，增广路还较长，就不适合 zkw 算法了。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">struct</span> <span class="n">ZKW</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">flow</span><span class="p">,</span> <span class="n">cost</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vis</span><span class="p">;</span>
	<span class="n">ZKW</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="n">Edge</span> <span class="n">ed</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">ed</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">),</span> <span class="n">ed</span><span class="p">.</span><span class="n">cap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">len</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">,</span> <span class="n">ll</span> <span class="n">r</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">u</span> <span class="o">==</span> <span class="n">t</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">ll</span> <span class="n">_f</span> <span class="o">=</span> <span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="n">_r</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">h</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span> <span class="o">==</span> <span class="n">h</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
				<span class="n">_f</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">min</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">_r</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">cap</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">])),</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">_r</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">_r</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">h</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">vis</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">flow</span> <span class="o">=</span> <span class="n">cost</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);;)</span>
		<span class="p">{</span>
			<span class="n">ll</span> <span class="n">_f</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">INF</span><span class="p">),</span> <span class="n">d</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
			<span class="n">flow</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">cost</span> <span class="o">+=</span> <span class="n">_f</span> <span class="o">*</span> <span class="n">h</span><span class="p">[</span><span class="n">s</span><span class="p">];</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">u</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">u</span><span class="p">)</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span> <span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">cap</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
						<span class="n">d</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">first</span><span class="p">]);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">==</span> <span class="n">INF</span><span class="p">)</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
					<span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d</span><span class="p">,</span> <span class="n">vis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="上下界有源汇网络流">上下界有源汇网络流</h3>

<p>T向S连容量正无穷的边，将有源汇转化为无源汇。每条边容量减去下界，设$in[i]$表示流入i的下界之和减去流出i的下界之和。新建超级源汇SS,TT，对于$in[i]&gt;0$的点，SS向i连容量为$in[i]$的边。对于$in[i]&lt;0$的点，i向TT连容量为$−in[i]$的边。</p>

<p>求出以 SS,TT 为源汇的最大流，如果等于$\sum in<a href="in[i] &gt; 0">i</a>$则存在可行流。再求出以S,T为源汇的最大流即为最大流。</p>

<p>费用流：建完图后等价于求以SS,TT为源汇的的费用流。</p>

<p>上下界费用流：先把下界的费用加入答案。</p>

<h3 id="判断边是否属于某一割集">判断边是否属于某一割集</h3>

<p>在残余网络 (还有流量的边) 中求强连通分量，顶点不在同一 SCC 且满流的边。</p>

<p>判断边是否为全部最小割集的边： 在上一条的基础上，还要满足起点与 S 在同一 SCC，且终点与T在同一SCC。</p>

<h3 id="线性规划转费用流">线性规划转费用流</h3>

<p>首先添加松弛变量，将不等号都变为等号。分别用下一个式子减去上一个式子，如果每个变量只出现了两次且符号一正一负，那么可以转化为费用流。对于每个式子建立一个点，那么每个变量对应一条边，从一个点流出，向另一个点流入。这样，对于等式右边的常数，如果是正的，对应从源点向该点连一条流量C，费用0的边；如果是负的对应从该点向汇点连一条流量−C，费用0的边。对于每个变量，从它系数为正的式子向系数为负的式子连一条容量为 inf，费用为它在目标函数里系数的边。这样网络流模型就构造完毕了。</p>

<h2 id="欧拉路">欧拉路</h2>

<p><a href="https://vjudge.net/solution/16970884">使用示例</a>，给定无孤立结点图G，若存在一条路，经过图中每边一次且仅一次，该条路称为欧拉路。</p>

<ul>
  <li>无向图：当仅当该图所有顶点的度数为偶数（此时为回路），或除两个度数为奇数外（作为路径的起点和终点）、其余全为偶数。</li>
  <li>有向图：当仅当该图所有顶点出度=入度（此时为回路），或一个顶点出度=入度+1（作为起点）、另一个顶点入度=出度+1（作为终点）、其他顶点出度=入度。</li>
</ul>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Fleury</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vis</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">p</span><span class="p">;</span>
	<span class="n">Fleury</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">i</span> <span class="o">=</span> <span class="n">cur</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">i</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="c1">//遍历原图的反向图，这里加了一个“当前弧”优化
</span>			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">i</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">k</span> <span class="o">^</span> <span class="mi">1</span><span class="p">])</span>   <span class="c1">//无向图需要同时检查反向边未被访问过
</span>			<span class="p">{</span>
				<span class="n">vis</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="n">dfs</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">first</span><span class="p">);</span>
				<span class="n">p</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
			<span class="p">}</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">()</span> <span class="c1">//查询欧拉回路，路径上边的序号按顺序存在p中
</span>	<span class="p">{</span>
		<span class="n">vis</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">cur</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">p</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">i</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">dfs</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
		<span class="n">dfs</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="混合图欧拉回路判定">混合图欧拉回路判定</h3>

<p>首先给无向边随便定一个方向，设$\deg x$为x连出去的边数−连入x的边数。若存在$\deg x$为奇数，或者图不连通，则无解。否则建立源点S，汇点T。对于一个点x，若$\deg x&gt;0$，则S向x连边，容量$\frac{\deg x}{2}$；若$\deg x&lt;0$，则x向T连边，容量$-\frac{\deg x}{2}$。 对于一条定了向的无向边$x\to y$，x向y连边，容量1，求出最大流，若与 S 和T连的每条边都满流，则有解。</p>

<h2 id="连通性">连通性</h2>

<h3 id="无向图求割和双连通分量">无向图求割和双连通分量</h3>

<p><a href="https://vjudge.net/solution/19427352">使用示例1</a></p>

<p><a href="https://vjudge.net/solution/19427379">使用示例2</a></p>

<ul>
  <li>割边：在连通图中，删除了连通图的某条边后，图不再连通。这样的边被称为割边，也叫做桥。</li>
  <li>割点：在连通图中，删除了连通图的某个点以及与这个点相连的边后，图不再连通。这样的点被称为割点。构造dfs搜索树，在树上有两类节点可以成为割点：
    <ul>
      <li>对根节点u，若其有两棵或两棵以上的子树，则该根结点u为割点；</li>
      <li>对非根非叶节点u，若其中的某棵子树的节点均没有指向u的祖先节点的回边，说明删除u之后，根结点与该棵子树的节点不再连通；则节点u为割点。</li>
    </ul>
  </li>
</ul>

<p>对于一个无向图的子图，当删除其中任意一条边后，不改变图内点的连通性，这样的子图叫做边的双连通子图。而当子图的边数达到最大时，叫做边的双连通分量。原理是图中所有割边再求一次SCC，可<strong>直接</strong>使用求SCC的代码。</p>

<p>对于一个无向图的子图，当删除其中任意一个点后，不改变图内点的连通性，这样的子图叫做点的双连通子图。而当子图的边数达到最大时，叫做点的双连通分量。下面给出求点双连通分量的代码。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">BiconnectedConnectedComponenet</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">dep</span><span class="p">,</span> <span class="n">bid</span><span class="p">,</span> <span class="n">stak</span><span class="p">,</span> <span class="n">cutPoint</span><span class="p">,</span> <span class="n">cutEdge</span><span class="p">;</span> <span class="c1">//bid边的端点所属双连通块
</span>	<span class="n">BiconnectedConnectedComponenet</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">dep</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">bid</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">cutPoint</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">cutEdge</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
				<span class="n">dfs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fa</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">low</span> <span class="o">=</span> <span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">fa</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">?</span> <span class="n">dep</span><span class="p">[</span><span class="n">fa</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">lowto</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">to</span> <span class="o">!=</span> <span class="n">fa</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
				<span class="p">{</span>
					<span class="n">stak</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
					<span class="n">low</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">lowto</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">u</span><span class="p">));</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">lowto</span> <span class="o">&gt;</span> <span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
						<span class="n">cutEdge</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">cutEdge</span><span class="p">[</span><span class="n">k</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">lowto</span> <span class="o">&gt;=</span> <span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
						<span class="k">for</span> <span class="p">(</span><span class="n">cutPoint</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">fa</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">||</span> <span class="n">i</span><span class="p">;;)</span>
						<span class="p">{</span>
							<span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">stak</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
							<span class="n">stak</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
							<span class="n">bid</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">bid</span><span class="p">[</span><span class="n">x</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
							<span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">k</span><span class="p">)</span>
								<span class="k">break</span><span class="p">;</span>
						<span class="p">}</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
				<span class="p">{</span>
					<span class="n">stak</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
					<span class="n">low</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">dep</span><span class="p">[</span><span class="n">to</span><span class="p">]);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="k">return</span> <span class="n">low</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h4 id="双连通图的构造">双连通图的构造</h4>

<p>先求出所有的桥，然后删除这些桥边，剩下的每个连通块都是一个双连通子图。把每个双连通子图收缩为一个顶点，再把桥边加回来，最后的这个图一定是一棵树，边连通度为1。统计出树中度为1的节点的个数，即为叶节点的个数，记为<code class="highlighter-rouge">leaf</code>。至少在树上添加<code class="highlighter-rouge">(leaf+1)/2</code>条边，就能使树达到边双连通：先把两个最近公共祖先最远的两个叶节点之间连接一条边，这样可以把这两个点到祖先的路径上所有点收缩到一起，因为一个形成的环一定是双连通的；然后再找两个最近公共祖先最远的两个叶节点，这样一对一对找完，恰好是<code class="highlighter-rouge">(leaf+1)/2</code>次，把所有点收缩到了一起。</p>

<h3 id="无向图求边双连通分量有向图求强连通分量">无向图求边双连通分量&amp;有向图求强连通分量</h3>

<p><a href="https://vjudge.net/solution/19427182">无向图求边双连通分量</a></p>

<p><a href="https://vjudge.net/solution/19427243">有向图求强连通分量</a></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">StronglyConnectedComponenet</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">dep</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">stak</span><span class="p">;</span> <span class="c1">//sid=点所属连通块
</span>	<span class="n">StronglyConnectedComponenet</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">dep</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">sid</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
				<span class="n">dfs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fa</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">low</span> <span class="o">=</span> <span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">fa</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">?</span> <span class="n">dep</span><span class="p">[</span><span class="n">fa</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">stak</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">to</span> <span class="o">!=</span> <span class="n">fa</span> <span class="cm">/*, 1*/</span><span class="p">)</span> <span class="c1">//求强连通分量把注释去掉，即允许走回边
</span>			<span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
					<span class="n">low</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">dfs</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">u</span><span class="p">));</span>
				<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sid</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
					<span class="n">low</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">dep</span><span class="p">[</span><span class="n">to</span><span class="p">]);</span>
			<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">low</span> <span class="o">==</span> <span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
			<span class="k">for</span> <span class="p">(;;)</span>
			<span class="p">{</span>
				<span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">stak</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
				<span class="n">stak</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
				<span class="n">sid</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">u</span><span class="p">)</span>
					<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="k">return</span> <span class="n">low</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h4 id="2-sat">2-SAT</h4>

<p><a href="https://vjudge.net/solution/19427243">使用示例</a>，n个布尔变量$x_0\ldots x_{n-1}$，逻辑表达式$Y=(A_0+B_0)(A_1+B_1)\ldots(A_{m-1}+B_{m-1})$，其中$A_i,B_i\in{x_j,\overline{x_j}}$，判断是否存在$x_0\ldots x_{n-1}$的取值使得Y值为1。因为$A+B=(\overline A\to B)(\overline B\to A)$，所以对于一个要求$A+B$，我们连$\overline A\to B,\overline B\to A$两条边。如果有一条边$A\to B$，意味着如果A成立那么B必然成立。若$\exists i,x_i,\overline{x_i}\in$同一SCC，则不存在。</p>

<h5 id="2-sat暴力求字典序最小的解">2-SAT暴力求字典序最小的解</h5>

<p><a href="https://vjudge.net/solution/22373123">使用示例</a>，时间复杂度最坏为为$O(VE)$。</p>

<p>要求顶点数<code class="highlighter-rouge">v.size()</code>是偶数，最后输出结果在<code class="highlighter-rouge">ok中</code>。不满足任意i<code class="highlighter-rouge">ok[i]^ok[i^1]==1</code>时，<code class="highlighter-rouge">ask</code>函数返回<code class="highlighter-rouge">false</code>。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">TwoSat</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ok</span><span class="p">;</span>
	<span class="n">TwoSat</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">addOR</span><span class="p">(</span><span class="kt">int</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">q</span><span class="p">)</span> <span class="p">{</span> <span class="n">add</span><span class="p">({</span><span class="n">p</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">}),</span> <span class="n">add</span><span class="p">({</span><span class="n">q</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">});</span> <span class="p">}</span>
	<span class="kt">int</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">stak</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ok</span><span class="p">[</span><span class="n">u</span> <span class="o">^</span> <span class="mi">1</span><span class="p">])</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ok</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">ok</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">stak</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">:</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dfs</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">stak</span><span class="p">))</span>
				<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">ok</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ok</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">ok</span><span class="p">[</span><span class="n">i</span> <span class="o">^</span> <span class="mi">1</span><span class="p">])</span>
			<span class="p">{</span>
				<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">stak</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dfs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">stak</span><span class="p">))</span>
				<span class="p">{</span>
					<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">stak</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
						<span class="n">ok</span><span class="p">[</span><span class="n">stak</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dfs</span><span class="p">(</span><span class="n">i</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stak</span><span class="p">))</span>
						<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="二分图">二分图</h2>

<p>二分图的一个等价定义是：不含有含奇数条边的环的图。</p>

<p>完美匹配图中所有的顶点都是匹配点。</p>

<p>二分图的最小点覆盖（最小割）是指最少的顶点数使得二分图G中的每条边都至少与其中一个点相关联。二分图中，最小割=最大匹配。</p>

<p>二分图的最小边覆盖（最大独立集）是指用尽量少的不相交简单路径覆盖二分图中的所有顶点。二分图中，最小点覆盖+最小边覆盖=总点数。</p>

<p>Hall定理：二分图中的两部分顶点组成的集合分别为 X,Y ，则有一组无公共点的边，一端恰好为组成 X 的点的充分必要条件是：X 中的任意 k 个点至少与 Y 中的 k 个点相邻。对于区间图只需要考虑极端情况，线段树维护。</p>

<p>关键点：一定在最大匹配中的点。 求出任意一个最大匹配，那么只需要考虑哪些匹配点不一定在。 假设是考虑左侧的点，右侧类似： 将匹配边从右往左，非匹配边从左到右，从左侧每个未匹配点开始DFS到的匹配点都不是关键点。</p>

<p>关键边：求出任意一个最大匹配，将匹配边从右到左，剩余边从左到右，求出 SCC。 对于一条边：若它位于当前匹配中，那么若两端点位于同一SCC，则是可能在，否则必定在；若它不位于当前匹配中，那么若两端点位于同一 SCC，则是可能在，否则必定不在。</p>

<h3 id="hungary求最大匹配">Hungary求最大匹配</h3>

<p><a href="https://vjudge.net/solution/21880920">使用示例</a></p>

<p>左边nl个点$0\ldots nl-1$，右边nr个点$0\ldots nr-1$，取<code class="highlighter-rouge">n=max(nl,nr)</code>，左i右j间相连则<code class="highlighter-rouge">g[i].push_back(j);</code>。</p>

<p>生成<code class="highlighter-rouge">fl[i]</code>表示左边第i个匹配右边第<code class="highlighter-rouge">fl[i]</code>个，<code class="highlighter-rouge">fr</code>同理。时间复杂度$O(n^3)$。未匹配的值为<code class="highlighter-rouge">fl[i] == N</code>。匹配是一个边集，其中任意两条边都没有公共顶点；扫一遍<code class="highlighter-rouge">fl</code>或<code class="highlighter-rouge">fr</code>判断有多少不等于<code class="highlighter-rouge">N</code>即为最大匹配数。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Hungary</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">g</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">fl</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">fr</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">vr</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
	<span class="kt">int</span> <span class="nf">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rt</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">y</span> <span class="o">:</span> <span class="n">g</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">vr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="n">rt</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">vr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">rt</span><span class="p">,</span> <span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span> <span class="o">||</span> <span class="n">dfs</span><span class="p">(</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">],</span> <span class="n">rt</span><span class="p">))</span>
					<span class="k">return</span> <span class="n">fl</span><span class="p">[</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="nf">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">fill</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">fl</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">fr</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">vr</span><span class="p">,</span> <span class="n">vr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
				<span class="n">dfs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span> <span class="c1">//找完全匹配时如果返回值为0可直接return
</span>	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="hopcroftkarp求最大匹配">HopcroftKarp求最大匹配</h3>

<p><a href="https://vjudge.net/solution/21880796">使用示例</a>，时间复杂度$O(\sqrt{\vert V\vert }\vert E\vert )$，稀疏图上效果明显。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">HopcroftKarp</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">g</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">fl</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">fr</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">hl</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">hr</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
	<span class="kt">bool</span> <span class="nf">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">hl</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">hl</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">y</span> <span class="o">:</span> <span class="n">g</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">hr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">hr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="p">,</span> <span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span> <span class="o">||</span> <span class="n">dfs</span><span class="p">(</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]))</span>
					<span class="k">return</span> <span class="n">fl</span><span class="p">[</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="nf">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">fill</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">fl</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">fr</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">x</span><span class="p">)</span>
			<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">y</span> <span class="o">:</span> <span class="n">g</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">fl</span><span class="p">[</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">ql</span><span class="p">,</span> <span class="n">qr</span><span class="p">,</span> <span class="n">ok</span><span class="p">;;)</span>
		<span class="p">{</span>
			<span class="n">fill</span><span class="p">(</span><span class="n">hl</span><span class="p">,</span> <span class="n">hl</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">hr</span><span class="p">,</span> <span class="n">hr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">ql</span> <span class="o">=</span> <span class="n">qr</span> <span class="o">=</span> <span class="n">ok</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">x</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
					<span class="n">hl</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">qr</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">ql</span> <span class="o">&lt;</span> <span class="n">qr</span><span class="p">)</span>
				<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">y</span> <span class="o">:</span> <span class="n">g</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">ql</span><span class="o">++</span><span class="p">]])</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">hr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="n">hr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">hl</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">ql</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
							<span class="n">ok</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
						<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">hl</span><span class="p">[</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
							<span class="n">hl</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">qr</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]]</span> <span class="o">=</span> <span class="n">hr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
					<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ok</span><span class="p">)</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">x</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
					<span class="n">dfs</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="kuhnmunkres求最优完备匹配">KuhnMunkres求最优完备匹配</h3>

<p><a href="https://vjudge.net/solution/21880965">使用示例</a>。</p>

<p>左x右y代价<code class="highlighter-rouge">a[x][y]</code>。最大费用流时，a初始化0；最大费用最大流时，a初始化<code class="highlighter-rouge">-N*INF</code>。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">KuhnMunkres</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">a</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="n">N</span><span class="p">],</span> <span class="n">hl</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">hr</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">slk</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">fl</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">fr</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">vl</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">vr</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">pre</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">ql</span><span class="p">,</span> <span class="n">qr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="nf">check</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">N</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">vr</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">qr</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">fl</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">N</span><span class="p">)</span>
			<span class="n">swap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">fr</span><span class="p">[</span><span class="n">fl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="p">]]);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="nf">bfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">fill</span><span class="p">(</span><span class="n">slk</span><span class="p">,</span> <span class="n">slk</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">INF</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">vl</span><span class="p">,</span> <span class="n">vl</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">vr</span><span class="p">,</span> <span class="n">vr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">vr</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">ql</span> <span class="o">=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">qr</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;;)</span>
		<span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">ll</span> <span class="n">d</span><span class="p">;</span> <span class="n">ql</span> <span class="o">&lt;</span> <span class="n">qr</span><span class="p">;)</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">ql</span><span class="o">++</span><span class="p">];</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">slk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">d</span> <span class="o">=</span> <span class="n">hl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">hr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]))</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
							<span class="n">slk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
						<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">check</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
							<span class="k">return</span><span class="p">;</span>
			<span class="n">ll</span> <span class="n">d</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="n">slk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
					<span class="n">d</span> <span class="o">=</span> <span class="n">slk</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
					<span class="n">hl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
				<span class="k">else</span>
					<span class="n">slk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">d</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">vr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
					<span class="n">hr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">d</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">slk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">check</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
					<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="nf">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">fill</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">fl</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">fr</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">hr</span><span class="p">,</span> <span class="n">hr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">hl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="n">max_element</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">n</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
			<span class="n">bfs</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="带花树">带花树</h2>

<h3 id="一般图最大匹配">一般图最大匹配</h3>

<p><a href="http://uoj.ac/submission/342734">使用示例</a></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Blossom</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">f</span><span class="p">;</span>
	<span class="n">Blossom</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">f</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vis</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">vis</span><span class="p">.</span><span class="n">back</span><span class="p">();</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">s</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
			<span class="p">{</span>
				<span class="n">UnionfindSet</span> <span class="n">ufs</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
				<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">pre</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()),</span> <span class="n">flag</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">2</span><span class="p">);</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">deque</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">q</span><span class="p">.</span><span class="n">pop_front</span><span class="p">())</span>
					<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">front</span><span class="p">(),</span> <span class="n">y</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">]].</span><span class="n">second</span><span class="p">,</span> <span class="n">y</span> <span class="o">!=</span> <span class="n">f</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">flag</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">ufs</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ufs</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
						<span class="p">{</span>
							<span class="k">if</span> <span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
							<span class="p">{</span>
								<span class="k">for</span> <span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="o">++</span><span class="n">cnt</span><span class="p">;;</span> <span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
									<span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
									<span class="p">{</span>
										<span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">a</span> <span class="o">=</span> <span class="n">ufs</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span> <span class="o">==</span> <span class="n">cnt</span><span class="p">)</span>
											<span class="k">break</span><span class="p">;</span>
										<span class="n">vis</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">?</span> <span class="n">pre</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">a</span><span class="p">]]</span> <span class="o">:</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
									<span class="p">}</span>
								<span class="k">if</span> <span class="p">(</span><span class="n">ufs</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="n">a</span><span class="p">)</span>
									<span class="n">pre</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
								<span class="k">if</span> <span class="p">(</span><span class="n">ufs</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="n">a</span><span class="p">)</span>
									<span class="n">pre</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
								<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">},</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
									<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">;</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">a</span><span class="p">;</span> <span class="n">ufs</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">ufs</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">z</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
									<span class="p">{</span>
										<span class="k">if</span> <span class="p">(</span><span class="n">ufs</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">z</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">x</span><span class="p">]])</span> <span class="o">!=</span> <span class="n">a</span><span class="p">)</span>
											<span class="n">pre</span><span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
										<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">flag</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>
											<span class="n">flag</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
										<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">flag</span><span class="p">[</span><span class="n">z</span><span class="p">])</span>
											<span class="n">flag</span><span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">z</span><span class="p">);</span>
									<span class="p">}</span>
							<span class="p">}</span>
							<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
								<span class="n">pre</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">flag</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">flag</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">y</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">y</span><span class="p">]);</span>
							<span class="k">else</span>
							<span class="p">{</span>
								<span class="k">for</span> <span class="p">(</span><span class="n">pre</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span> <span class="n">y</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();)</span>
									<span class="n">swap</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="n">y</span><span class="p">]]);</span>
								<span class="k">break</span><span class="p">;</span>
							<span class="p">}</span>
						<span class="p">}</span>
			<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="树形图">树形图</h2>

<h3 id="最小生成树">最小生成树</h3>

<h4 id="无向图">无向图</h4>

<p>同时给出Prim算法（生成新树）、Kruskal算法（消耗小）。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Prim</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">DisGreater</span>
	<span class="p">{</span>
		<span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Edge</span> <span class="o">&amp;</span><span class="n">e1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Edge</span> <span class="o">&amp;</span><span class="n">e2</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">return</span> <span class="n">e1</span><span class="p">.</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">e2</span><span class="p">.</span><span class="n">len</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">};</span>
	<span class="n">ll</span> <span class="n">ans</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vis</span><span class="p">;</span>
	<span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">Edge</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">DisGreater</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">;</span>
	<span class="n">Prim</span><span class="p">(</span><span class="k">const</span> <span class="n">Graph</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">,</span> <span class="kt">int</span> <span class="n">root</span><span class="p">)</span> <span class="o">:</span> <span class="n">Tree</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">ans</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">vis</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">//生成新树，每条边都要有等长反向边
</span>	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">insert</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">g</span><span class="p">);</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">();)</span>
		<span class="p">{</span>
			<span class="n">Edge</span> <span class="n">ed</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">();</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">pop</span><span class="p">(),</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">])</span>
				<span class="n">insert</span><span class="p">(</span><span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">,</span> <span class="n">g</span><span class="p">),</span> <span class="n">ans</span> <span class="o">+=</span> <span class="n">ed</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="k">const</span> <span class="n">Graph</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">)</span> <span class="c1">//把点和对应的相连的边加入集合
</span>	<span class="p">{</span>
		<span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">g</span><span class="p">.</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">])</span>
				<span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="n">ll</span> <span class="nf">kruskal</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="c1">//会清空边集e，每条边被认作无向边
</span><span class="p">{</span>
	<span class="n">ll</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">UnionFindSet</span> <span class="n">ufs</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">sort</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">e</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">DisGreater</span><span class="p">());</span> <span class="o">!</span><span class="n">e</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span> <span class="n">e</span><span class="p">.</span><span class="n">pop_back</span><span class="p">())</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ufs</span><span class="p">.</span><span class="n">fa</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">from</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ufs</span><span class="p">.</span><span class="n">fa</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">to</span><span class="p">))</span>
		<span class="p">{</span>
			<span class="n">ufs</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">from</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">to</span><span class="p">);</span>
			<span class="n">ret</span> <span class="o">+=</span> <span class="n">e</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">len</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="k">return</span> <span class="cm">/*ufs.siz&gt;1?INF:*/</span> <span class="n">ret</span><span class="p">;</span> <span class="c1">//视情况选择去注释
</span><span class="p">}</span>
</code></pre></div></div>

<h4 id="有向图">有向图</h4>

<p><a href="https://vjudge.net/solution/16971789">使用示例</a></p>

<p>指定以root为根，如果没有限定根那么新建一个虚拟点作为根，向所有边连边长<strong>最大边长+1</strong>的边，在最后生成的图中去掉此边。时间复杂度$O(VE)$。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ll</span> <span class="nf">zhuLiu</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">,</span> <span class="kt">int</span> <span class="n">root</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="c1">//不存在返回INF
</span><span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">ll</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;;)</span>
	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">in</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">INF</span><span class="p">);</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">pre</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">first</span> <span class="o">==</span> <span class="p">(</span><span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">second</span><span class="p">))</span>
				<span class="n">swap</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="o">--</span><span class="p">],</span> <span class="n">e</span><span class="p">.</span><span class="n">back</span><span class="p">()),</span> <span class="n">e</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">in</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">len</span><span class="p">)</span>
				<span class="n">in</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">len</span><span class="p">,</span> <span class="n">pre</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">first</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">in</span> <span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">in</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">INF</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">INF</span><span class="p">;</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">id</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">vis</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
		<span class="kt">int</span> <span class="n">tn</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">ret</span> <span class="o">+=</span> <span class="n">in</span> <span class="p">[</span><span class="n">v</span> <span class="o">=</span> <span class="n">i</span><span class="p">];</span> <span class="n">vis</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="o">&amp;&amp;</span> <span class="n">id</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="n">n</span> <span class="o">&amp;&amp;</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">root</span><span class="p">;</span> <span class="n">v</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>
				<span class="n">vis</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">!=</span> <span class="n">root</span> <span class="o">&amp;&amp;</span> <span class="n">id</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="n">n</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="n">v</span><span class="p">];</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">v</span><span class="p">;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
					<span class="n">id</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">tn</span><span class="p">;</span>
				<span class="n">id</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">tn</span><span class="o">++</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">tn</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">id</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">n</span><span class="p">)</span>
				<span class="n">id</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tn</span><span class="o">++</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">first</span> <span class="o">=</span> <span class="n">id</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">first</span><span class="p">])</span> <span class="o">!=</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">second</span> <span class="o">=</span> <span class="n">id</span><span class="p">[</span><span class="n">v</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">second</span><span class="p">]))</span>
				<span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">len</span> <span class="o">-=</span> <span class="n">in</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
		<span class="n">n</span> <span class="o">=</span> <span class="n">tn</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span> <span class="n">id</span><span class="p">[</span><span class="n">root</span><span class="p">];</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="树链剖分与lca">树链剖分与LCA</h3>

<p><a href="https://vjudge.net/solution/16971586">使用示例</a></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Diagram</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">Fenwick</span> <span class="n">data</span><span class="p">;</span> <span class="c1">//暂用树状数组作为默认数据结构
</span>	<span class="n">Diagram</span><span class="p">(</span><span class="k">const</span> <span class="n">Graph</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">,</span> <span class="kt">int</span> <span class="n">root</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()),</span> <span class="n">data</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
	<span class="p">{</span>
		<span class="n">build</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">g</span><span class="p">);</span>
		<span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">root</span><span class="p">].</span><span class="n">dfn</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">root</span><span class="p">].</span><span class="n">dep</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">dfs</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">root</span><span class="p">].</span><span class="n">top</span> <span class="o">=</span> <span class="n">root</span><span class="p">,</span> <span class="n">cnt</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">build</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="k">const</span> <span class="n">Graph</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">)</span> <span class="c1">//无向图dfs建树，且重边在最前，u为根节点
</span>	<span class="p">{</span>
		<span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">siz</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="o">!</span><span class="n">v</span><span class="p">[</span><span class="n">to</span><span class="p">].</span><span class="n">siz</span><span class="p">)</span> <span class="c1">//没访问过的点siz默认0
</span>			<span class="p">{</span>
				<span class="n">build</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">g</span><span class="p">);</span>
				<span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">siz</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">to</span><span class="p">].</span><span class="n">siz</span><span class="p">;</span>
				<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">ch</span><span class="p">(</span><span class="n">u</span><span class="p">)].</span><span class="n">siz</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">to</span><span class="p">].</span><span class="n">siz</span><span class="p">)</span> <span class="c1">//重边移到最前
</span>					<span class="n">swap</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">front</span><span class="p">(),</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">back</span><span class="p">());</span>
			<span class="p">}</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">cnt</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">v</span><span class="p">[</span><span class="n">to</span> <span class="o">=</span> <span class="n">ch</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">i</span><span class="p">)].</span><span class="n">dfn</span> <span class="o">=</span> <span class="o">++</span><span class="n">cnt</span><span class="p">;</span>
			<span class="n">v</span><span class="p">[</span><span class="n">to</span><span class="p">].</span><span class="n">top</span> <span class="o">=</span> <span class="n">i</span> <span class="o">?</span> <span class="n">to</span> <span class="o">:</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">top</span><span class="p">;</span>
			<span class="n">v</span><span class="p">[</span><span class="n">to</span><span class="p">].</span><span class="n">dep</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">dep</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">dfs</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">cnt</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">lca</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(;</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span> <span class="o">!=</span> <span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">top</span><span class="p">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">fa</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">))</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dep</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dep</span><span class="p">)</span>
				<span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dep</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">dep</span><span class="p">)</span>
			<span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">y</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">ll</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(;</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span> <span class="o">!=</span> <span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">top</span><span class="p">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">fa</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">))</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dep</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dep</span><span class="p">)</span>
				<span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
			<span class="n">ans</span> <span class="o">+=</span> <span class="n">data</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dfn</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dfn</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dep</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">dep</span><span class="p">)</span>
			<span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">ans</span> <span class="o">+=</span> <span class="n">data</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">dfn</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dfn</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="n">ll</span> <span class="n">pv</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(;</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span> <span class="o">!=</span> <span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">top</span><span class="p">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">fa</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">))</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dep</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dep</span><span class="p">)</span>
				<span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
			<span class="n">data</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dfn</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dfn</span><span class="p">,</span> <span class="n">pv</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dep</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">dep</span><span class="p">)</span>
			<span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
		<span class="n">data</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">dfn</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dfn</span><span class="p">,</span> <span class="n">pv</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="点剖点分治">点剖（点分治）</h3>

<p><a href="https://vjudge.net/solution/16971666">使用示例</a>，零号点为虚节点。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">TreeDiv</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">root</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">mx</span><span class="p">,</span> <span class="n">siz</span><span class="p">,</span> <span class="n">vis</span><span class="p">;</span>
	<span class="n">TreeDiv</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">mx</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">siz</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">vis</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">dfsRoot</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fa</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">mx</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">siz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">to</span> <span class="o">!=</span> <span class="n">fa</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">dfsRoot</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">u</span><span class="p">),</span> <span class="n">siz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+=</span> <span class="n">siz</span><span class="p">[</span><span class="n">to</span><span class="p">],</span> <span class="n">mx</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">siz</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
					<span class="n">mx</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">siz</span><span class="p">[</span><span class="n">to</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">mx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="o">++</span><span class="n">siz</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
			<span class="n">mx</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">mx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">siz</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">mx</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
			<span class="n">root</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">dfsDis</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fa</span><span class="p">,</span> <span class="n">ll</span> <span class="n">d</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="c1">//用d更新答案
</span>		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">to</span> <span class="o">!=</span> <span class="n">fa</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
				<span class="n">dfsDis</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">d</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">cal</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">ll</span> <span class="n">d</span><span class="p">)</span> <span class="c1">//返回符合要求的点对数
</span>	<span class="p">{</span>
		<span class="k">return</span> <span class="n">dfsDis</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="cm">/*得到答案*/</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">dfsRoot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">ans</span> <span class="o">+=</span> <span class="n">cal</span><span class="p">(</span><span class="n">u</span> <span class="o">=</span> <span class="n">root</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
				<span class="n">ans</span> <span class="o">-=</span> <span class="n">cal</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">),</span> <span class="n">mx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">siz</span><span class="p">[</span><span class="n">to</span><span class="p">],</span> <span class="n">dfs</span><span class="p">(</span><span class="n">to</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

  
  <h1>
    <a href="/posts/acm/template/%E6%95%B0%E8%AE%BA">
      数论
    </a>
  </h1>
  <h2 id="辗转相除法">辗转相除法</h2>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ll</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span> <span class="n">ll</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">b</span> <span class="o">?</span> <span class="n">gcd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span> <span class="o">:</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//a、b的最大公约数
</span><span class="n">ll</span> <span class="nf">lcm</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span> <span class="n">ll</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>	 <span class="c1">//a、b的最小公倍数
</span><span class="n">ll</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span> <span class="n">ll</span> <span class="n">b</span><span class="p">,</span> <span class="n">ll</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="n">ll</span> <span class="o">&amp;</span><span class="n">y</span><span class="p">)</span>					 <span class="c1">//扩展欧几里得，引用返回a*x+b*y=gcd(a,b)绝对值之和最小的解
</span><span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">a</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
	<span class="n">ll</span> <span class="n">d</span> <span class="o">=</span> <span class="n">gcd</span><span class="p">(</span><span class="n">b</span> <span class="o">%</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">x</span> <span class="o">-=</span> <span class="n">b</span> <span class="o">/</span> <span class="n">a</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="n">d</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">ll</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span> <span class="n">ll</span> <span class="n">b</span><span class="p">)</span> <span class="c1">//无取模求gcd
</span><span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">ll</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">;;)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">t</span> <span class="o">*</span> <span class="n">a</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">)</span>
			<span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">a</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">d</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">b</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&amp;&amp;</span> <span class="n">d</span><span class="p">)</span>
			<span class="n">t</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">c</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">d</span><span class="p">)</span>
			<span class="n">a</span> <span class="o">-=</span> <span class="n">b</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="裴蜀定理">裴蜀定理</h3>

<p>对任何$a,b\in Z$和它们的最大公约数$d$，关于未知数$x,y$的线性不定方程（称为裴蜀等式）：$ax+by=c$当仅当$d\vert c$，可知有无穷多解。特别地，$ax+by=d$一定有解。</p>

<h4 id="推论">推论</h4>

<p>$a,b$互质的充要条件是$ax+by=1$有整数解。</p>

<h2 id="同余系运算">同余系运算</h2>

<p>三种乘法的比较，结论是如果可以用<code class="highlighter-rouge">__int128</code>就用，否则就用第一种：</p>

<ul>
  <li><a href="https://vjudge.net/solution/19521824">使用<code class="highlighter-rouge">__int128</code></a></li>
  <li><a href="https://vjudge.net/solution/19853184">第一种同余乘法</a></li>
  <li><a href="https://vjudge.net/solution/19521800">第二种同余乘法</a></li>
</ul>

<p>求乘法逆元的另外一种方法是用欧拉定理$x^{\phi(m)}\equiv1\pmod m$，x的逆是$x^{\phi(m)-1}$。特别地，m为素数时$\phi(m)=m-1$，此时x的逆就是<code class="highlighter-rouge">pow(x,m-2,m)</code>。</p>

<p>log函数：m为素数时<a href="https://vjudge.net/solution/19395246">求解模方程</a>$a^x\equiv b\pmod m$。设P为质数，G为P的原根，则$x^y\equiv b\pmod P$等价于$y\ ind\ x\equiv b\pmod{P-1}$，其中$G\ ind\ x\equiv x\pmod P$。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Mod</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="n">ll</span> <span class="n">M</span><span class="p">,</span> <span class="n">SM</span><span class="p">;</span>
	<span class="n">Mod</span><span class="p">(</span><span class="n">ll</span> <span class="n">M</span><span class="p">)</span> <span class="o">:</span> <span class="n">M</span><span class="p">(</span><span class="n">M</span><span class="p">),</span> <span class="n">SM</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="p">{}</span>
	<span class="n">ll</span> <span class="n">qadd</span><span class="p">(</span><span class="n">ll</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="n">ll</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">+=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="n">M</span> <span class="o">?</span> <span class="n">a</span> <span class="o">-=</span> <span class="n">M</span> <span class="o">:</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//假如a+b&lt;2*M，就不必取模了，取模运算耗时很高
</span>	<span class="n">ll</span> <span class="n">add</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span> <span class="n">ll</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">qadd</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">%</span> <span class="n">M</span><span class="p">,</span> <span class="n">M</span><span class="p">);</span> <span class="p">}</span>	  <span class="c1">//考虑a和b不在同余系内甚至为负数的情况
</span>	<span class="n">ll</span> <span class="n">mul</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span> <span class="n">ll</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">add</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">,</span> <span class="n">M</span><span class="p">);</span> <span class="p">}</span>
	<span class="n">ll</span> <span class="n">inv</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">2</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//要求M为素数，否则return pow(a, phi(M) - 1);
</span>	<span class="n">ll</span> <span class="n">pow</span><span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span> <span class="n">ll</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span>
	<span class="p">{</span>
		<span class="n">ll</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="cm">/*
		if (b &lt; 0)
			b = -b, a = inv(a);
		*/</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">M</span><span class="p">);</span> <span class="n">b</span><span class="p">;</span> <span class="n">b</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
				<span class="n">r</span> <span class="o">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/*
	ll mul(ll a, ll b) const { return add(a * b, -M * (ll)((long double)a / M * b)); } //long double 有效位数16~18位，模数过大时慎用！
	ll mul(ll a, ll b) const //Head算法，无循环快速计算同余乘法，根据a*b是否爆ll替换a*b%M，需要a&lt;M且b&lt;M，可以调用时手动取模
	{
		ll c = a / SM, d = b / SM;
		a %= SM, b %= SM;
		ll e = add(add(a * d, b * c), c * d / SM * (SM * SM - M));
		return add(add(a * b, e % SM * SM), add(c * d % SM, e / SM) * (SM * SM - M));
	}
	ll mul(ll a, ll b) const //龟速乘
	{
		ll r = 0;
		for (a %= M; b; b &gt;&gt;= 1, qadd(a, a))
			if (b &amp; 1)
				qadd(r, a);
		return r;
	}
	ll inv(ll a) const //模m下a的乘法逆元，不存在返回-1（m为素数时a不为0必有逆元）
	{
		ll x, y, d = gcd(a, M, x, y);
		return d == 1 ? add(x, M) : -1;
	}
	vector&lt;ll&gt; sol(ll a, ll b) const //解同余方程，返回ax=b(mod M)循环节内所有解
	{
		vector&lt;ll&gt; ans;
		ll x, y, d = gcd(a, M, x, y);
		if (b % d)
			return ans;
		ans.push_back(mul((b / d) % (M / d), x));
		for (ll i = 1; i &lt; d; ++i)
			ans.push_back(add(ans.back(), M / d));
		return ans;
	}
	ll log(ll a, ll b) const
	{
		unordered_map&lt;ll, ll&gt; x;
		for (ll i = 0, e = 1; i &lt;= SM; ++i, e = mul(e, a))
			if (!x.count(e))
				x[e] = i;
		for (ll i = 0, v = inv(pow(a, SM)); i &lt;= SM; ++i, b = mul(b, v))
			if (x.count(b))
				return i * SM + x[b];
		return -1;
	}
	*/</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="中国剩余定理解同余方程组">中国剩余定理解同余方程组</h3>

<p><a href="https://vjudge.net/solution/14375815">使用示例</a></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ll</span> <span class="nf">crt</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">ll</span><span class="p">,</span> <span class="n">ll</span><span class="o">&gt;&gt;</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">)</span> <span class="c1">//同余方程组，x%v[i].first==v[i].second，不存在返回-1
</span><span class="p">{</span>
	<span class="n">ll</span> <span class="n">m</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">first</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">second</span> <span class="o">-</span> <span class="n">r</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">gcd</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">first</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">c</span> <span class="o">%</span> <span class="n">d</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">gcd</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="n">d</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">first</span> <span class="o">/</span> <span class="n">d</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">r</span> <span class="o">+=</span> <span class="n">c</span> <span class="o">/</span> <span class="n">d</span> <span class="o">*</span> <span class="n">x</span> <span class="o">%</span> <span class="n">z</span> <span class="o">*</span> <span class="n">m</span><span class="p">,</span> <span class="n">r</span> <span class="o">%=</span> <span class="n">m</span> <span class="o">*=</span> <span class="n">z</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">r</span> <span class="o">+</span> <span class="n">m</span> <span class="o">:</span> <span class="n">r</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">struct</span> <span class="n">Excrt</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">b2</span><span class="p">,</span> <span class="n">a2</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
	<span class="kt">void</span> <span class="nf">init</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
		<span class="n">ll</span> <span class="n">q</span><span class="p">,</span> <span class="n">qq</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">scanf</span><span class="p">(</span><span class="s">"%lld%lld"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">qq</span><span class="p">),</span> <span class="n">b2</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">a2</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">qq</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="nf">get</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">ll</span> <span class="n">M</span><span class="p">,</span> <span class="n">ans</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">M</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">ll</span> <span class="n">a</span> <span class="o">=</span> <span class="n">M</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">ans</span> <span class="o">%</span> <span class="n">b</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">%</span> <span class="n">b</span><span class="p">;</span> <span class="c1">//ax=c(mod b)
</span>			<span class="n">ll</span> <span class="n">gcd</span> <span class="o">=</span> <span class="n">exgcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">bg</span> <span class="o">=</span> <span class="n">b</span> <span class="o">/</span> <span class="n">gcd</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">%</span> <span class="n">gcd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span> <span class="c1">//返回-1表示无解
</span>			<span class="n">x</span> <span class="o">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="o">/</span> <span class="n">gcd</span><span class="p">,</span> <span class="n">bg</span><span class="p">);</span>
			<span class="n">y</span> <span class="o">=</span> <span class="n">M</span> <span class="o">/</span> <span class="n">gcd</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span>
			<span class="n">ans</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">ans</span><span class="p">)</span> <span class="o">%</span> <span class="n">y</span><span class="p">;</span> <span class="c1">//???k???????
</span>			<span class="k">if</span> <span class="p">(</span><span class="n">ans</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="n">ans</span> <span class="o">+=</span> <span class="n">y</span><span class="p">;</span>
			<span class="n">M</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span> <span class="c1">//M??k?m?lcm
</span>		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="二次剩余">二次剩余</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">QuadraticRes</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">numb</span>
	<span class="p">{</span>
		<span class="n">ll</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="n">numb</span> <span class="nf">mul</span><span class="p">(</span><span class="k">const</span> <span class="n">numb</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">numb</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">,</span> <span class="n">ll</span> <span class="n">p</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">numb</span><span class="p">){(</span><span class="n">a</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">b</span><span class="p">.</span><span class="n">x</span> <span class="o">%</span> <span class="n">p</span> <span class="o">+</span> <span class="n">a</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">b</span><span class="p">.</span><span class="n">y</span> <span class="o">%</span> <span class="n">p</span> <span class="o">*</span> <span class="n">w</span> <span class="o">%</span> <span class="n">p</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">b</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">a</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">};</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="nf">pow2</span><span class="p">(</span><span class="n">numb</span> <span class="n">a</span><span class="p">,</span> <span class="n">ll</span> <span class="n">b</span><span class="p">,</span> <span class="n">ll</span> <span class="n">p</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">numb</span> <span class="n">ret</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="n">tem</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
				<span class="n">ret</span> <span class="o">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
			<span class="n">tem</span> <span class="o">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">b</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">.</span><span class="n">x</span> <span class="o">%</span> <span class="n">p</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="nf">get</span><span class="p">(</span><span class="n">ll</span> <span class="n">n</span><span class="p">,</span> <span class="n">ll</span> <span class="n">p</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">Mod</span><span class="p">(</span><span class="n">p</span><span class="p">).</span><span class="n">pow</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="c1">//此时无解
</span>		<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">ll</span> <span class="n">a</span> <span class="o">=</span> <span class="n">rand</span><span class="p">();</span>
			<span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">a</span> <span class="o">-</span> <span class="n">n</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">Mod</span><span class="p">(</span><span class="n">p</span><span class="p">).</span><span class="n">pow</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">p</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">return</span> <span class="n">pow2</span><span class="p">((</span><span class="n">numb</span><span class="p">){</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="n">p</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span> <span class="c1">//还有一个解是p减去这个值
</span>			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="欧拉筛">欧拉筛</h2>

<p>欧拉函数$\phi(n)$是小于n的正整数中与n互素的数的数目。特别地，规定$\phi(1)=1$，易知n&gt;2时都为偶数。</p>

<p>欧拉函数是积性函数，即对任意素数$p,q$满足下列关系：$\phi(pq)=\phi(p)\phi(q)=(p-1)(q-1)$对任何两个互质的正整数$x, m(m\geq2)$有欧拉定理：$x^{\phi(m)}\equiv1\pmod m$当m为素数p时，此式变为费马小定理：$x^{p-1}\equiv1\pmod p$利用欧拉函数和它本身不同质因数的关系，用筛法$O(N)$预处理某个范围内所有数的欧拉函数值，并求出素数表。同时，利用计算欧拉函数过程中求出的最小素因子m，可以实现$O(log N)$的素因数分解。</p>

<p>同时求莫比乌斯函数$\mu(n)$，存在<code class="highlighter-rouge">mu</code>中。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">EulerSieve</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">mu</span><span class="p">;</span> <span class="c1">//素数序列，最小素因子，欧拉函数，莫比乌斯函数
</span>	<span class="n">EulerSieve</span><span class="p">(</span><span class="kt">int</span> <span class="n">N</span><span class="p">)</span> <span class="o">:</span> <span class="n">m</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">phi</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">mu</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>					 <span class="c1">//m[1]=0,m[i]==i可判断i是素数
</span>		<span class="k">for</span> <span class="p">(</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="c1">//防i*p[j]爆int
</span>		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="n">p</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">),</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">//i是素数
</span>			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">phi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
				<span class="k">if</span> <span class="p">((</span><span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="p">{</span>
					<span class="n">mu</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="n">phi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
				<span class="n">mu</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="直接求欧拉函数"><a href="https://vjudge.net/solution/19396361">直接求欧拉函数</a></h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ll</span> <span class="nf">phi</span><span class="p">(</span><span class="n">ll</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">phi</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">ll</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">*</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="n">i</span><span class="p">))</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">phi</span> <span class="o">=</span> <span class="n">phi</span> <span class="o">/</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> <span class="o">!</span><span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="n">i</span><span class="p">);)</span>
				<span class="n">n</span> <span class="o">/=</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">phi</span> <span class="o">=</span> <span class="n">phi</span> <span class="o">/</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">phi</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="常见数论函数变换">常见数论函数变换</h3>

<p>$\sum_{d\vert n}\mu(d)=[n=1]$</p>

<p>$\phi(n)=\sum_{i=1}^n[\gcd(i,n)=1]=\sum_{i=1}^n\sum_{k\mid i,k\mid n}\mu(k)=\sum_{k\mid n}\frac nk\mu(k)$</p>

<h4 id="前缀和">前缀和</h4>

<p>欧拉函数前缀和$S_\phi(n)=\frac{(n+1)n}2-\sum_{d=1}^nS_\phi(\frac{n}{d})$</p>

<p>莫比乌斯函数前缀和$S_\mu(n)=1-\sum_{d=1}^nS_\mu(\frac{n}{d})$</p>

<h4 id="莫比乌斯反演">莫比乌斯反演</h4>

<p>若$f(n)=\sum_{d\vert n}g(d)$，则$g(n)=\sum_{d\vert n}\mu(d)f(\frac{n}{d})$</p>

<p>若$f(n)=\sum_{i=1}^nt(i)g(\frac{n}{i})$，则$g(n)=\sum_{i=1}^n\mu(i)t(i)f(\frac{n}{i})$（此时代$t(i)=[gcd(n,i)&gt;1]$可得上式）</p>

<p>举例（其中$T=kd$）：</p>

<p>$
\sum_{i=1}^n\sum_{j=1}^m\gcd(i,j)<br />
=\sum_d d\sum_{i=1}^n\sum_{j=1}^m[\gcd (i,j)=d]<br />
=\sum_{d}d\sum_{i=1}^{\lfloor\frac nd\rfloor}\sum_{j=1}^{\lfloor\frac md\rfloor}[\gcd (i,j)=1]<br />
=\sum_{d}d\sum_{i=1}^{\lfloor\frac nd\rfloor}\sum_{j=1}^{\lfloor\frac md\rfloor}\sum_{k\mid i,k\mid j}\mu(k)<br />
=\sum_d d\sum_k\mu(k)\sum_{k\mid i}^{\lfloor\frac nd\rfloor}\sum_{k\mid j}^{\lfloor\frac md\rfloor}<br />
=\sum_{d}d\sum_k\mu(k)\lfloor\frac n{kd}\rfloor\lfloor\frac m{kd}\rfloor<br />
=\sum_{T}\lfloor\frac nT\rfloor\lfloor\frac mT\rfloor\sum_{k\mid T}\frac Tk\mu(k)<br />
=\sum_{T}\lfloor\frac nT\rfloor\lfloor\frac mT\rfloor\varphi(T)
$</p>

<p>$\varphi(T)$可以使用线性筛预处理处理，我们就可以枚举$T$求上式了，时间复杂度$O(n)$。多组数据$n,m$询问上式，时间复杂度就变成了$O(Tn)$。事实上，$\lfloor\frac{n}{T}\rfloor$是不会轻易变化的，是过了连续的一段后才发生变化的，那么我们就可以计算出这一段的结束位置，对$\varphi$函数作前缀和，就可以直接分块了，这样的时间复杂度是$O(T\sqrt{n})$的。</p>

<h2 id="pollardrho大数素因子分解">PollardRho大数素因子分解</h2>

<p>时间复杂度$O(N^{1/4})$，数据多的时候可考虑欧拉筛优化。</p>

<p>注意这里模乘法很容易爆long long，看情况选用快速乘法。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">PollardRho</span>
<span class="p">{</span>
	<span class="kt">bool</span> <span class="n">isPrime</span><span class="p">(</span><span class="n">ll</span> <span class="n">n</span><span class="p">,</span> <span class="kt">int</span> <span class="n">S</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span> <span class="c1">//MillerRabin素数测试，S为测试次数，用前S个素数测一遍，S=12可保证unsigned long long范围内无错；n&lt;2请特判
</span>	<span class="p">{</span>
		<span class="k">static</span> <span class="n">ll</span> <span class="n">d</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">37</span><span class="p">};</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">d</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">!</span><span class="p">(</span><span class="n">d</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);)</span>
			<span class="n">d</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//未对0，1做特判！
</span>		<span class="n">Mod</span> <span class="n">mo</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">S</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
				<span class="k">return</span> <span class="n">n</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">t</span> <span class="o">=</span> <span class="n">mo</span><span class="p">.</span><span class="n">pow</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">u</span> <span class="o">=</span> <span class="n">d</span><span class="p">);</span> <span class="n">t</span> <span class="o">!=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">t</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;)</span>
				<span class="n">t</span> <span class="o">=</span> <span class="n">mo</span><span class="p">.</span><span class="n">mul</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="n">u</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">!=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">u</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">))</span>
				<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">fac</span><span class="p">(</span><span class="n">ll</span> <span class="n">n</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">factor</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="cm">/*
		if (n &lt; e.m.size()) //欧拉筛预处理优化，可以防止很多小素数因子的情况
		{
			for (; n &gt; 1; n /= e.m[n])
				factor.push_back(e.m[n]);
			return;
		}
		*/</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">isPrime</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
			<span class="k">return</span> <span class="n">factor</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
		<span class="n">Mod</span> <span class="n">mo</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">ll</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;;</span> <span class="o">++</span><span class="n">c</span><span class="p">)</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">ll</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">;;)</span>
			<span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">i</span> <span class="o">==</span> <span class="n">k</span><span class="p">)</span>
					<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">k</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">mo</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">mo</span><span class="p">.</span><span class="n">mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">c</span><span class="p">),</span> <span class="n">p</span> <span class="o">=</span> <span class="n">__gcd</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">),</span> <span class="n">n</span><span class="p">),</span> <span class="n">p</span> <span class="o">==</span> <span class="n">n</span><span class="p">)</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
					<span class="k">return</span> <span class="n">fac</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">factor</span><span class="p">),</span> <span class="n">fac</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="n">p</span><span class="p">,</span> <span class="n">factor</span><span class="p">);</span>
			<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="快速变换">快速变换</h2>

<h3 id="蝴蝶变换雷德变换">蝴蝶变换（雷德变换）</h3>

<p>保存FTT和FNTT时交换的对应位置（即保存的是置换）。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Rader</span> <span class="o">:</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span>
<span class="p">{</span>
	<span class="n">Rader</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">log2</span><span class="p">(</span><span class="n">n</span><span class="p">))))</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">at</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
				<span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+=</span> <span class="n">size</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="快速傅里叶变换">快速傅里叶变换</h3>

<p><a href="https://vjudge.net/solution/21912936">使用示例</a>，高精度乘法。</p>

<p><a href="https://vjudge.net/solution/21914340">任意模数FFT</a></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">FFT</span> <span class="o">:</span> <span class="n">Rader</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">complex</span><span class="o">&lt;</span><span class="n">lf</span><span class="o">&gt;&gt;</span> <span class="n">w</span><span class="p">;</span>
	<span class="n">FFT</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Rader</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">w</span><span class="p">(</span><span class="n">size</span><span class="p">())</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">polar</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">size</span><span class="p">());</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">fft</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">complex</span><span class="o">&lt;</span><span class="n">lf</span><span class="o">&gt;&gt;</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">)</span> <span class="k">const</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
				<span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)]);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">)</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">();</span> <span class="n">k</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">complex</span><span class="o">&lt;</span><span class="n">lf</span><span class="o">&gt;</span> <span class="n">t</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">size</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">];</span>
					<span class="n">x</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">t</span><span class="p">;</span>
				<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">ask</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="k">const</span>
	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">complex</span><span class="o">&lt;</span><span class="n">lf</span><span class="o">&gt;&gt;</span> <span class="n">xa</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">a</span><span class="p">.</span><span class="n">end</span><span class="p">()),</span> <span class="n">xb</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">b</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
		<span class="n">xa</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">size</span><span class="p">()),</span> <span class="n">xb</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">size</span><span class="p">()),</span> <span class="n">fft</span><span class="p">(</span><span class="n">xa</span><span class="p">),</span> <span class="n">fft</span><span class="p">(</span><span class="n">xb</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">xa</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="n">xb</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="n">fft</span><span class="p">(</span><span class="n">xa</span><span class="p">);</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">ans</span><span class="p">(</span><span class="n">size</span><span class="p">());</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xa</span><span class="p">[(</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)].</span><span class="n">real</span><span class="p">()</span> <span class="o">/</span> <span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">askMod</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">,</span> <span class="n">ll</span> <span class="n">M</span><span class="p">)</span> <span class="k">const</span> <span class="c1">//任意模数
</span>	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">complex</span><span class="o">&lt;</span><span class="n">lf</span><span class="o">&gt;&gt;</span> <span class="n">e</span><span class="p">(</span><span class="n">size</span><span class="p">()),</span> <span class="n">c</span><span class="p">(</span><span class="n">size</span><span class="p">());</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">real</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x7fff</span><span class="p">),</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">imag</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">real</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x7fff</span><span class="p">),</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">imag</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">);</span>
		<span class="n">fft</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">fft</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">complex</span><span class="o">&lt;</span><span class="n">lf</span><span class="o">&gt;&gt;</span> <span class="n">d</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="kt">int</span> <span class="n">fr</span> <span class="o">=</span> <span class="p">(</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">complex</span><span class="o">&lt;</span><span class="n">lf</span><span class="o">&gt;</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">X</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">fr</span><span class="p">].</span><span class="n">X</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Y</span> <span class="o">-</span> <span class="n">e</span><span class="p">[</span><span class="n">fr</span><span class="p">].</span><span class="n">Y</span><span class="p">);</span>
			<span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">complex</span><span class="o">&lt;</span><span class="n">lf</span><span class="o">&gt;</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Y</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">fr</span><span class="p">].</span><span class="n">Y</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">fr</span><span class="p">].</span><span class="n">X</span> <span class="o">-</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">X</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">fft</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">fft</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">ans</span><span class="p">(</span><span class="n">size</span><span class="p">());</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">ll</span> <span class="n">fr</span> <span class="o">=</span> <span class="p">(</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
			   <span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">fr</span><span class="p">].</span><span class="n">X</span> <span class="o">/</span> <span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span>
			   <span class="n">o</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">fr</span><span class="p">].</span><span class="n">Y</span> <span class="o">/</span> <span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span>
			   <span class="n">x</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">fr</span><span class="p">].</span><span class="n">X</span> <span class="o">/</span> <span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span>
			   <span class="n">u</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">fr</span><span class="p">].</span><span class="n">Y</span> <span class="o">/</span> <span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span>
			<span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">%</span> <span class="n">M</span> <span class="o">+</span> <span class="p">((</span><span class="n">o</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span> <span class="o">%</span> <span class="n">M</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">u</span> <span class="o">%</span> <span class="n">M</span> <span class="o">&lt;&lt;</span> <span class="mi">30</span><span class="p">))</span> <span class="o">%</span> <span class="n">M</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="快速数论变换">快速数论变换</h3>

<p>原理和FFT相同，解决特殊情况下FFT的浮点误差，并且可以在同余系进行变换。</p>

<p>对于形如$m=2^nc+1$的费马素数，记其原根为g，则旋转因子为$g^{(m-1)/n}$，满足$g^{m-1}=1$且$2^n\mid m-1$。</p>

<p><a href="https://vjudge.net/solution/21913390">使用示例</a></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">FNTT</span> <span class="o">:</span> <span class="n">Rader</span><span class="p">,</span> <span class="n">Mod</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">w</span><span class="p">;</span>
	<span class="n">FNTT</span><span class="p">(</span><span class="kt">int</span> <span class="n">N</span><span class="p">,</span> <span class="n">ll</span> <span class="n">M</span><span class="p">,</span> <span class="n">ll</span> <span class="n">G</span><span class="p">)</span> <span class="o">:</span> <span class="n">Rader</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">Mod</span><span class="p">(</span><span class="n">M</span><span class="p">),</span> <span class="n">w</span><span class="p">(</span><span class="n">size</span><span class="p">(),</span> <span class="n">pow</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="p">(</span><span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">size</span><span class="p">()))</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">fntt</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">)</span> <span class="k">const</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
				<span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)]);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">)</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">();</span> <span class="n">k</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">ll</span> <span class="n">t</span> <span class="o">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">size</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">j</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]);</span>
					<span class="n">qadd</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">M</span> <span class="o">-</span> <span class="n">t</span><span class="p">),</span> <span class="n">qadd</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">t</span><span class="p">);</span>
				<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">ask</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span>
	<span class="p">{</span>
		<span class="n">a</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">size</span><span class="p">()),</span> <span class="n">b</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">size</span><span class="p">()),</span> <span class="n">fntt</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">fntt</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="n">fntt</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">reverse</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
		<span class="n">ll</span> <span class="n">u</span> <span class="o">=</span> <span class="n">inv</span><span class="p">(</span><span class="n">size</span><span class="p">());</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">u</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">a</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h4 id="常见素数的原根"><a href="https://blog.csdn.net/hnust_xx/article/details/76572828">常见素数的原根</a></h4>

<table>
  <thead>
    <tr>
      <th>r * 2 ^ k + 1</th>
      <th>r</th>
      <th>k</th>
      <th>g，mod(r * 2 ^ k + 1)的原根</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <td>5</td>
      <td>1</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <td>17</td>
      <td>1</td>
      <td>4</td>
      <td>3</td>
    </tr>
    <tr>
      <td>97</td>
      <td>3</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <td>193</td>
      <td>3</td>
      <td>6</td>
      <td>5</td>
    </tr>
    <tr>
      <td>257</td>
      <td>1</td>
      <td>8</td>
      <td>3</td>
    </tr>
    <tr>
      <td>7681</td>
      <td>15</td>
      <td>9</td>
      <td>17</td>
    </tr>
    <tr>
      <td>12289</td>
      <td>3</td>
      <td>12</td>
      <td>11</td>
    </tr>
    <tr>
      <td>40961</td>
      <td>5</td>
      <td>13</td>
      <td>3</td>
    </tr>
    <tr>
      <td>65537</td>
      <td>1</td>
      <td>16</td>
      <td>3</td>
    </tr>
    <tr>
      <td>786433</td>
      <td>3</td>
      <td>18</td>
      <td>10</td>
    </tr>
    <tr>
      <td>5767169</td>
      <td>11</td>
      <td>19</td>
      <td>3</td>
    </tr>
    <tr>
      <td>7340033</td>
      <td>7</td>
      <td>20</td>
      <td>3</td>
    </tr>
    <tr>
      <td>23068673</td>
      <td>11</td>
      <td>21</td>
      <td>3</td>
    </tr>
    <tr>
      <td>104857601</td>
      <td>25</td>
      <td>22</td>
      <td>3</td>
    </tr>
    <tr>
      <td>167772161</td>
      <td>5</td>
      <td>25</td>
      <td>3</td>
    </tr>
    <tr>
      <td>469762049</td>
      <td>7</td>
      <td>26</td>
      <td>3</td>
    </tr>
    <tr>
      <td>998244353</td>
      <td>119</td>
      <td>23</td>
      <td>3</td>
    </tr>
    <tr>
      <td>1004535809</td>
      <td>479</td>
      <td>21</td>
      <td>3</td>
    </tr>
    <tr>
      <td>2013265921</td>
      <td>15</td>
      <td>27</td>
      <td>31</td>
    </tr>
    <tr>
      <td>2281701377</td>
      <td>17</td>
      <td>27</td>
      <td>3</td>
    </tr>
    <tr>
      <td>3221225473</td>
      <td>3</td>
      <td>30</td>
      <td>5</td>
    </tr>
    <tr>
      <td>75161927681</td>
      <td>35</td>
      <td>31</td>
      <td>3</td>
    </tr>
    <tr>
      <td>77309411329</td>
      <td>9</td>
      <td>33</td>
      <td>7</td>
    </tr>
    <tr>
      <td>206158430209</td>
      <td>3</td>
      <td>36</td>
      <td>22</td>
    </tr>
    <tr>
      <td>2061584302081</td>
      <td>15</td>
      <td>37</td>
      <td>7</td>
    </tr>
    <tr>
      <td>2748779069441</td>
      <td>5</td>
      <td>39</td>
      <td>3</td>
    </tr>
    <tr>
      <td>6597069766657</td>
      <td>3</td>
      <td>41</td>
      <td>5</td>
    </tr>
    <tr>
      <td>39582418599937</td>
      <td>9</td>
      <td>42</td>
      <td>5</td>
    </tr>
    <tr>
      <td>79164837199873</td>
      <td>9</td>
      <td>43</td>
      <td>5</td>
    </tr>
    <tr>
      <td>263882790666241</td>
      <td>15</td>
      <td>44</td>
      <td>7</td>
    </tr>
    <tr>
      <td>1231453023109121</td>
      <td>35</td>
      <td>45</td>
      <td>3</td>
    </tr>
    <tr>
      <td>1337006139375617</td>
      <td>19</td>
      <td>46</td>
      <td>3</td>
    </tr>
    <tr>
      <td>3799912185593857</td>
      <td>27</td>
      <td>47</td>
      <td>5</td>
    </tr>
    <tr>
      <td>4222124650659841</td>
      <td>15</td>
      <td>48</td>
      <td>19</td>
    </tr>
    <tr>
      <td>7881299347898369</td>
      <td>7</td>
      <td>50</td>
      <td>6</td>
    </tr>
    <tr>
      <td>31525197391593473</td>
      <td>7</td>
      <td>52</td>
      <td>3</td>
    </tr>
    <tr>
      <td>180143985094819841</td>
      <td>5</td>
      <td>55</td>
      <td>6</td>
    </tr>
    <tr>
      <td>1945555039024054273</td>
      <td>27</td>
      <td>56</td>
      <td>5</td>
    </tr>
    <tr>
      <td>4179340454199820289</td>
      <td>29</td>
      <td>57</td>
      <td>3</td>
    </tr>
  </tbody>
</table>

<h3 id="快速沃尔什变换">快速沃尔什变换</h3>

<p>如果要在同余系中进行运算，则下面代码需要修改。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">fwt</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="kt">void</span> <span class="n">f</span><span class="p">(</span><span class="n">ll</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="n">ll</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">))</span>
<span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">k</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span>
				<span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">]);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">fwt</span><span class="p">(</span><span class="n">ll</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="n">ll</span> <span class="o">*</span><span class="n">e</span><span class="p">,</span> <span class="kt">void</span> <span class="n">f</span><span class="p">(</span><span class="n">ll</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="n">ll</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">))</span> <span class="c1">//再给一个递归二分的代码便于理解
</span><span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">ll</span> <span class="o">*</span><span class="n">m</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">fwt</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="n">fwt</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">m</span> <span class="o">&lt;</span> <span class="n">e</span><span class="p">)</span>
		<span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">++</span><span class="p">),</span> <span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">++</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="and">AND</h4>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">tf</span><span class="p">(</span><span class="n">ll</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="n">ll</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span> <span class="n">l</span> <span class="o">+=</span> <span class="n">r</span><span class="p">;</span> <span class="p">}</span>
<span class="kt">void</span> <span class="nf">utf</span><span class="p">(</span><span class="n">ll</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="n">ll</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span> <span class="n">l</span> <span class="o">-=</span> <span class="n">r</span><span class="p">;</span> <span class="p">}</span>
</code></pre></div></div>

<h4 id="or">OR</h4>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">tf</span><span class="p">(</span><span class="n">ll</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="n">ll</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span> <span class="n">r</span> <span class="o">+=</span> <span class="n">l</span><span class="p">;</span> <span class="p">}</span>
<span class="kt">void</span> <span class="nf">utf</span><span class="p">(</span><span class="n">ll</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="n">ll</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span> <span class="n">r</span> <span class="o">-=</span> <span class="n">l</span><span class="p">;</span> <span class="p">}</span>
</code></pre></div></div>

<h4 id="xor">XOR</h4>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">tf</span><span class="p">(</span><span class="n">ll</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="n">ll</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">tl</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">,</span> <span class="n">tr</span> <span class="o">=</span> <span class="n">l</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
	<span class="n">l</span> <span class="o">=</span> <span class="n">tl</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">tr</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">utf</span><span class="p">(</span><span class="n">ll</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="n">ll</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span> <span class="n">tf</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">),</span> <span class="n">l</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
</code></pre></div></div>

<h4 id="xnornandnor">XNOR、NAND、NOR</h4>

<p>直接用异或运算、与运算、或运算的方法求出来，然后将互反的两位交换即可。</p>

<h2 id="pell方程">Pell方程</h2>

<p>形如$x^2-Dy^2=1$（D为任意正整数）的方程称为佩尔方程，必有最小正整数解$(x_0,y_0)$，用</p>

<p>$x_n=x_0x_{n-1}+Dy_0y_{n-1},y_n=y_0x_{n-1}+x_0y_{n-1}$</p>

<p>可递推方程的第n小整数解（可用矩阵快速幂求），同时还有</p>

<p>$2x_0x_n=x_{n-1}+x_{n+1},2x_0y_n=y_{n-1}+y_{n+1}$</p>

<h2 id="bertrand猜想">Bertrand猜想</h2>

<p>$\forall n&gt;3,\exist n&lt;p&lt;n\times 2$其中n为整数，p为质数。</p>

<h2 id="威尔逊定理">威尔逊定理</h2>

<p>当且仅当p为素数时：$(p-1)!\equiv -1\pmod p$，</p>

<h2 id="jacobis-four-square-theorem">Jacobi’s Four Square Theorem</h2>

<p>设$a^2+b^2+c^2+d^2=n$的自然数解个数为$r4(n)$，$d(n)$为$n$的约数和，由Jacobi’s Four Square Theorem可知，若$n$是奇数，则$r4(n)=8d(n)$，否则$r4(n)=24d(k)$，$k$是$n$去除所有$2$后的结果。</p>

  
  <h1>
    <a href="/posts/acm/template/%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6">
      组合数学
    </a>
  </h1>
  <h2 id="组合数取模">组合数取模</h2>
<p><a href="https://vjudge.net/solution/18275045">使用示例</a></p>

<p>为方便，记$C(n,m)=C_n^m=\binom{n}{m}$。</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Factorial</span> <span class="o">:</span> <span class="n">Mod</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">fac</span><span class="p">,</span> <span class="n">ifac</span><span class="p">;</span>
	<span class="n">Factorial</span><span class="p">(</span><span class="kt">int</span> <span class="n">N</span><span class="p">,</span> <span class="n">ll</span> <span class="n">M</span><span class="p">)</span> <span class="o">:</span> <span class="n">fac</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ifac</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">Mod</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">fac</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">fac</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">i</span><span class="p">),</span> <span class="n">ifac</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">M</span> <span class="o">-</span> <span class="n">M</span> <span class="o">/</span> <span class="n">i</span><span class="p">,</span> <span class="n">ifac</span><span class="p">[</span><span class="n">M</span> <span class="o">%</span> <span class="n">i</span><span class="p">]);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">ifac</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">ifac</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ifac</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">c</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">int</span> <span class="n">m</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">mul</span><span class="p">(</span><span class="n">mul</span><span class="p">(</span><span class="n">fac</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">ifac</span><span class="p">[</span><span class="n">m</span><span class="p">]),</span> <span class="n">ifac</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="n">m</span><span class="p">]);</span> <span class="p">}</span>
	<span class="n">ll</span> <span class="n">lucas</span><span class="p">(</span><span class="n">ll</span> <span class="n">n</span><span class="p">,</span> <span class="n">ll</span> <span class="n">m</span><span class="p">)</span> <span class="c1">//卢卡斯定理求C(n,m)%M，适用于模数M小于N的情况，或者m较小的时候也可以暴力求
</span>	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">m</span><span class="p">)</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="n">m</span> <span class="o">||</span> <span class="n">n</span> <span class="o">%</span> <span class="n">M</span> <span class="o">&lt;</span> <span class="n">m</span> <span class="o">%</span> <span class="n">M</span><span class="p">)</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="n">M</span> <span class="o">&amp;&amp;</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="n">M</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">c</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">mul</span><span class="p">(</span><span class="n">lucas</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="n">M</span><span class="p">,</span> <span class="n">m</span> <span class="o">/</span> <span class="n">M</span><span class="p">),</span> <span class="n">lucas</span><span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="n">M</span><span class="p">,</span> <span class="n">m</span> <span class="o">%</span> <span class="n">M</span><span class="p">));</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>
<h2 id="组合数lcm">组合数LCM</h2>
<p>$(n + 1)lcm(C(n,0),C(n,1),\ldots,C(n,k))=lcm(n+1,n,n−1,n−2,\ldots,n−k+1)$</p>

<p>区间lcm的维护：对于一个数，将其分解质因数，若有因子$p^k$，那么拆分出k个数 $p^1,p^2,\ldots,p^k$，权值都为p，那么区间$[l,r]$内所有数的lcm的答案=所有在该区间中出现过的数的权值之积，可持久化线段树维护之。</p>
<h2 id="stirling数">Stirling数</h2>
<h3 id="第一类斯特林数">第一类斯特林数</h3>
<p>第一类斯特林数$S(p,k)$的一个的组合学解释是：将p个物体排成k个非空循环排列的方法数。</p>

<p>递推公式：$S(p,k)=(p−1)S(p−1,k)+S(p−1,k−1),1\leq k\leq p−1;S(p,0)=0,p\ge1;S(p,p)=1,p\ge0$</p>
<h3 id="第二类斯特林数">第二类斯特林数</h3>
<p>第二类斯特林数$S(p,k)$的一个的组合学解释是：将p个物体划分成k个非空不可辨别的（可以理解为盒子没有编号）集合的方法数。</p>

<p>递推公式：$S(p,k)=kS(p−1,k)+S(p−1,k−1),1\leq k\leq p−1;S(p,0)=0,p\ge 1;S(p,p)=1,p\ge0$</p>

<p>卷积形式：$S(n,m)=\frac{1}{m!}\sum_{k=0}^m(-1)^kC(m,k)(m-k)^n=\sum_{k=0}^m\frac{(-1)^k}{k!}\frac{(m-k)^n}{(m-k)!}$</p>

<p>同时有转化：$x^k=\sum_{i=1}^ki!C(x,i)S(k,i)$</p>
<h3 id="斯特林近似公式">斯特林近似公式</h3>
<p>$n!\approx\sqrt{2\pi n}(\frac{n}{e})^n$</p>
<h2 id="小球入盒模型通解">小球入盒模型通解</h2>

<table>
  <thead>
    <tr>
      <th>k个球</th>
      <th>m个盒子</th>
      <th>空盒子</th>
      <th>方案数</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>各不相同</td>
      <td>各不相同</td>
      <td>允许</td>
      <td>$m^k$</td>
    </tr>
    <tr>
      <td>各不相同</td>
      <td>各不相同</td>
      <td>无</td>
      <td>$m!Stirling2(k,m)$</td>
    </tr>
    <tr>
      <td>各不相同</td>
      <td>完全相同</td>
      <td>允许</td>
      <td>$\sum_{i=1}^mStirling2(k,i)$</td>
    </tr>
    <tr>
      <td>各不相同</td>
      <td>完全相同</td>
      <td>无</td>
      <td>$Stirling2(k,m)$</td>
    </tr>
    <tr>
      <td>完全相同</td>
      <td>各不相同</td>
      <td>允许</td>
      <td>$C(m+k−1,k)$</td>
    </tr>
    <tr>
      <td>完全相同</td>
      <td>各不相同</td>
      <td>无</td>
      <td>$C(k−1,m−1)$</td>
    </tr>
    <tr>
      <td>完全相同</td>
      <td>完全相同</td>
      <td>允许</td>
      <td>$\frac{1}{(1−x)(1−x^2)…(1−x^m)}的x^k项的系数$</td>
    </tr>
    <tr>
      <td>完全相同</td>
      <td>完全相同</td>
      <td>无</td>
      <td>$\frac{x^m}{(1−x)(1−x^2)…(1−x^m)}的x^k项的系数$</td>
    </tr>
  </tbody>
</table>

<h2 id="置换">置换</h2>
<p><a href="https://vjudge.net/solution/18445975">使用示例</a></p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Permutation</span> <span class="o">:</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span>
<span class="p">{</span>
	<span class="n">Permutation</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="k">friend</span> <span class="n">Permutation</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">Permutation</span> <span class="o">&amp;</span><span class="n">f</span><span class="p">,</span> <span class="k">const</span> <span class="n">Permutation</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Permutation</span> <span class="n">ans</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">f</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
		<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">Permutation</span> <span class="n">inv</span><span class="p">(</span><span class="k">const</span> <span class="n">Permutation</span> <span class="o">&amp;</span><span class="n">f</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Permutation</span> <span class="n">ans</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">f</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">ans</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">cycle</span><span class="p">(</span><span class="k">const</span> <span class="n">Permutation</span> <span class="o">&amp;</span><span class="n">f</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vis</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">ans</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">f</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
			<span class="p">{</span>
				<span class="n">ans</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">());</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">j</span><span class="p">];</span> <span class="n">j</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
					<span class="n">vis</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ans</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">push_back</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>
<h2 id="生成字典序">生成字典序</h2>
<h3 id="下一排列">下一排列</h3>
<p>对给定的排列$a_1a_2\ldots a_n$，找到$a_j$使得$a_j&lt;a_{j+1},a_{j+1}&gt;a_{j+2}&gt;\ldots&gt;a_n$即这列数中最后一个相邻递增数对，然后把$a_{j+1},a_{j+2},\ldots,a_n$中大于$a_j$的最小数放到位置j，然后$a_j\ldots a_n$中剩余的数从小到大排序放到$[j+1,n]$中。</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">bool</span> <span class="nf">nextPermutation</span><span class="p">(</span><span class="n">ll</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="n">ll</span> <span class="o">*</span><span class="n">e</span><span class="p">)</span> <span class="c1">//标准库有这个函数next_permutation
</span><span class="p">{</span>
	<span class="n">ll</span> <span class="o">*</span><span class="n">i</span> <span class="o">=</span> <span class="n">e</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">j</span> <span class="o">=</span> <span class="n">e</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;=</span> <span class="n">b</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">j</span> <span class="o">&gt;=</span> <span class="o">*</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
		<span class="o">--</span><span class="n">j</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="o">*</span><span class="n">j</span><span class="p">)</span>
		<span class="o">--</span><span class="n">i</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">swap</span><span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">j</span><span class="p">),</span> <span class="n">reverse</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<h2 id="二项式反演">二项式反演</h2>
<p>$f(n)=\sum_{k=0}^nC(n,k)g(k),g(n)=\sum_{k=0}^n(−1)^{n−k}C(n,k)f(k)$</p>
<h2 id="第k小期望">第k小期望</h2>
<p>$f(n,k)$表示有n个变量，和为1，第k小的期望。</p>

<p>$f(n,k)=\frac{1}{n^2}+(1-\frac{1}{n})f(n-1,k-1),f(n,0)=0$</p>
<h2 id="错排数">错排数</h2>
<p>考虑一个有n个元素的排列，若一个排列中所有的元素都不在自己原来的位置上，那么这样的排列就称为原排列的一个错排。</p>

<p>n个元素的错排数$D_n$满足递推公式：$D_1=0,D_2=1,D_n=(n−1)(D_{n−2}+D_{n−1})$</p>

<p>通项：$D(n)=n![\frac{(-1)^2}{2!}+\ldots+\frac{(-1)^{n-1} }{(n-1)!}+\frac{(-1)^n}{n!}]=\lfloor\frac{n!}{e}+\frac{1}{2}\rfloor$</p>
<h2 id="bonuli数">Bonuli数</h2>
<p><a href="http://www.51nod.com/Challenge/ProblemSubmitDetail.html#!#judgeId=744601">使用示例</a></p>

<p>$B_n = -\frac{1}{C(n+1,n)}(C(n+1,0)B_0+C(n+1,1)B_1+\ldots+C(n+1,n-1)B_{n-1})=-\frac{1}{n+1}(C(n+1,0)B_0+C(n+1,1)B_1+\ldots+C(n+1,n-1)B_{n-1})$</p>

<p>可用于计算任意<strong>正整数</strong>次数的幂和：$\sum_{i=1}^ni^k=\frac{1}{k+1}\sum_{j=0}^kC(k+1,j)B_jn^{k+1-j}$</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Bonuli</span> <span class="o">:</span> <span class="n">Factorial</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">b</span><span class="p">;</span>
	<span class="n">Bonuli</span><span class="p">(</span><span class="kt">int</span> <span class="n">N</span><span class="p">,</span> <span class="n">ll</span> <span class="n">M</span><span class="p">)</span> <span class="o">:</span> <span class="n">Factorial</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">),</span> <span class="n">b</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
				<span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">qadd</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mul</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">c</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)));</span>
			<span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">qadd</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="o">-</span><span class="n">mul</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mul</span><span class="p">(</span><span class="n">fac</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ifac</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])));</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">ask</span><span class="p">(</span><span class="n">ll</span> <span class="n">n</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">ll</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">r</span> <span class="o">=</span> <span class="n">qadd</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">mul</span><span class="p">(</span><span class="n">mul</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">i</span><span class="p">],</span> <span class="n">c</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">)),</span> <span class="n">w</span> <span class="o">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">u</span><span class="p">)));</span>
		<span class="k">return</span> <span class="n">mul</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">mul</span><span class="p">(</span><span class="n">fac</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">ifac</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]));</span>
	<span class="p">}</span>
<span class="p">}</span> <span class="n">b</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">,</span> <span class="mf">1e9</span> <span class="o">+</span> <span class="mi">7</span><span class="p">);</span>
</code></pre></div></div>
<h2 id="catalan数">Catalan数</h2>
<p>$h_1=1,h_n=\frac{4n−2}{n+1}h_{n−1}=\frac{C(2n,n)}{n+1}=C(2n,n)−C(2n,n−1)$。</p>

<p>在一个格点阵列中，从$(0,0)$点走到$(n,m)$点且不经过对角线$x=y$的方法数：$C(n+m−1,m)−C(n+m−1,m−1),x&gt;y;C(n+m,m)−C(n+m,m−1),x\ge y$。</p>

<p>常见的Catalan数：括号序的个数、凸多边形三角剖分的方案数等。</p>
<h2 id="bell数">Bell数</h2>
<p>把n个带标号的物品划分为若干不相交集合的方案数称为贝尔数，其递推公式：$B_n=\sum_{i=0}^{N-1}C_{n-1}^iB_i$</p>

<p>前几项贝尔数：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1,2,5,15,52,203,877,4140,21147,115975,678570,4213597,27644437,190899322,1382958545,...
</code></pre></div></div>
<p>下为$O(P^2\log P)$求$B_n$对P取模。</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Bell</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">P</span> <span class="o">=</span> <span class="mi">999999598</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">7284</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">N</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">x</span><span class="p">;</span>
	<span class="n">Bell</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5281</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7283</span><span class="p">;</span> <span class="c1">//P的质因数分解
</span>		<span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">x</span> <span class="o">^=</span> <span class="mi">1</span><span class="p">)</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">x</span> <span class="o">^</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
				<span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">x</span> <span class="o">^</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">%</span> <span class="n">P</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">cal</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">ll</span> <span class="n">n</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">70</span><span class="p">];</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">%</span> <span class="n">x</span><span class="p">;</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span>
			<span class="n">d</span><span class="p">[</span><span class="n">m</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span> <span class="o">%</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span> <span class="o">/=</span> <span class="n">x</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
					<span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">%</span> <span class="n">x</span><span class="p">;</span>
				<span class="n">c</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">%</span> <span class="n">x</span><span class="p">;</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
					<span class="n">b</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
			<span class="p">}</span>
		<span class="k">return</span> <span class="n">c</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">ask</span><span class="p">(</span><span class="n">ll</span> <span class="n">n</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">f</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
		<span class="n">ll</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="p">(</span><span class="n">P</span> <span class="o">/</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">P</span> <span class="o">/</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">%</span> <span class="n">P</span> <span class="o">*</span> <span class="n">cal</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span> <span class="o">%</span> <span class="n">P</span><span class="p">)</span> <span class="o">%</span> <span class="n">P</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">t</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>
<h3 id="等价类容斥">等价类容斥</h3>
<p>考虑容斥，Bell(p)枚举所有等价情况。对于一种情况，强制了一个等价类里面的数都要相同，其它的可以相同也可以不同。</p>

<p>容斥系数为：$(−1)^{p−等价类个数}(每个等价类大小−1)!之积$。</p>
<h2 id="grey码">Grey码</h2>
<p>格雷序列第i个是<code class="highlighter-rouge">i^(i&gt;&gt;1)</code>。长为n的01序列共$2^n$个，下标从$0\ldots 2^n-1$。</p>
<h2 id="扩展cayley公式">扩展Cayley公式</h2>
<p>对于n个点，m个连通块的图，假设每个连通块有a[i]个点，那么用s−1条边把它连通的方案数为$n^{s−2}a[1]a[2]\ldots a[m]$。</p>
<h2 id="超立方体">超立方体</h2>
<p>n维超立方体有$2^{n−i}C(n,i)$个i维元素。</p>
<h2 id="枚举位集i的非空子集j">枚举位集I的非空子集J</h2>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="p">(</span><span class="n">J</span><span class="o">=</span><span class="n">I</span><span class="p">;</span> <span class="n">J</span><span class="p">;</span> <span class="n">J</span><span class="o">=</span><span class="n">I</span><span class="o">&amp;</span><span class="n">J</span><span class="err">−</span><span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>
</code></pre></div></div>

  
  <h1>
    <a href="/posts/acm/template/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0">
      线性代数
    </a>
  </h1>
  <h2 id="矩阵">矩阵</h2>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="n">array</span><span class="o">&lt;</span><span class="n">array</span><span class="o">&lt;</span><span class="n">ll</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;</span> <span class="n">Mat</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="乘法和快速幂">乘法和快速幂</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Mat</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">Mat</span> <span class="n">r</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span>
				<span class="n">M</span><span class="p">.</span><span class="n">qadd</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">M</span><span class="p">.</span><span class="n">mul</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]));</span>
	<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">Mat</span> <span class="n">pow</span><span class="p">(</span><span class="n">Mat</span> <span class="n">a</span><span class="p">,</span> <span class="n">ll</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">Mat</span> <span class="n">r</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
			<span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(;</span> <span class="n">b</span><span class="p">;</span> <span class="n">b</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">a</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="行列式">行列式</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ll</span> <span class="nf">det</span><span class="p">(</span><span class="n">Mat</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">EPS</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">ll</span> <span class="n">t</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span>
					<span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]);</span>
			<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">ans</span> <span class="o">*=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">EPS</span><span class="p">)</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="高斯消元">高斯消元</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">GaussElimination</span><span class="p">(</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="c1">//a为增广矩阵，要求n*n的系数矩阵可逆，运行结束后a[i][n]为第i个未知数的值
</span><span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">r</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">fabs</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
				<span class="n">r</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">!=</span> <span class="n">i</span><span class="p">)</span>
			<span class="n">swap_ranges</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">r</span><span class="p">].</span><span class="n">begin</span><span class="p">(),</span> <span class="n">a</span><span class="p">[</span><span class="n">r</span><span class="p">].</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="n">i</span><span class="p">;</span> <span class="o">--</span><span class="n">j</span><span class="p">)</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span>
				<span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">~</span><span class="n">i</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
			<span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">-=</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
		<span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">/=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="线性基">线性基</h2>

<h3 id="向量线性基">向量线性基</h3>

<p>add返回要插入的向量z是否与已插入的线性无关。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Base</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&gt;</span> <span class="n">v</span><span class="p">;</span>
	<span class="n">Base</span><span class="p">(</span><span class="kt">int</span> <span class="n">N</span><span class="p">)</span> <span class="o">:</span> <span class="n">v</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{}</span> <span class="c1">//R^N的子空间
</span>	<span class="kt">bool</span> <span class="n">add</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">x</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">EPS</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">EPS</span><span class="p">)</span>
					<span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
				<span class="kt">double</span> <span class="n">t</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
					<span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
			<span class="p">}</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="异或线性基">异或线性基</h3>

<p>若要查询第k小子集异或和，则把k写成二进制，对于是1的第i位，把从低位到高位第i个不为0的数异或进答案。若要判断是否有非空子集的异或和为0，如果不存在自由基，那么说明只有空集的异或值为0，需要高斯消元来判断。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">BaseXOR</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">;</span>
	<span class="n">BaseXOR</span><span class="p">()</span> <span class="o">:</span> <span class="n">a</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
	<span class="n">ll</span> <span class="n">ask</span><span class="p">()</span> <span class="c1">//查询最大子集异或和
</span>	<span class="p">{</span>
		<span class="n">ll</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">~</span><span class="n">i</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span>
			<span class="n">t</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span> <span class="o">^</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="k">return</span> <span class="n">t</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">bool</span> <span class="n">add</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">~</span><span class="n">i</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
					<span class="n">x</span> <span class="o">^=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
				<span class="k">else</span>
					<span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">bool</span> <span class="n">check</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">)</span> <span class="c1">//判断一个数是否能够被异或出，0根据需要特判
</span>	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">~</span><span class="n">i</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">^=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">!</span><span class="n">x</span><span class="p">)</span>
					<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

  
  <h1>
    <a href="/posts/acm/template/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6">
      离散数学
    </a>
  </h1>
  <h2 id="归并排序求逆序对">归并排序求逆序对</h2>
<p><a href="https://vjudge.net/solution/19421786">使用示例</a></p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ll</span> <span class="nf">merge_sort</span><span class="p">(</span><span class="n">ll</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="n">ll</span> <span class="o">*</span><span class="n">e</span><span class="p">)</span> <span class="c1">//int存答案会爆
</span><span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">ll</span> <span class="o">*</span><span class="n">m</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">merge_sort</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">merge_sort</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">ll</span> <span class="o">*</span><span class="n">i</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">j</span> <span class="o">=</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span> <span class="o">&amp;&amp;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">e</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="k">for</span> <span class="p">(;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">e</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">j</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">i</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
			<span class="n">ans</span> <span class="o">+=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">inplace_merge</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span> <span class="n">ans</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<h2 id="约瑟夫问题">约瑟夫问题</h2>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ll</span> <span class="nf">josephus</span><span class="p">(</span><span class="n">ll</span> <span class="n">n</span><span class="p">,</span> <span class="n">ll</span> <span class="n">k</span><span class="p">)</span> <span class="c1">//编号0~n-1，每k个出列，时间复杂度O(min(n,k))
</span><span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">k</span> <span class="o">%</span> <span class="n">n</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">)</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">Josephus</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">;</span>
	<span class="n">ll</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">Josephus</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">n</span> <span class="o">/</span> <span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">n</span> <span class="o">%</span> <span class="n">k</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">ret</span> <span class="o">+</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ret</span> <span class="o">+</span> <span class="n">ret</span> <span class="o">/</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<h2 id="堆的操作"><a href="https://vjudge.net/solution/19943623">堆的操作</a></h2>
<p>和STL的函数<code class="highlighter-rouge">push_heap</code>、<code class="highlighter-rouge">pop_heap</code>用法完全相同，实现的是大根堆。</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ll</span> <span class="nf">pushHeap</span><span class="p">(</span><span class="n">ll</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="n">ll</span> <span class="o">*</span><span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">tmp</span> <span class="o">=</span> <span class="o">*--</span><span class="n">e</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">e</span> <span class="o">-</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">;;</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">i</span> <span class="o">=</span> <span class="n">p</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">b</span><span class="p">[</span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">tmp</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">ll</span> <span class="nf">popHeap</span><span class="p">(</span><span class="n">ll</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="n">ll</span> <span class="o">*</span><span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">siz</span> <span class="o">=</span> <span class="o">--</span><span class="n">e</span> <span class="o">-</span> <span class="n">b</span><span class="p">,</span> <span class="n">ch</span><span class="p">;;</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">ch</span><span class="p">],</span> <span class="n">i</span> <span class="o">=</span> <span class="n">ch</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ch</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">siz</span> <span class="o">&amp;&amp;</span> <span class="n">b</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">[</span><span class="n">ch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
			<span class="o">++</span><span class="n">ch</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">siz</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">||</span> <span class="n">b</span><span class="p">[</span><span class="n">siz</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">[</span><span class="n">ch</span><span class="p">])</span>
			<span class="k">return</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">siz</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">siz</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h2 id="蔡勒公式">蔡勒公式</h2>
<p>$w=(\lfloor\frac{c}{4}\rfloor-2c+y+\lfloor\frac{y}{4}\rfloor+\lfloor\frac{13(m+1)}{5}\rfloor+d-1)\mod7$</p>

<p>w：$0,1,\ldots,6$对应周日，周一，$\ldots$，周六</p>

<p>c：世纪减1（即年份前两位数）。</p>

<p>y：年份后两位数。</p>

<p>m：月（$3\leq m\leq14$，即在蔡勒公式中，1、2月要看作上一年的13、14 月来计算）。</p>

<p>d：日。</p>
<h2 id="曼哈顿距离的变换">曼哈顿距离的变换</h2>
<p>$\mid x_1−x_2\mid +\mid y_1−y_2\mid=\max (\mid (x_1 + y_1)−(x_2 + y_2)\mid ,\mid (x_1 −y_1)−(x_2 −y_2)\mid )$</p>
<h2 id="皮克定理">皮克定理</h2>
<p>顶点坐标均是整点（或说正方形格点）的简单多边形中，面积S和内部格点数目n、边上格点数目m的满足关系$S=n+\frac{m}{2}-1$。</p>
<h2 id="矩形面积并矩形面积交矩形周长并线段树扫描线总结">矩形面积并、矩形面积交、矩形周长并（线段树、扫描线总结）</h2>
<p>详见<a href="https://wu-kan.github.io/posts/acm/矩形面积并-矩形面积交-矩形周长并-线段树-扫描线总结">这篇博文</a>。</p>

  
  <h1>
    <a href="/posts/acm/template/%E6%95%B0%E5%AD%A6%E5%88%86%E6%9E%90">
      数学分析
    </a>
  </h1>
  <h2 id="增长趋势">增长趋势</h2>
<p>$n\to+\infty,\forall p,q&gt;0,a&gt;1,{(\ln n)}^q\ll n^p\ll a^n\ll n!\ll n^n$</p>
<h2 id="积分表">积分表</h2>
<p>反读可得导数表，此处略。</p>

<p>$\int k\,\mathrm{d}x=kx+C$</p>

<p>$\int x^a\,dx=\frac{x^{a+1}}{a+1}+C$</p>

<p>$\int\frac{1}{x}\,dx=\ln\mid x\mid +C$</p>

<p>$\int e^x\,dx=e^x + C$</p>

<p>$\int a^x\,dx=\frac{a^x}{\ln a}+C$</p>

<p>$\int\cos x\,dx=\sin x+C$</p>

<p>$\int\sin x\,dx=-\cos x+C$</p>

<p>$\int\frac{1}{cos^2x}\,dx=\int\sec^2 x\,dx=\tan x+C$</p>

<p>$\int\frac{1}{sin^2x}\,dx=\int\csc^2 x\,dx=-\cot x+C$</p>

<p>$\int\frac{1}{\sqrt{1-x^2}}\,dx=\arcsin x+C=-\arccos x+C$</p>

<p>$\int\frac{1}{1+x^2}\,dx=\arctan x+C=-arccot\,x+C$</p>

<p>$\int\sec x\tan x\,dx=\sec x+C$</p>

<p>$\int\csc x\cot x\,dx=-\csc x+C$</p>

<p>$\int\tan x\,dx=-\ln\mid \cos x\mid +C$</p>

<p>$\int\cot x\,dx=\ln\mid \sin x\mid +C$</p>

<p>$\int\sec x\,dx=\ln\mid \sec x+\tan x\mid +C$</p>

<p>$\int\csc x\,dx=\ln\mid \csc x-\cot x\mid +C$</p>

<p>$\int sh\,x\,dx=ch\,x+C$</p>

<p>$\int ch\,x\,dx=sh\,x+C$</p>

<p>$\int\frac{1}{x^2+a^2}\,dx=\frac{1}{a}\arctan\frac{x}{a}+C$</p>

<p>$\int\frac{1}{x^2-a^2}\,dx=\frac{1}{2a}\ln\mid \frac{x-a}{x+a}\mid +C$</p>

<p>$\int\frac{1}{\sqrt{a^2-x^2}}\,dx=\arcsin\frac{x}{a}+C$</p>

<p>$\int\frac{1}{\sqrt{x^2-a^2}}\,dx=\ln\mid x+\sqrt{x^2-a^2}\mid +C$</p>

<p>$\int\frac{1}{\sqrt{x^2+a^2}}\,dx=\ln\mid x+\sqrt{x^2+a^2}\mid +C$</p>
<h2 id="积分求几何量">积分求几何量</h2>
<h3 id="弧长">弧长</h3>
<p>若简单闭曲线</p>

<p>$\begin{cases}x=x(t),\ y=y(t),\end{cases}t\in[\alpha,\beta]$</p>

<p>端点处重合（$x(\alpha)=x(\beta),y(\alpha)=y(\beta)$）且其他地方不自交，$x(t),y(t)$连续且满足</p>

<p>$[x’(t)]^2+[y’(t)]^2\ne0,\forall t\in[\alpha,\beta]$</p>

<p>此时称曲线光滑，其长度</p>

<p>$s=\int_\alpha^\beta\sqrt{[x’(t)]^2+[y’(t)]^2}\,dt$</p>

<p>此式可对称推广到高维空间曲线。
极坐标下，</p>

<p>$r=r(\theta),\theta\in[\alpha,\beta]$</p>

<p>的长度为</p>

<p>$s=\int_\alpha^\beta\sqrt{[r(\theta)]^2+[r’(\theta)]^2}\,d\theta$</p>

<h3 id="面积">面积</h3>
<p>若简单闭曲线</p>

<p>$\begin{cases}x=x(t),\ y=y(t),\end{cases}t\in[\alpha,\beta]$</p>

<p>端点处连续（$x(\alpha)=x(\beta),y(\alpha)=y(\beta)$）且其他地方不自交，$x(t),y(t)$都逐段有连续微商，则此闭合曲线围起来的有界区域面积</p>

<p>$S=-\int_\alpha^\beta x’(t)y(t)\,dt=-\int_\alpha^\beta y(t)\,dx(t)=-\oint_\Gamma y\,dx=\oint_\Gamma x\,dy$</p>

<p>等式右边称为曲线$\Gamma$上的积分，其计算方法是带入参数方程到定积分计算式中，积分上下限为始点与终点对应的参数值。下限并不总是小于上限，参数从下限到上限变化时对应曲线的正向（沿正向观察时，曲线所围的区域永远在左侧）。
极坐标下，连续非负曲线$r=r(\theta)$与向径$\theta=\alpha,\theta=\beta$，其中</p>

<p>$0\leq\beta-\alpha\leq2\pi$所围成的平面图形面积$S=\frac{1}{2}\int_\alpha^\beta r^2(\theta)\,d\theta$</p>

<h3 id="体积">体积</h3>
<p>记立体过x点且垂直于x轴的截面面积为$S(x)$，则其体积$V=\int_a^bS(x)\,dx$连续曲线$y=f(x)\ge 0,x\in[a,b]$绕x轴旋转一周产生的旋转体体积$V=\pi\int_a^by^2\,dx$</p>
<h3 id="旋转体侧面积">旋转体侧面积</h3>
<p>若曲线由参数方程</p>

<p>$\begin{cases}x=x(t),\ y=y(t),\end{cases}t\in[\alpha,\beta]$</p>

<p>给出，则其绕x轴旋转体的侧面积</p>

<p>$s=2\pi\int_\alpha^\beta y(t)\sqrt{[x’(t)]^2+[y’(t)]^2}\,dt$</p>

<h3 id="方向导数">方向导数</h3>
<p>设三元函数$u=f(x,y,z)$在点$P_0(x_0,y_0,z_0)$的某邻域内有定义，任意给定始于点$P_0$的射线$l$，$P(x,y,z)$为l上且含于定义域内的点。若极限</p>

<p>$\lim_{r(p,p_0)\to0^+}\frac{f(P)-f(P_0)}{r(P,P_0)}=\lim_{r(p,p_0)\to0^+}\frac{\Delta_lf(P_0)}{r(P,P_0)}$</p>

<p>存在，则称该极限值为函数$f$在点$P_0$沿方向$l$的方向导数，记为
$\frac{\partial f}{\partial l}\mid _{P_0}$
或
$\frac{\partial f(P_0)}{\partial l}$，$\frac{\Delta_lf(P_0)}{r(P,P_0)}$称为函数在$P_0$点沿$l$方向的增量。</p>

<p>特别地，$\frac{\partial f(P_0)}{\partial x}$就是函数在$P_0$点沿$x$轴正向的方向导数，$y,z$轴上的方向导数同理。若函数在$P_0$点可微，则其在$P_0$沿任何方向$l$的方向导数都存在，则有以下公式</p>

<p>$\frac{\partial f(P_0)}{\partial l}=(\frac{\partial f}{\partial x},\frac{\partial f}{\partial y},\frac{\partial f}{\partial z})\mid _{P_0}\cdot\vec{l_0}$</p>

<p>其中$\vec{l_0}=(\cos\alpha,\cos\beta,cos\gamma)=\frac{1}{\rho}(\Delta x,\Delta y,\Delta z)$为$l$的方向余弦。</p>
<h3 id="曲率">曲率</h3>
<p>若曲线由参数方程</p>

<p>$\begin{cases}x=x(t),\ y=y(t),\end{cases}t\in[\alpha,\beta]$</p>

<p>给出且有二阶微商，则其在一点的曲率</p>

<p>$K=\frac{\mid y’‘x’-y’x’‘\mid }{[x’^2+y’^2]^{\frac{3}{2}}}$</p>

<p>若$y=f(x)$，则</p>

<p>$K=\frac{\mid y’‘\mid }{(1+y’^2)^\frac{3}{2}}$</p>

<p>同时记$\frac{1}{K}$为曲率半径。</p>
<h3 id="空间曲线的切线与法平面">空间曲线的切线与法平面</h3>
<p>若已知曲线上一点$P(x_0,y_0,z_0)$处的切向量为$\tau(x_0,y_0,z_0)=(A,B,C)$则曲线在该点的切线方程为</p>

<p>$\frac{x-x_0}A=\frac{y-y_0}B=\frac{z-z_0}C$</p>

<p>法平面方程为</p>

<p>$A(x-x_0)+B(y-y_0)+C(z-z_0)=0$</p>

<p>当曲线由参数方程</p>

<p>$\begin{cases}x=x(t),\ y=y(t),\ z=z(t),\end{cases}t\in[\alpha,\beta]$</p>

<p>给出时，曲线在P点的切向量为</p>

<p>$\tau=\pm(x’(t_0),y’(t_0),z’(t_0))$</p>

<p>更一般地，若曲线用两曲面的交线给出</p>

<p>$\begin{cases}F(x,y,z)=0,\ G(x,y,z)=0,\end{cases}$</p>

<p>且在P点的某邻域能确定函数组$y=y(x),z=z(x)$满足$y_0=y(x_0),z_0=z(x_0)$，且$y’(x),z’(x)$存在，则曲线在P点的切向量</p>

<p>$\tau=\pm(\frac{\partial(F,G)}{\partial(y,z)},\frac{\partial(F,G)}{\partial(z,x)},\frac{\partial(F,G)}{\partial(x,y)})$</p>

<h3 id="空间曲面的切平面与法线">空间曲面的切平面与法线</h3>
<p>若已知曲面上一点$P(x_0,y_0,z_0)$处的切平面的法向量为$\vec n=(A’,B’,C’)$则曲线在该点的法线方程为</p>

<p>$\frac{x-x_0}{A’}=\frac{y-y_0}{B’}=\frac{z-z_0}{C’}$</p>

<p>切平面方程为</p>

<p>$A’(x-x_0)+B’(y-y_0)+C’(z-z_0)=0$</p>

<p>当曲面方程为$\pi:F(x,y,z)=0$在曲面上任取一条过P的曲线，设其方程为</p>

<p>$\begin{cases}x=x(t),\ y=y(t),\ z=z(t),\end{cases}t\in[\alpha,\beta]$</p>

<p>此时有$F(x(t),y(t),z(t))=0$令$t=t_0$两边对t求导，并写成向量的内积式，得</p>

<p>$(F_x,F_y,F_z)_P\cdot(x’(t_0),y’(t_0),z’(t_0))=0$</p>

<p>则曲线在P点的法向量为$\vec{n}=\pm(F_x,F_y,F_z)_P$</p>

<p>若曲线由参数方程给出</p>

<p>$\begin{cases}x=x(u,v),\ y=y(u,v),\ z=z(u,v),\end{cases}$</p>

<p>则曲线在P点的法向量</p>

<p>$\vec{n}=\pm(\frac{\partial(y,z)}{\partial(u,v)},\frac{\partial(z,x)}{\partial(u,v)},\frac{\partial(x,y)}{\partial(u,v)})$</p>
<h2 id="高阶导数与泰勒公式">高阶导数与泰勒公式</h2>
<p>用$f^{(n)}(x)$表示f(x)的n阶导数，只要让<code class="highlighter-rouge">余项&lt;EPS</code>即可计算指定函数到任意精确度，特别取a=0时称为麦克劳林公式。</p>

<p>$f(x)=f(a)+f^{(1)}(a)(x-a)+\frac{f^{(2)}(a)}{2!}(x-a)^2+\ldots+\frac{f^{(n)}(a)}{n!}(x-a)^n+R_n(x)$</p>

<p>$R_n(x)=o((x-a)^n)$，佩亚诺余项</p>

<p>$R_n(x)=\frac{1}{n!}\int_a^x(x-t)^nf^{(n+1)}(t)\,dt$，积分余项</p>

<p>$R_n(x)=\frac{f^{(n+1)}(\xi)}{(n+1)!}(x-a)^{n+1},a&lt;\xi&lt;x$，拉格朗日余项</p>

<p>$R_n(x)=\frac{(x-a)^{n+1}}{n!}(1-\theta)^nf^{(n+1)}(a+\theta(x-a)),0&lt;\theta&lt;1$，柯西余项</p>
<h3 id="对数函数">对数函数</h3>
<p>$[\ln(1+x)]^{(n)}=(-1)^{n-1}(n-1)!(1+x)^{-n}$</p>

<p>$\ln(1+x)=x-\frac{x^2}{2}+\frac{x^3}{3}-\frac{x^4}{4}+\ldots+(-1)^{n-1}\frac{x^n}{n}+R_n(x)$</p>
<h3 id="幂函数">幂函数</h3>
<p>$[(1+x)^a]^{(n)}=a(a-1)\ldots(a-n+1)(1+x)^{a-n}$</p>

<p>$(1+x)^a=1+ax+\frac{a(a-1)}{2!}x^2+\dots+\frac{a(a-1)\ldots(a-n+1)}{n!}x^n+R_n(x)$</p>
<h3 id="三角函数">三角函数</h3>
<p>$(\sin x)^{(n)}=\sin(x+\frac{n\pi}{2})$</p>

<p>$\sin x=x-\frac{x^3}{3!}+\frac{x^5}{5!}-\frac{x^7}{7!}+\ldots+(-1)^{k-1}\frac{x^{2k-1}}{(2k-1)!}+R_{2k}(x)$</p>

<p>$R_{2k}(x)=(-1)^k\frac{\cos\theta x}{(2k+1)!}x^{2k+1}$</p>

<p>$(\cos x)^{(n)}=\cos(x+\frac{n\pi}{2})$</p>

<p>$\cos x=1-\frac{x^2}{2!}+\frac{x^4}{4!}-\frac{x^6}{6!}+\ldots+(-1)^{k-1}\frac{x^{2k-2}}{(2k-2)!}+R_{2k-1}(x)$</p>

<p>$R_{2k-1}(x)=(-1)^k\frac{\cos\theta x}{(2k)!}x^{2k}$</p>
<h3 id="指数函数">指数函数</h3>
<p>$(e^x)^{(n)}=e^x$</p>

<p>$e^x=1+x+\frac{x^2}{2!}+\frac{x^3}{3!}+\ldots+\frac{x^n}{n!}+R_n(x)$</p>

<p>$R_n(x)=\frac{e^{\theta x}}{(n+1)!}x^{n+1},\xi=\theta x,0&lt;\theta&lt;1$</p>
<h3 id="二元函数">二元函数</h3>
<p>设$f(x,y)$在$P_0(x_0,y_0)$的某邻域$O(P_0)$内有直到$n+1$阶连续偏导数，则对$O(P_0)$内$\forall(x_0+\Delta x,y_0+\Delta y),\exists\theta\in(0,1)$，使得</p>

<p>$f(x_0+\Delta x,y_0+\Delta y)=\sum_{k=0}^n\frac{1}{k!}(\frac{\partial}{\partial x}\Delta x+\frac{\partial}{\partial y}\Delta y)^kf(x_0,y_0)+R_n$</p>

<p>其中</p>

<p>$R_n=\frac{1}{(n+1)!}(\frac{\partial}{\partial x}\Delta x+\frac{\partial}{\partial y}\Delta y)^{n+1}f(x_0+\theta\Delta x,y_0+\theta\Delta y)$</p>

<h2 id="级数部分和">级数部分和</h2>
<h3 id="幂级数">幂级数</h3>
<p>快速计算幂级数的部分和$\sum_{i=1}^ni^k\mod M$可借助伯努利数，详见组合数学模板。</p>

<p>$\sum_{i=1}^ni^1=\frac 1 2n(n+1)$</p>

<p>$\sum_{i=1}^ni^2=\frac 1 6n(n+1)(2n+1)$</p>

<p>$\sum_{i=1}^ni^3=\frac 1 4[n(n+1)]^2$</p>

<p>$\sum_{i=1}^ni^4=\frac 1{30}n(n+1)(2n+1)(3n^2+3n-1)$</p>

<p>$\sum_{i=1}^ni^5=\frac 1{12}[n(n+1)]^2(2n^2+2n-1)$</p>

<p>$\sum_{i=1}^ni^6=\frac 1{42}n(n+1)(2n+1)(3n^4+6n^3-3n+1)$</p>
<h3 id="调和级数">调和级数</h3>
<p>$n\to\infty,\sum_{i=1}^n\frac 1 i\to\ln n+r,r\approx0.5772156649015328\ldots$</p>
<h2 id="二分求零点三分求极值点">二分求零点、三分求极值点</h2>
<p>需要$f(x)$在区间$[l,r]$上单调/凹凸性唯一。</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lf</span> <span class="nf">bs</span><span class="p">(</span><span class="n">lf</span> <span class="n">l</span><span class="p">,</span> <span class="n">lf</span> <span class="n">r</span><span class="p">,</span> <span class="n">lf</span> <span class="n">f</span><span class="p">(</span><span class="n">lf</span> <span class="n">x</span><span class="p">))</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="n">EPS</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">l</span><span class="p">;</span>
	<span class="n">lf</span> <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">m</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">bs</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="o">:</span> <span class="n">ts</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">lf</span> <span class="nf">ts</span><span class="p">(</span><span class="n">lf</span> <span class="n">l</span><span class="p">,</span> <span class="n">lf</span> <span class="n">r</span><span class="p">,</span> <span class="n">lf</span> <span class="n">f</span><span class="p">(</span><span class="n">lf</span> <span class="n">x</span><span class="p">))</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="n">EPS</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">l</span><span class="p">;</span>
	<span class="n">lf</span> <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">l</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">lm</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">d</span><span class="p">,</span> <span class="n">rm</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="n">d</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">lm</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">f</span><span class="p">(</span><span class="n">rm</span><span class="p">)</span> <span class="o">?</span> <span class="n">ts</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">rm</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="o">:</span> <span class="n">ts</span><span class="p">(</span><span class="n">lm</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span> <span class="c1">//极小值
</span><span class="p">}</span>
</code></pre></div></div>
<h2 id="自适应辛普森求积分">自适应辛普森求积分</h2>
<p><a href="https://vjudge.net/solution/18698789">使用示例</a></p>

<p><a href="http://www2.math.umd.edu/~mariakc/teaching/adaptive.pdf">这篇论文</a>论证了加一个十五分之一的偏移收敛会比较快…</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Simpson</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">simpson</span><span class="p">(</span><span class="n">lf</span> <span class="n">a</span><span class="p">,</span> <span class="n">lf</span> <span class="n">b</span><span class="p">,</span> <span class="n">lf</span> <span class="n">f</span><span class="p">(</span><span class="n">lf</span> <span class="n">x</span><span class="p">))</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">f</span><span class="p">((</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="mi">6</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">lf</span> <span class="n">ask</span><span class="p">(</span><span class="n">lf</span> <span class="n">a</span><span class="p">,</span> <span class="n">lf</span> <span class="n">b</span><span class="p">,</span> <span class="n">lf</span> <span class="n">f</span><span class="p">(</span><span class="n">lf</span> <span class="n">x</span><span class="p">),</span> <span class="n">lf</span> <span class="n">e</span> <span class="o">=</span> <span class="n">EPS</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">lf</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">L</span> <span class="o">=</span> <span class="n">simpson</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="n">R</span> <span class="o">=</span> <span class="n">simpson</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">L</span> <span class="o">+</span> <span class="n">R</span> <span class="o">-</span> <span class="n">simpson</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span> <span class="o">/</span> <span class="mi">15</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">e</span> <span class="o">?</span> <span class="n">L</span> <span class="o">+</span> <span class="n">R</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">:</span> <span class="n">ask</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">e</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">ask</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">e</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>
<h2 id="插值法">插值法</h2>
<p>拉格朗日插值法：插值多项式和插值基函数的形式对称，容易编程。但是，增加节点时，需要重新计算每一个插值基函数。要在$\pmod p$意义下进行的话，那么p只能是质数。
牛顿插值法：当插值节点增加时，之前已计算的结果仍然能用，每增加一个节点，只要再增加一项即可，从而避免了重复性计算。如果要mod非质数的话，那么就要用牛顿插值法。</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="n">complex</span><span class="o">&lt;</span><span class="n">lf</span><span class="o">&gt;</span> <span class="n">Coord</span><span class="p">;</span>
<span class="cp">#define X real()
#define Y imag()
</span><span class="k">struct</span> <span class="n">Lagrange</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">ask</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">,</span> <span class="n">lf</span> <span class="n">x</span><span class="p">)</span> <span class="c1">//返回p确定的多项式函数在x处的值
</span>	<span class="p">{</span>
		<span class="n">lf</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">lf</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Y</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span>
					<span class="n">tmp</span> <span class="o">*=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">X</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">X</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">X</span><span class="p">);</span>
			<span class="n">ret</span> <span class="o">+=</span> <span class="n">tmp</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">lf</span><span class="o">&gt;</span> <span class="n">ask</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">)</span> <span class="c1">//返回p确定的多项式系数向量
</span>	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">lf</span><span class="o">&gt;</span> <span class="n">ret</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()),</span> <span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Y</span><span class="p">,</span> <span class="n">sum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="n">i</span><span class="p">;</span> <span class="o">--</span><span class="n">j</span><span class="p">)</span>
				<span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">Y</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">Y</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">Y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">X</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="n">i</span><span class="p">].</span><span class="n">X</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="o">~</span><span class="n">j</span><span class="p">;</span> <span class="o">--</span><span class="n">j</span><span class="p">)</span>
				<span class="n">sum</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">?</span> <span class="n">sum</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">sum</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">X</span><span class="p">,</span>
				<span class="n">ret</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sum</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Y</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="n">Newton</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">differenceQuotient</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="c1">//计算差商
</span>	<span class="p">{</span>
		<span class="n">lf</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">k</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">lf</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Y</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">k</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span>
					<span class="n">tmp</span> <span class="o">/=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">X</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">X</span><span class="p">;</span>
			<span class="n">ret</span> <span class="o">+=</span> <span class="n">tmp</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">lf</span> <span class="n">ask</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">,</span> <span class="n">lf</span> <span class="n">x</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">lf</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Y</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">lf</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">differenceQuotient</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span> <span class="c1">//多次求，可O(n^3)预处理优化
</span>			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
				<span class="n">tmp</span> <span class="o">*=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">X</span><span class="p">;</span>
			<span class="n">ret</span> <span class="o">+=</span> <span class="n">tmp</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

  
  <h1>
    <a href="/posts/acm/template/%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95">
      计算几何
    </a>
  </h1>
  <h2 id="二维">二维</h2>

<p>点和向量化为坐标Coord进行运算，使用stl中的complex实现。</p>

<p>复数相乘的几何意义为长度相乘，极角相加。</p>

<p>用直线上的一点p和方向向量v表示一条经过p的直线，直线上的所有点q满足q=p+t*v，其中t是参数；当限制t≥0时，该参数方程表示射线；限制0≤t≤1时，该参数方程表示线段。</p>

<p>此外，如果已知线段端点a1和a2，可以通过Line(a1,a2-a1)来得到对应的参数形式。</p>

<p>Morley定理：三角形每个内角的三等分线相交成等边三角形。</p>

<p>欧拉定理：平面图的点数V、边数E和面数F满足V+F-E=2。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="kt">double</span> <span class="n">lf</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">complex</span><span class="o">&lt;</span><span class="n">lf</span><span class="o">&gt;</span> <span class="n">Coord</span><span class="p">;</span>
<span class="k">const</span> <span class="n">lf</span> <span class="n">EPS</span> <span class="o">=</span> <span class="mf">1e-9</span><span class="p">;</span>
<span class="cp">#define X real()
#define Y imag()
</span><span class="k">struct</span> <span class="n">Line</span>
<span class="p">{</span>
	<span class="n">Coord</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
	<span class="n">Line</span><span class="p">(</span><span class="n">Coord</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Coord</span><span class="p">(),</span> <span class="n">Coord</span> <span class="n">v</span> <span class="o">=</span> <span class="n">Coord</span><span class="p">())</span> <span class="o">:</span> <span class="n">p</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">v</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">{}</span>
	<span class="n">Coord</span> <span class="n">point</span><span class="p">(</span><span class="n">lf</span> <span class="n">t</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">p</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span> <span class="n">t</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="n">Circle</span>
<span class="p">{</span>
	<span class="n">Coord</span> <span class="n">c</span><span class="p">;</span>
	<span class="n">lf</span> <span class="n">r</span><span class="p">;</span>
	<span class="n">Circle</span><span class="p">(</span><span class="n">Coord</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Coord</span><span class="p">(),</span> <span class="n">lf</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="n">c</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">r</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">{}</span>
	<span class="n">Coord</span> <span class="n">point</span><span class="p">(</span><span class="n">lf</span> <span class="n">t</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">c</span> <span class="o">+</span> <span class="n">polar</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//t为参数，幅角
</span><span class="p">};</span>
<span class="cm">/*
Coord(lf x=0,lf y=0);//构造函数
lf real(Coord a);//a的实部（复平面的横坐标）,也可写作a.real()
lf imag(Coord a);//a的虚部（复平面的纵坐标）,也可写作a.imag()

lf abs(Coord a);//向量a的模长，或是点a到原点的距离
lf norm(Coord a);//abs的平方，比abs快，但是要注意浮点数精度溢出

lf arg(Coord a);//a的幅角，与atan2(a.real(),a.imag())等价
Coord polar(lf r,lf t);//极坐标生成方式，r为幅值，t为幅角

//运算符重载+、-、*、/（以及对应的赋值运算，但是赋值运算不能写在表达式中，详见参考地址）、&lt;&lt;、&gt;&gt;（输出括号形式的坐标）
*/</span>
<span class="kt">int</span> <span class="nf">sgn</span><span class="p">(</span><span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">EPS</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">EPS</span><span class="p">);</span> <span class="p">}</span>

<span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span><span class="p">)</span> <span class="o">||</span> <span class="n">sgn</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//不等运算符，涉及到浮点数比较要重写
</span>
<span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">A</span> <span class="o">!=</span> <span class="n">B</span><span class="p">);</span> <span class="p">}</span>

<span class="kt">bool</span> <span class="n">cmpCoord</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span><span class="p">)</span> <span class="o">?</span> <span class="n">sgn</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">sgn</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//复数没有小于运算，只能这样定义一个比较函数
</span>
<span class="kt">bool</span> <span class="n">cmpLine</span><span class="p">(</span><span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="n">arg</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">v</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//按极角排序，求凸包中使用
</span>
<span class="n">lf</span> <span class="n">Dot</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span> <span class="o">+</span> <span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span> <span class="p">}</span>

<span class="n">lf</span> <span class="n">Cross</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">A</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span> <span class="p">}</span>

<span class="n">lf</span> <span class="n">Angle</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">acos</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">B</span><span class="p">));</span> <span class="p">}</span>

<span class="n">lf</span> <span class="n">Area2</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Cross</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//三角形ABC有向面积的两倍
</span>
<span class="n">Coord</span> <span class="n">Rotate</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="n">lf</span> <span class="n">rad</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">polar</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">rad</span><span class="p">);}</span> <span class="c1">//向量A逆时针旋转rad弧度
</span>
<span class="n">Coord</span> <span class="n">Normal</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">)</span> <span class="c1">//A的法向量，把A逆时针旋转九十度并长度化为1
</span><span class="p">{</span>
	<span class="n">lf</span> <span class="n">L</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">A</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Coord</span><span class="p">(</span><span class="o">-</span><span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">/</span> <span class="n">L</span><span class="p">,</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">/</span> <span class="n">L</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">onLeft</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">P</span> <span class="o">-</span> <span class="n">L</span><span class="p">.</span><span class="n">p</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//p是否在有向直线L左侧，不含线上
</span>
<span class="n">lf</span> <span class="n">DistanceToLine</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Cross</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">P</span> <span class="o">-</span> <span class="n">L</span><span class="p">.</span><span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//点到直线距离（有向）
</span>
<span class="n">lf</span> <span class="n">DistanceToLine</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">));</span> <span class="p">}</span>

<span class="n">lf</span> <span class="n">DistanceToSegment</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="c1">//点到线段的距离（无向）
</span><span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">A</span> <span class="o">==</span> <span class="n">B</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">P</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span>
	<span class="n">Coord</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">v3</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">B</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">v2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v3</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">v3</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">DistanceToLine</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">)));</span>
<span class="p">}</span>

<span class="n">Coord</span> <span class="n">getLineProjection</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">L</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">P</span> <span class="o">-</span> <span class="n">L</span><span class="p">.</span><span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">));</span> <span class="p">}</span> <span class="c1">//点在直线上的投影
</span>
<span class="n">Coord</span> <span class="n">getLineProjection</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">getLineProjection</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">));</span> <span class="p">}</span>

<span class="n">Coord</span> <span class="n">getSymmetry</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">O</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">O</span> <span class="o">+</span> <span class="n">O</span> <span class="o">-</span> <span class="n">P</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//P关于O的对称点
</span>
<span class="n">Coord</span> <span class="n">getSymmetry</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">getSymmetry</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">getLineProjection</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">L</span><span class="p">));</span> <span class="p">}</span> <span class="c1">//P关于L的对称点
</span>
<span class="n">Coord</span> <span class="n">getLineIntersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L2</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">L1</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">L2</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">L1</span><span class="p">.</span><span class="n">p</span> <span class="o">-</span> <span class="n">L2</span><span class="p">.</span><span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">Cross</span><span class="p">(</span><span class="n">L1</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">L2</span><span class="p">.</span><span class="n">v</span><span class="p">));</span> <span class="p">}</span> <span class="c1">//直线交点,须确保两直线相交
</span>
<span class="n">Coord</span> <span class="n">getLineIntersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A2</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B2</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">getLineIntersection</span><span class="p">(</span><span class="n">Line</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span> <span class="o">-</span> <span class="n">A1</span><span class="p">),</span> <span class="n">Line</span><span class="p">(</span><span class="n">B1</span><span class="p">,</span> <span class="n">B2</span> <span class="o">-</span> <span class="n">B1</span><span class="p">));</span> <span class="p">}</span>

<span class="kt">bool</span> <span class="n">SegmentProperIntersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A2</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B2</span><span class="p">)</span> <span class="c1">//线段相交判定，交点不在一条线段的端点
</span><span class="p">{</span>
	<span class="n">lf</span> <span class="n">C1</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">A2</span> <span class="o">-</span> <span class="n">A1</span><span class="p">,</span> <span class="n">B1</span> <span class="o">-</span> <span class="n">A1</span><span class="p">),</span> <span class="n">C2</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">A2</span> <span class="o">-</span> <span class="n">A1</span><span class="p">,</span> <span class="n">B2</span> <span class="o">-</span> <span class="n">A1</span><span class="p">),</span>
	   <span class="n">C3</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">B2</span> <span class="o">-</span> <span class="n">B1</span><span class="p">,</span> <span class="n">A1</span> <span class="o">-</span> <span class="n">B1</span><span class="p">),</span> <span class="n">C4</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">B2</span> <span class="o">-</span> <span class="n">B1</span><span class="p">,</span> <span class="n">A2</span> <span class="o">-</span> <span class="n">B1</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">C1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgn</span><span class="p">(</span><span class="n">C2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">C3</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgn</span><span class="p">(</span><span class="n">C4</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">onSegment</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A2</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">A1</span> <span class="o">-</span> <span class="n">P</span><span class="p">,</span> <span class="n">A2</span> <span class="o">-</span> <span class="n">P</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">A1</span> <span class="o">-</span> <span class="n">P</span><span class="p">,</span> <span class="n">A2</span> <span class="o">-</span> <span class="n">P</span><span class="p">));</span> <span class="p">}</span> <span class="c1">//判断点是否在线段上，不包含端点
</span>
<span class="n">lf</span> <span class="n">PolygonArea</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">)</span> <span class="c1">//计算多边形的有向面积，凸多边形即为面积
</span><span class="p">{</span>
	<span class="n">lf</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="n">s</span> <span class="o">+=</span> <span class="n">Area2</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="k">return</span> <span class="n">s</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">inPolygon</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">,</span> <span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">poly</span><span class="p">)</span> <span class="c1">//点在多边形内的判定，转角法，正值为内部，0为外部，-1在边界上
</span><span class="p">{</span>
	<span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">poly</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">onSegment</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">poly</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">]))</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">//在边界上
</span>		<span class="n">k</span> <span class="o">=</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">poly</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span> <span class="o">-</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
		<span class="n">d1</span> <span class="o">=</span> <span class="n">sgn</span><span class="p">(</span><span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Y</span> <span class="o">-</span> <span class="n">p</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
		<span class="n">d2</span> <span class="o">=</span> <span class="n">sgn</span><span class="p">(</span><span class="n">poly</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">].</span><span class="n">Y</span> <span class="o">-</span> <span class="n">p</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">d1</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">d2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="o">++</span><span class="n">ans</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">d2</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">d1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="o">--</span><span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">ConvexHull</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">collineation</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">//获得凸包，不希望凸包的边上有输入点第二个参数传0
</span><span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">ans</span><span class="p">;</span>
	<span class="n">sort</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">p</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">cmpCoord</span><span class="p">);</span> <span class="c1">//先比横坐标再比纵坐标
</span>	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>  <span class="c1">//求出下凸包
</span>	<span class="p">{</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Area2</span><span class="p">(</span><span class="n">ans</span><span class="p">[</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">],</span> <span class="n">ans</span><span class="p">[</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="n">collineation</span><span class="p">)</span>
			<span class="n">ans</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
		<span class="n">ans</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span> <span class="c1">//求出上凸包
</span>	<span class="p">{</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">k</span> <span class="o">&amp;&amp;</span> <span class="o">-</span><span class="n">sgn</span><span class="p">(</span><span class="n">Area2</span><span class="p">(</span><span class="n">ans</span><span class="p">[</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ans</span><span class="p">[</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="n">collineation</span><span class="p">)</span>
			<span class="n">ans</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
		<span class="n">ans</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">ans</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">cutPolygon</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">poly</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="c1">//用有向直线A-&gt;B切割多边形poly， 返回“左侧”。 如果退化，可能会返回一个单点或者线段，复杂度O(n^2)
</span><span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">newpoly</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">poly</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Coord</span> <span class="n">C</span> <span class="o">=</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">D</span> <span class="o">=</span> <span class="n">poly</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">A</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">newpoly</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">C</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">D</span><span class="p">)))</span>
		<span class="p">{</span>
			<span class="n">Coord</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">getLineIntersection</span><span class="p">(</span><span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">),</span> <span class="n">Line</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span> <span class="o">-</span> <span class="n">C</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">onSegment</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">))</span>
				<span class="n">newpoly</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ip</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">newpoly</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">getHalfPlaneIntersection</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Line</span><span class="o">&gt;</span> <span class="n">L</span><span class="p">)</span> <span class="c1">//半平面交
</span><span class="p">{</span>
	<span class="n">sort</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">L</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">cmpLine</span><span class="p">);</span>  <span class="c1">//按极角排序
</span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">Coord</span><span class="p">());</span> <span class="c1">//p[i]为q[i]和q[i+1]的交点
</span>	<span class="kt">int</span> <span class="n">first</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>			<span class="c1">//双端队列的第一个元素和最后一个元素
</span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Line</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">Line</span><span class="p">());</span>   <span class="c1">//双端队列
</span>	<span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>						<span class="c1">//队列初始化为只有一个半平面L[0]
</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">L</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">last</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">onLeft</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
			<span class="o">--</span><span class="n">last</span><span class="p">;</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">last</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">onLeft</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">first</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
			<span class="o">++</span><span class="n">first</span><span class="p">;</span>

		<span class="n">q</span><span class="p">[</span><span class="o">++</span><span class="n">last</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">last</span><span class="p">].</span><span class="n">v</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">v</span><span class="p">)))</span>
		<span class="p">{</span>
			<span class="o">--</span><span class="n">last</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">onLeft</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="n">last</span><span class="p">]))</span>
				<span class="n">q</span><span class="p">[</span><span class="n">last</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">last</span><span class="p">)</span>
			<span class="n">p</span><span class="p">[</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">getLineIntersection</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">last</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">last</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">onLeft</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">first</span><span class="p">]))</span>
		<span class="o">--</span><span class="n">last</span><span class="p">;</span> <span class="c1">//删除无用平面
</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span><span class="p">();</span> <span class="c1">//空集
</span>	<span class="n">p</span><span class="p">[</span><span class="n">last</span><span class="p">]</span> <span class="o">=</span> <span class="n">getLineIntersection</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">last</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">first</span><span class="p">]);</span>
	<span class="k">return</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">first</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">last</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">//从deque复制到输出中
</span><span class="p">}</span>

<span class="kt">int</span> <span class="n">getLineCircleIntersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">,</span> <span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">sol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">a</span> <span class="o">=</span> <span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">.</span><span class="n">X</span><span class="p">,</span>
	   <span class="n">b</span> <span class="o">=</span> <span class="n">L</span><span class="p">.</span><span class="n">p</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">.</span><span class="n">X</span><span class="p">,</span>
	   <span class="n">c</span> <span class="o">=</span> <span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span>
	   <span class="n">d</span> <span class="o">=</span> <span class="n">L</span><span class="p">.</span><span class="n">p</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span>
	   <span class="n">e</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">c</span><span class="p">,</span>
	   <span class="n">f</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">d</span><span class="p">),</span>
	   <span class="n">g</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">,</span>
	   <span class="n">delta</span> <span class="o">=</span> <span class="n">f</span> <span class="o">*</span> <span class="n">f</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">e</span> <span class="o">*</span> <span class="n">g</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">delta</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="o">-</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">e</span><span class="p">))),</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">point</span><span class="p">((</span><span class="o">-</span><span class="n">f</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">delta</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">e</span><span class="p">)));</span>
	<span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">point</span><span class="p">((</span><span class="o">-</span><span class="n">f</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">delta</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">e</span><span class="p">)));</span>
	<span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">getCircleIntersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C2</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">sol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">C1</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">C2</span><span class="p">.</span><span class="n">c</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">C2</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">//重合返回-1
</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">+</span> <span class="n">C2</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">sgn</span><span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">C2</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">//外离或内含
</span>		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">lf</span> <span class="n">a</span> <span class="o">=</span> <span class="n">arg</span><span class="p">(</span><span class="n">C2</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">C1</span><span class="p">.</span><span class="n">c</span><span class="p">),</span>
	   <span class="n">da</span> <span class="o">=</span> <span class="n">acos</span><span class="p">((</span><span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="n">C2</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C2</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">d</span><span class="p">));</span>

	<span class="n">Coord</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">C1</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">da</span><span class="p">),</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">C1</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">da</span><span class="p">);</span>

	<span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">p1</span> <span class="o">==</span> <span class="n">p2</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//相切
</span>	<span class="k">return</span> <span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p2</span><span class="p">),</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Line</span> <span class="n">getTangent</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Line</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Normal</span><span class="p">(</span><span class="n">C</span> <span class="o">-</span> <span class="n">P</span><span class="p">));</span> <span class="p">}</span> <span class="c1">//圆心C，圆上一点P处切线
</span>
<span class="kt">int</span> <span class="n">getTangents</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">,</span> <span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">sol</span><span class="p">)</span> <span class="c1">//点到圆的切点，返回个数
</span><span class="p">{</span>
	<span class="n">Coord</span> <span class="n">u</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">;</span>
	<span class="n">lf</span> <span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>	  <span class="c1">//点在圆内
</span>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">))</span> <span class="c1">//点在圆上
</span>		<span class="k">return</span> <span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">lf</span> <span class="n">base</span> <span class="o">=</span> <span class="n">arg</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">ang</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">/</span> <span class="n">d</span><span class="p">);</span>
	<span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">C</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ang</span><span class="p">));</span>
	<span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">C</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="n">ang</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">getTangents</span><span class="p">(</span><span class="n">Circle</span> <span class="n">A</span><span class="p">,</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="c1">//公共切线的切点
</span><span class="p">{</span>
	<span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">r</span> <span class="o">&lt;</span> <span class="n">B</span><span class="p">.</span><span class="n">r</span><span class="p">)</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">),</span> <span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span> <span class="c1">//有时需标记交换
</span>
	<span class="n">lf</span> <span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">c</span><span class="p">),</span>
	   <span class="n">rdiff</span> <span class="o">=</span> <span class="n">A</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">r</span><span class="p">,</span>
	   <span class="n">rsum</span> <span class="o">=</span> <span class="n">A</span><span class="p">.</span><span class="n">r</span> <span class="o">+</span> <span class="n">B</span><span class="p">.</span><span class="n">r</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">rdiff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//内含
</span>
	<span class="n">lf</span> <span class="n">base</span> <span class="o">=</span> <span class="n">arg</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">A</span><span class="p">.</span><span class="n">c</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">rdiff</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">//重合，无穷多条切线
</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">rdiff</span><span class="p">))</span> <span class="c1">//内切，外公切线
</span>	<span class="p">{</span>
		<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span><span class="p">));</span>
		<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span><span class="p">));</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="c1">//有外公切线的情形
</span>	<span class="n">lf</span> <span class="n">ang</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="n">rdiff</span> <span class="o">/</span> <span class="n">d</span><span class="p">);</span>
	<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ang</span><span class="p">));</span>
	<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ang</span><span class="p">));</span>
	<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="n">ang</span><span class="p">));</span>
	<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="n">ang</span><span class="p">));</span>
	<span class="n">cnt</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">rsum</span><span class="p">))</span>
	<span class="p">{</span>
		<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span><span class="p">));</span>
		<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">M_PI</span><span class="p">));</span>
		<span class="o">++</span><span class="n">cnt</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">rsum</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">lf</span> <span class="n">ang_in</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="n">rsum</span> <span class="o">/</span> <span class="n">d</span><span class="p">);</span>
		<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ang_in</span><span class="p">));</span>
		<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ang_in</span> <span class="o">+</span> <span class="n">M_PI</span><span class="p">));</span>
		<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="n">ang_in</span><span class="p">));</span>
		<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="n">ang_in</span> <span class="o">+</span> <span class="n">M_PI</span><span class="p">));</span>
		<span class="n">cnt</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">cnt</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">lf</span> <span class="n">AreaCircleWithTriangle</span><span class="p">(</span><span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="n">Coord</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord</span> <span class="n">B</span><span class="p">)</span> <span class="c1">//C和三角形OAB的相交面积，如果三角形顶点不在O上则把圆和三角形同时平移，直到有一个顶点在O上
</span><span class="p">{</span>
	<span class="kt">int</span> <span class="n">sg</span> <span class="o">=</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sg</span> <span class="o">||</span> <span class="n">A</span> <span class="o">==</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span> <span class="o">||</span> <span class="n">B</span> <span class="o">==</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">lf</span> <span class="n">OA</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">),</span> <span class="n">OB</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">),</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">),</span>
	   <span class="n">d</span> <span class="o">=</span> <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">Coord</span><span class="p">(),</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">OA</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">OB</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">Cross</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">OA</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">OB</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">sg</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">angle</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">OA</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">OB</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Coord</span> <span class="n">prj</span> <span class="o">=</span> <span class="n">getLineProjection</span><span class="p">(</span><span class="n">Coord</span><span class="p">(),</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">onSegment</span><span class="p">(</span><span class="n">prj</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">))</span>
			<span class="k">return</span> <span class="n">sg</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">angle</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

		<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">;</span>
		<span class="n">Line</span> <span class="n">L</span> <span class="o">=</span> <span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span>
		<span class="n">getLineCircleIntersection</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>

		<span class="n">lf</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">angle</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
		   <span class="n">s2</span> <span class="o">=</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">Angle</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">s2</span> <span class="o">-=</span> <span class="n">fabs</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">s1</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">-</span> <span class="n">s2</span><span class="p">;</span>

		<span class="k">return</span> <span class="n">sg</span> <span class="o">*</span> <span class="n">s1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">OB</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>

	<span class="n">Line</span> <span class="n">L</span> <span class="o">=</span> <span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">inter</span><span class="p">;</span>
	<span class="n">getLineCircleIntersection</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">inter</span><span class="p">);</span>
	<span class="n">Coord</span> <span class="n">inter_point</span> <span class="o">=</span> <span class="n">inter</span><span class="p">[</span><span class="o">!</span><span class="n">onSegment</span><span class="p">(</span><span class="n">inter</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)];</span>

	<span class="n">lf</span> <span class="n">s</span> <span class="o">=</span> <span class="n">fabs</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">inter_point</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">s</span> <span class="o">+=</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">Angle</span><span class="p">(</span><span class="n">inter_point</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">s</span> <span class="o">*</span> <span class="n">sg</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">lf</span> <span class="n">AreaCircleWithPolygon</span><span class="p">(</span><span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="n">ans</span> <span class="o">+=</span> <span class="n">AreaCircleWithTriangle</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()]);</span>
	<span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">ans</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">Coord</span> <span class="n">getGravityCenter</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">)</span> <span class="c1">//多边形重心
</span><span class="p">{</span>
	<span class="n">Coord</span> <span class="n">a</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lf</span> <span class="n">am</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mj</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">mj</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()]);</span>
		<span class="n">a</span> <span class="o">+=</span> <span class="n">mj</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()]);</span>
		<span class="n">am</span> <span class="o">+=</span> <span class="n">mj</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">am</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="三维">三维</h2>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="kt">double</span> <span class="n">lf</span><span class="p">;</span>
<span class="k">const</span> <span class="n">lf</span> <span class="n">EPS</span> <span class="o">=</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="n">INF</span> <span class="o">=</span> <span class="mf">1e9</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">sgn</span><span class="p">(</span><span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">EPS</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">EPS</span><span class="p">);</span> <span class="p">}</span>
<span class="k">struct</span> <span class="n">Coord3</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">;</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">X</span><span class="p">)</span> <span class="o">||</span> <span class="n">sgn</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span> <span class="o">||</span> <span class="n">sgn</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">Z</span><span class="p">);</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">);</span> <span class="p">}</span>
	<span class="n">Coord3</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">+=</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">X</span> <span class="o">+=</span> <span class="n">b</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">+=</span> <span class="n">b</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">+=</span> <span class="n">b</span><span class="p">.</span><span class="n">Z</span><span class="p">,</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">+=</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Coord3</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">-=</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">X</span> <span class="o">-=</span> <span class="n">b</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">-=</span> <span class="n">b</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">-=</span> <span class="n">b</span><span class="p">.</span><span class="n">Z</span><span class="p">,</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">-=</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Coord3</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">*=</span><span class="p">(</span><span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">X</span> <span class="o">*=</span> <span class="n">d</span><span class="p">,</span> <span class="n">Y</span> <span class="o">*=</span> <span class="n">d</span><span class="p">,</span> <span class="n">Z</span> <span class="o">*=</span> <span class="n">d</span><span class="p">,</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">a</span><span class="p">,</span> <span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">*=</span> <span class="n">d</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="n">lf</span> <span class="n">d</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">*=</span> <span class="n">d</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Coord3</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">/=</span><span class="p">(</span><span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">X</span> <span class="o">/=</span> <span class="n">d</span><span class="p">,</span> <span class="n">Y</span> <span class="o">/=</span> <span class="n">d</span><span class="p">,</span> <span class="n">Z</span> <span class="o">/=</span> <span class="n">d</span><span class="p">,</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="k">operator</span><span class="o">/</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">a</span><span class="p">,</span> <span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">/=</span> <span class="n">d</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">Dot</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span> <span class="o">+</span> <span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span> <span class="o">+</span> <span class="n">A</span><span class="p">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="n">Cross</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">{</span><span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">A</span><span class="p">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">A</span><span class="p">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span><span class="p">};</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">norm</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">A</span><span class="p">);</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">abs</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">A</span><span class="p">));</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">Angle</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">acos</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">B</span><span class="p">));</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">Area2</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">C</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">A</span><span class="p">));</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">Volume6</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">C</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">D</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Dot</span><span class="p">(</span><span class="n">D</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">Cross</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">A</span><span class="p">));</span> <span class="p">}</span>	 <span class="c1">//四面体体积
</span>	<span class="k">friend</span> <span class="n">Coord3</span> <span class="n">Centroid</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">C</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">D</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span><span class="p">)</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">;</span> <span class="p">}</span>		  <span class="c1">//四面体的重心
</span>	<span class="k">friend</span> <span class="n">lf</span> <span class="n">DistanceToPlane</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">p</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p0</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Dot</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">p0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">n</span><span class="p">);</span> <span class="p">}</span>		  <span class="c1">//点p到平面p0-n的有向距离
</span>	<span class="k">friend</span> <span class="n">Coord3</span> <span class="n">getPlaneProjection</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">p</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p0</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">p</span> <span class="o">-</span> <span class="n">n</span> <span class="o">*</span> <span class="n">Dot</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">p0</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//点p在平面p0-n上的投影。n必须为单位向量
</span>	<span class="k">friend</span> <span class="n">Coord3</span> <span class="n">LinePlaneIntersection</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">p1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p2</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p0</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">n</span><span class="p">)</span>							  <span class="c1">//直线p1-p2 与平面p0-n的交点，假设交点唯一存在
</span>	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">v</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span><span class="p">;</span>
		<span class="n">lf</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p0</span> <span class="o">-</span> <span class="n">p1</span><span class="p">)</span> <span class="o">/</span> <span class="n">Dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span><span class="p">);</span> <span class="c1">//分母为0，直线与平面平行或在平面上
</span>		<span class="k">return</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span> <span class="n">t</span><span class="p">;</span>						  <span class="c1">//如果是线段 判断t是否在0~1之间
</span>	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">P</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">)</span> <span class="c1">//点P到直线AB的距离
</span>	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">A</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">v1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">DistanceToSeg</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">P</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">)</span> <span class="c1">//点到线段的距离
</span>	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">A</span> <span class="o">==</span> <span class="n">B</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">P</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span>
		<span class="n">Coord3</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">v3</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">B</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">v2</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v3</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">v3</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">DistanceToLine</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">));</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">LineDistance3D</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">p1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">u</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p2</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">v</span><span class="p">,</span> <span class="n">lf</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="c1">//求异面直线 p1+s*u与p2+t*v的公垂线对应的s，如果平行|重合，返回0
</span>	<span class="p">{</span>
		<span class="n">lf</span> <span class="n">b</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="n">Dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">lf</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p2</span><span class="p">)</span> <span class="o">-</span> <span class="n">Dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p2</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">s</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">SameSide</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">p1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p2</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">a</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">a</span><span class="p">),</span> <span class="n">Cross</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">a</span><span class="p">)))</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//p1和p2是否在线段a-b的同侧
</span>	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">PointInTri</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">PP</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">P</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>																						 <span class="c1">//点P在三角形P0,P1,p中
</span>	<span class="p">{</span>
		<span class="k">return</span> <span class="n">SameSide</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;&amp;</span>
			   <span class="n">SameSide</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;&amp;</span>
			   <span class="n">SameSide</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">TriSegIntersection</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">P</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">,</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">PP</span><span class="p">)</span> <span class="c1">//三角形P0P1p是否和线段AB相交，如有则为PP
</span>	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">n</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>						 <span class="c1">//线段A-B和平面P0P1p平行或共面
</span>		<span class="n">lf</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">/</span> <span class="n">Dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span> <span class="c1">//平面A和直线P1-p有惟一交点
</span>		<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">sgn</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">//不在线段AB上
</span>		<span class="k">return</span> <span class="n">PointInTri</span><span class="p">(</span><span class="n">PP</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span> <span class="n">P</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">TriTriIntersection</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">T1</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">Coord3</span> <span class="n">T2</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="c1">//空间两三角形是否相交
</span>	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">P</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">TriSegIntersection</span><span class="p">(</span><span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">T2</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">],</span> <span class="n">P</span><span class="p">)</span> <span class="o">||</span>
				<span class="n">TriSegIntersection</span><span class="p">(</span><span class="n">T2</span><span class="p">,</span> <span class="n">T1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">T1</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">],</span> <span class="n">P</span><span class="p">))</span>
				<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">SegSegDistance</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">a1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">b1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">a2</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">b2</span><span class="p">,</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">ans1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">ans2</span><span class="p">)</span> <span class="c1">//空间两直线上最近点对 返回最近距离 点对保存在ans1 ans2中
</span>	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span> <span class="o">-</span> <span class="n">b1</span><span class="p">),</span> <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">a2</span> <span class="o">-</span> <span class="n">b2</span><span class="p">);</span>
		<span class="n">Coord3</span> <span class="n">N</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">);</span>
		<span class="n">Coord3</span> <span class="n">ab</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span> <span class="o">-</span> <span class="n">a2</span><span class="p">);</span>
		<span class="n">lf</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">ab</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>
		<span class="n">Coord3</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">b1</span> <span class="o">-</span> <span class="n">a1</span><span class="p">,</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">b2</span> <span class="o">-</span> <span class="n">a2</span><span class="p">,</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span>
		<span class="n">lf</span> <span class="n">nd</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">cd</span><span class="p">),</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">a2</span> <span class="o">-</span> <span class="n">a1</span><span class="p">,</span> <span class="n">d2</span><span class="p">),</span> <span class="n">cd</span><span class="p">)</span> <span class="o">/</span> <span class="n">nd</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">a2</span> <span class="o">-</span> <span class="n">a1</span><span class="p">,</span> <span class="n">d1</span><span class="p">),</span> <span class="n">cd</span><span class="p">)</span> <span class="o">/</span> <span class="n">nd</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">ans1</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">+</span> <span class="p">(</span><span class="n">b1</span> <span class="o">-</span> <span class="n">a1</span><span class="p">)</span> <span class="o">*</span> <span class="n">t1</span><span class="p">,</span> <span class="n">ans2</span> <span class="o">=</span> <span class="n">a2</span> <span class="o">+</span> <span class="p">(</span><span class="n">b2</span> <span class="o">-</span> <span class="n">a2</span><span class="p">)</span> <span class="o">*</span> <span class="n">t2</span><span class="p">,</span> <span class="n">fabs</span><span class="p">(</span><span class="n">ans</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">InsideWithMinDistance</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">PP</span><span class="p">,</span> <span class="n">Coord3</span> <span class="o">*</span><span class="n">P</span><span class="p">,</span> <span class="n">lf</span> <span class="n">dist</span><span class="p">)</span> <span class="c1">//判断PP是否在三角形P中，并且到三条边的距离都至少为dist。保证P,A,B,C共面
</span>	<span class="p">{</span>
		<span class="k">return</span> <span class="n">PointInTri</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
				   <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">dist</span> <span class="o">||</span>
			   <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">dist</span> <span class="o">||</span>
			   <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">dist</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">minBall</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord3</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="k">const</span> <span class="n">lf</span> <span class="n">eps</span> <span class="o">=</span> <span class="n">EPS</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">)</span> <span class="c1">//模拟退火求最小球覆盖，EPS玄学调整；返回半径
</span>	<span class="p">{</span>
		<span class="n">lf</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">Coord3</span> <span class="n">z</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">;</span> <span class="n">step</span> <span class="o">*=</span> <span class="mf">0.99</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">abs</span><span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
					<span class="n">s</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
			<span class="n">ans</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="n">abs</span><span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]));</span>
			<span class="n">z</span> <span class="o">-=</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="o">*</span> <span class="n">step</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="n">Sphere</span>
<span class="p">{</span>
	<span class="n">Coord3</span> <span class="n">o</span><span class="p">;</span>
	<span class="n">lf</span> <span class="n">r</span><span class="p">;</span>
	<span class="n">Coord3</span> <span class="n">point</span><span class="p">(</span><span class="n">lf</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lf</span> <span class="n">lng</span><span class="p">)</span> <span class="k">const</span> <span class="c1">//经纬度确定球面上一点
</span>	<span class="p">{</span>
		<span class="n">lat</span> <span class="o">*=</span> <span class="n">M_PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">;</span>
		<span class="n">lng</span> <span class="o">*=</span> <span class="n">M_PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">o</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">Coord3</span><span class="p">{</span><span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">lng</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">lng</span><span class="p">),</span> <span class="n">sin</span><span class="p">(</span><span class="n">lat</span><span class="p">)};</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="n">ConvexPolyhedron</span> <span class="c1">//空间多边形和凸包问题
</span><span class="p">{</span>
	<span class="k">struct</span> <span class="n">Face</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
		<span class="n">Face</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span> <span class="p">}</span>
		<span class="n">Coord3</span> <span class="n">Normal</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord3</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Cross</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">P</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="p">}</span>
		<span class="kt">bool</span> <span class="n">CanSee</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord3</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Dot</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">Normal</span><span class="p">(</span><span class="n">P</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//f是否能看见P[i]
</span>	<span class="p">};</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Face</span><span class="o">&gt;</span> <span class="n">faces</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord3</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">;</span>
	<span class="n">ConvexPolyhedron</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord3</span><span class="o">&gt;</span> <span class="n">P</span><span class="p">)</span> <span class="o">:</span> <span class="n">p</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Coord3</span><span class="p">{</span><span class="n">randEPS</span><span class="p">(),</span> <span class="n">randEPS</span><span class="p">(),</span> <span class="n">randEPS</span><span class="p">()};</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">vis</span><span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">size</span><span class="p">()));</span>
		<span class="n">faces</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Face</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span> <span class="c1">//由于已经进行扰动，前三个点不共线
</span>		<span class="n">faces</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Face</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">P</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">vector</span><span class="o">&lt;</span><span class="n">Face</span><span class="o">&gt;</span> <span class="n">next</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">faces</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="c1">//计算每条边的“左面”的可见性
</span>			<span class="p">{</span>
				<span class="n">Face</span> <span class="o">&amp;</span><span class="n">f</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
				<span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">CanSee</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">res</span><span class="p">)</span>
					<span class="n">next</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span>
					<span class="n">vis</span><span class="p">[</span><span class="n">f</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="n">f</span><span class="p">.</span><span class="n">v</span><span class="p">[(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="n">res</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">faces</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">b</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">v</span><span class="p">[(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">];</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">!=</span> <span class="n">vis</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="n">a</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">vis</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">])</span> <span class="c1">//(a,b)是分界线，左边对P[i]可见
</span>						<span class="n">next</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Face</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">i</span><span class="p">));</span>
				<span class="p">}</span>
			<span class="n">swap</span><span class="p">(</span><span class="n">faces</span><span class="p">,</span> <span class="n">next</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">lf</span> <span class="n">randEPS</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">rand</span><span class="p">()</span> <span class="o">/</span> <span class="n">lf</span><span class="p">(</span><span class="n">RAND_MAX</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">EPS</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Coord3</span> <span class="n">centroid</span><span class="p">()</span> <span class="c1">//三维凸包重心
</span>	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">C</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tot</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
		<span class="n">lf</span> <span class="n">totv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">faces</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">Coord3</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]];</span>
			<span class="n">lf</span> <span class="n">v</span> <span class="o">=</span> <span class="o">-</span><span class="n">Volume6</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">C</span><span class="p">);</span>
			<span class="n">totv</span> <span class="o">+=</span> <span class="n">v</span><span class="p">;</span>
			<span class="n">tot</span> <span class="o">+=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">Centroid</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">C</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">tot</span> <span class="o">/</span> <span class="n">totv</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">lf</span> <span class="n">dist</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">C</span><span class="p">)</span> <span class="c1">//凸包内一点到表面最近距离
</span>	<span class="p">{</span>
		<span class="n">lf</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">faces</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">Coord3</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]];</span>
			<span class="n">ans</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="n">fabs</span><span class="p">(</span><span class="o">-</span><span class="n">Volume6</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span> <span class="o">/</span> <span class="n">Area2</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)));</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

  
  <h1>
    <a href="/posts/acm/template/%E9%AB%98%E7%B2%BE%E5%BA%A6">
      高精度
    </a>
  </h1>
  <h2 id="无符号整数">无符号整数</h2>
<p><a href="https://vjudge.net/solution/16907599">使用范例</a></p>

<p>vector自带大小比较为字典序比较， <code class="highlighter-rouge">!=</code> 、 <code class="highlighter-rouge">==</code> 运算，其余需要时一定记得重载！</p>

<p>减法，当被减数小于减数时减为0。</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Wint</span> <span class="o">:</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="c1">//继承vector
</span><span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="mf">1e9</span><span class="p">;</span>
	<span class="n">Wint</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">//普通初始化，当整型数和Wint同时运算时会提升至Wint
</span>	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(;</span> <span class="n">n</span><span class="p">;</span> <span class="n">n</span> <span class="o">/=</span> <span class="n">base</span><span class="p">)</span>
			<span class="n">push_back</span><span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="n">base</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">explicit</span> <span class="n">Wint</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="c1">//字符串初始化函数，未判断字符串合法情况
</span>	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="kt">int</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">width</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">e</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">width</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">e</span> <span class="o">-</span> <span class="n">width</span><span class="p">),</span> <span class="n">push_back</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">e</span><span class="p">;</span> <span class="o">++</span><span class="n">b</span><span class="p">)</span>
				<span class="n">back</span><span class="p">()</span> <span class="o">=</span> <span class="n">back</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">-</span> <span class="sc">'0'</span><span class="p">;</span>
		<span class="n">trim</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">Wint</span> <span class="o">&amp;</span><span class="n">trim</span><span class="p">(</span><span class="kt">bool</span> <span class="n">up</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">//去前导0，是否需要进位，很常用的小函数，为方便返回自身
</span>	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">up</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="o">--</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">base</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">base</span><span class="p">)</span>
				<span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">base</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">%=</span> <span class="n">base</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">back</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">pop_back</span><span class="p">();</span>
		<span class="k">for</span> <span class="p">(;</span> <span class="n">up</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">back</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">base</span><span class="p">;</span> <span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">%=</span> <span class="n">base</span><span class="p">)</span>
			<span class="n">push_back</span><span class="p">(</span><span class="n">back</span><span class="p">()</span> <span class="o">/</span> <span class="n">base</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">istream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">istream</span> <span class="o">&amp;</span><span class="n">is</span><span class="p">,</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">string</span> <span class="n">s</span><span class="p">;</span> <span class="c1">//懒
</span>		<span class="k">return</span> <span class="n">is</span> <span class="o">&gt;&gt;</span> <span class="n">s</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">Wint</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">is</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">ostream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
			<span class="k">return</span> <span class="n">os</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="sc">'0'</span><span class="p">);</span>
		<span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
		<span class="kt">char</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="sc">'0'</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">n</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span> <span class="o">~</span><span class="n">i</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span>
			<span class="n">os</span><span class="p">.</span><span class="n">width</span><span class="p">(</span><span class="n">n</span><span class="p">.</span><span class="n">width</span><span class="p">),</span> <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">return</span> <span class="n">os</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">ch</span><span class="p">),</span> <span class="n">os</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
			<span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">~</span><span class="n">i</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;=</span><span class="p">(</span><span class="k">const</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">);</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&gt;=</span><span class="p">(</span><span class="k">const</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">);</span> <span class="p">}</span>
	<span class="n">Wint</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">+=</span><span class="p">(</span><span class="k">const</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
			<span class="n">resize</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="c1">//保证有足够的位数
</span>		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">return</span> <span class="n">trim</span><span class="p">();</span> <span class="c1">//单独进位防自运算
</span>	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">Wint</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="n">Wint</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">+=</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Wint</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">++</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//前置版本，懒
</span>	<span class="n">Wint</span> <span class="k">operator</span><span class="o">++</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span>					  <span class="c1">//后置版本
</span>	<span class="p">{</span>
		<span class="n">Wint</span> <span class="n">b</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">++*</span><span class="k">this</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">Wint</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">-=</span><span class="p">(</span><span class="k">const</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="c1">//a&lt;b会使a变为0
</span>	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
			<span class="n">resize</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="c1">//保证有足够的位数
</span>		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">return</span> <span class="n">trim</span><span class="p">();</span> <span class="c1">//单独进位防自运算
</span>	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">Wint</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="n">Wint</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">-=</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Wint</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">--</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//前置版本，懒
</span>	<span class="n">Wint</span> <span class="k">operator</span><span class="o">--</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span>					  <span class="c1">//后置版本
</span>	<span class="p">{</span>
		<span class="n">Wint</span> <span class="n">b</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">--*</span><span class="k">this</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">Wint</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">*=</span><span class="p">(</span><span class="k">const</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="c1">//高精度乘法，常规写法
</span>	<span class="p">{</span>
		<span class="n">Wint</span> <span class="n">c</span><span class="p">;</span>
		<span class="n">c</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="c1">//稀疏优化，特殊情况很有效
</span>				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span><span class="p">];</span>
					<span class="k">for</span> <span class="p">(</span><span class="n">n</span> <span class="o">*=</span> <span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">k</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">;</span> <span class="n">n</span><span class="p">;</span> <span class="n">n</span> <span class="o">/=</span> <span class="n">base</span><span class="p">)</span>
						<span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="o">++</span><span class="p">]</span> <span class="o">+=</span> <span class="n">n</span> <span class="o">%</span> <span class="n">base</span><span class="p">;</span>
					<span class="k">for</span> <span class="p">(</span><span class="n">l</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">;</span> <span class="n">c</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">base</span> <span class="o">||</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">;</span> <span class="n">c</span><span class="p">[</span><span class="n">l</span><span class="o">++</span><span class="p">]</span> <span class="o">%=</span> <span class="n">base</span><span class="p">)</span>
						<span class="n">c</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">/</span> <span class="n">base</span><span class="p">;</span>
				<span class="p">}</span>
		<span class="k">return</span> <span class="n">swap</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">trim</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="cm">/*
	Wint&amp; operator*=(const Wint &amp;b)//一种效率略高但对位宽有限制的写法
	{
		vector&lt;unsigned long long&gt; n(size()+b.size(),0);//防爆int
		//乘法算完后统一进位效率高，防止乘法溢出（unsigned long long范围0~1.8e19）
		//位宽为9时size()不能超过18（十进制162位），位宽为8时size()不能超过1800（十进制14400位）等等。
		for(int j=0; j!=b.size(); ++j)
			if(b[j])//稀疏优化，特殊情况很有效
				for(int i=0; i!=size(); ++i)
					n[i+j]+=(unsigned long long)(*this)[i]*b[j];
		for(int i=1; i&lt;n.size(); ++i)//这里用&lt;防止位数0，单独进位防自运算
			n[i]+=n[i-1]/base,n[i-1]%=base;
		return assign(n.begin(),n.end()),trim(0);
	}
	Wint&amp; operator*=(const Wint &amp;b)//fft优化乘法，注意double仅15位有效数字，调小Wint::width不超过2，计算自2*log2(base)+2*log2(len)&lt;53
	{
		vector&lt;ll&gt; ax(begin(),end()),bx(b.begin(),b.end());
		ax=FFT(size()+b.size()).ask(ax,bx);
		for(int i=1; i&lt;ax.size(); ++i)
			ax[i]+=ax[i-1]/base,ax[i-1]%=base;
		return assign(ax.begin(),ax.end()),trim(0);
	}
	Wint&amp; operator*=(const Wint &amp;b)//ntt优化，Wint::width不超过2
	{
		vector&lt;ll&gt; ax(begin(),end()),bx(b.begin(),b.end());
		ax=FNTT(size()+b.size(),(7&lt;&lt;26)+1,3).ask(ax,bx);
		for(int i=1; i&lt;ax.size(); ++i)
			ax[i]+=ax[i-1]/base,ax[i-1]%=base;
		return assign(ax.begin(),ax.end()),trim(0);
	}
	*/</span>
	<span class="k">friend</span> <span class="n">Wint</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="n">Wint</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">*=</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Wint</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">/=</span><span class="p">(</span><span class="n">Wint</span> <span class="n">b</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Wint</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">base</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">back</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="o">*</span><span class="k">this</span> <span class="o">*=</span> <span class="n">d</span><span class="p">,</span> <span class="n">b</span> <span class="o">*=</span> <span class="n">d</span><span class="p">,</span> <span class="n">c</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">~</span><span class="n">i</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">r</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span><span class="p">]);</span>
			<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">--</span><span class="n">j</span><span class="p">)</span> <span class="c1">//b.size()==0肯定第一行就出问题的
</span>				<span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">b</span><span class="p">.</span><span class="n">base</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">?</span> <span class="n">r</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">d</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span> <span class="o">/</span> <span class="n">b</span><span class="p">.</span><span class="n">back</span><span class="p">(),</span> <span class="n">d</span> <span class="o">*=</span> <span class="n">b</span><span class="p">;</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">;</span> <span class="n">r</span> <span class="o">+=</span> <span class="n">b</span><span class="p">)</span>
				<span class="o">--</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="n">r</span> <span class="o">-=</span> <span class="n">d</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">swap</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">trim</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">//r为加倍后的余数，可通过高精度除低精度得到真正余数，此处略
</span>	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">Wint</span> <span class="k">operator</span><span class="o">/</span><span class="p">(</span><span class="n">Wint</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">/=</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Wint</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">%=</span><span class="p">(</span><span class="k">const</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span> <span class="o">-=</span> <span class="o">*</span><span class="k">this</span> <span class="o">/</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Wint</span> <span class="k">operator</span><span class="o">%</span><span class="p">(</span><span class="n">Wint</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">%=</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
	<span class="c1">//开平方，改自ZJU模板
</span>	<span class="kt">bool</span> <span class="n">cmp</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">d</span><span class="p">,</span> <span class="k">const</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="k">const</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">d</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">c</span><span class="p">)</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="kt">long</span> <span class="kt">long</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lo</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">base</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span> <span class="n">lo</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">&amp;&amp;</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">~</span><span class="n">i</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">base</span> <span class="o">-</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">-</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">())</span>
				<span class="n">t</span> <span class="o">+=</span> <span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span> <span class="o">-</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">Wint</span> <span class="o">&amp;</span><span class="n">sub</span><span class="p">(</span><span class="k">const</span> <span class="n">Wint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">,</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">k</span><span class="p">,</span> <span class="kt">int</span> <span class="n">d</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">l</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="n">d</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">l</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="kt">long</span> <span class="kt">long</span> <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">-</span> <span class="n">base</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">base</span><span class="p">;</span>
				<span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">-</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">-</span> <span class="n">base</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">base</span> <span class="o">*</span> <span class="n">base</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">else</span>
				<span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="p">((</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">base</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">base</span><span class="p">;</span>
			<span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="p">((</span><span class="o">*</span><span class="k">this</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">base</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">base</span> <span class="o">*</span> <span class="n">base</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">trim</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">Wint</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">Wint</span> <span class="n">a</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Wint</span> <span class="n">n</span><span class="p">;</span>
		<span class="n">n</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">n</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">;</span> <span class="o">~</span><span class="n">i</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">base</span><span class="p">,</span> <span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">r</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span> <span class="n">r</span> <span class="o">-</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">;</span> <span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">r</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="p">.</span><span class="n">cmp</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
					<span class="n">r</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
				<span class="k">else</span>
					<span class="n">l</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="p">}</span>
			<span class="n">a</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">r</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">n</span><span class="p">.</span><span class="n">trim</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="cm">/*
	friend Wint sqrt(const Wint &amp;a)//常规牛顿迭代实现的开平方算法，慢但是好敲
	{
		Wint b=a,c=(b+1)/2;
		while(b!=c)swap(b,c),c=(b+a/b)/2;
		return c;
	}
	friend Wint sqrt(const Wint &amp;a)
	{
		Wint ret,t;
		ret.assign((a.size()+1)&gt;&gt;1,0);
		for(int i=ret.size()-1,l,r; ~i; --i)
		{
			for(l=0,r=a.base; r-l&gt;1;)
			{
				ret[i]=l+(r-l)/2;
				t=ret*ret;
				if(a&lt;t)r=ret[i];
				else l=ret[i];
			}
			if(!l&amp;&amp;i==ret.size()-1)ret.pop_back();
			else ret[i]=l;
		}
		return ret;
	}
	*/</span>
<span class="p">};</span>
</code></pre></div></div>
<h2 id="分数">分数</h2>
<p><a href="https://vjudge.net/solution/16733633">使用示范</a>。</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Fraction</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">;</span>
	<span class="n">Fraction</span><span class="p">(</span><span class="n">ll</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ll</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="n">num</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">den</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">d</span> <span class="o">=</span> <span class="n">__gcd</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">),</span> <span class="n">num</span> <span class="o">/=</span> <span class="n">d</span><span class="p">,</span> <span class="n">den</span> <span class="o">/=</span> <span class="n">d</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">den</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">num</span> <span class="o">=</span> <span class="o">-</span><span class="n">num</span><span class="p">,</span> <span class="n">den</span> <span class="o">=</span> <span class="o">-</span><span class="n">den</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">Fraction</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">ll</span> <span class="n">d</span> <span class="o">=</span> <span class="n">__gcd</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">den</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">den</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">den</span> <span class="o">/</span> <span class="n">d</span> <span class="o">*</span> <span class="n">A</span><span class="p">.</span><span class="n">num</span> <span class="o">+</span> <span class="n">A</span><span class="p">.</span><span class="n">den</span> <span class="o">/</span> <span class="n">d</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="n">A</span><span class="p">.</span><span class="n">den</span> <span class="o">/</span> <span class="n">d</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">den</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">Fraction</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">+=</span><span class="p">(</span><span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span> <span class="o">+</span> <span class="n">c</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Fraction</span> <span class="k">operator</span><span class="o">-</span><span class="p">()</span> <span class="k">const</span>
	<span class="p">{</span>
		<span class="n">Fraction</span> <span class="n">r</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">r</span><span class="p">.</span><span class="n">num</span> <span class="o">=</span> <span class="o">-</span><span class="n">r</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="n">r</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">Fraction</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">-</span><span class="n">c</span> <span class="o">+</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Fraction</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">-=</span><span class="p">(</span><span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span> <span class="o">-</span> <span class="n">c</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Fraction</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="n">A</span><span class="p">.</span><span class="n">den</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">den</span><span class="p">);</span> <span class="p">}</span>
	<span class="n">Fraction</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">*=</span><span class="p">(</span><span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span> <span class="o">*</span> <span class="n">c</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Fraction</span> <span class="k">operator</span><span class="o">/</span><span class="p">(</span><span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">den</span><span class="p">,</span> <span class="n">A</span><span class="p">.</span><span class="n">den</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">num</span><span class="p">);</span> <span class="p">}</span>
	<span class="n">Fraction</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">/=</span><span class="p">(</span><span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span> <span class="o">/</span> <span class="n">c</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Fraction</span> <span class="k">operator</span><span class="o">%</span><span class="p">(</span><span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="n">c</span><span class="p">.</span><span class="n">den</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="n">a</span><span class="p">.</span><span class="n">den</span><span class="p">),</span> <span class="n">a</span><span class="p">.</span><span class="n">den</span> <span class="o">*</span> <span class="n">c</span><span class="p">.</span><span class="n">den</span><span class="p">);</span> <span class="p">}</span>
	<span class="n">Fraction</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">%=</span><span class="p">(</span><span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span> <span class="o">%</span> <span class="n">c</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="n">b</span><span class="p">.</span><span class="n">den</span> <span class="o">==</span> <span class="n">a</span><span class="p">.</span><span class="n">den</span> <span class="o">*</span> <span class="n">b</span><span class="p">.</span><span class="n">num</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">);</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="n">b</span><span class="p">.</span><span class="n">den</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">.</span><span class="n">den</span> <span class="o">*</span> <span class="n">b</span><span class="p">.</span><span class="n">num</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;=</span><span class="p">(</span><span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">);</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&gt;=</span><span class="p">(</span><span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">);</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Fraction</span> <span class="n">abs</span><span class="p">(</span><span class="n">Fraction</span> <span class="n">f</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">num</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">f</span><span class="p">.</span><span class="n">num</span> <span class="o">=</span> <span class="o">-</span><span class="n">f</span><span class="p">.</span><span class="n">num</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">f</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">ostream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Fraction</span> <span class="o">&amp;</span><span class="n">f</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="n">f</span><span class="p">.</span><span class="n">num</span> <span class="o">?</span> <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">f</span><span class="p">.</span><span class="n">den</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">f</span><span class="p">.</span><span class="n">num</span> <span class="o">:</span> <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">f</span><span class="p">.</span><span class="n">num</span> <span class="o">&lt;&lt;</span> <span class="sc">'/'</span> <span class="o">&lt;&lt;</span> <span class="n">f</span><span class="p">.</span><span class="n">den</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>
<h2 id="bitset高精度">bitset高精度</h2>
<p>代替整型进行位运算，更方便并且可以处理超过最大整形范围大小的位集合。
你可以把bitset看作可以位运算的bool数组，换言之，bitset的大小是固定的。因此，用bitset做状态压缩是很方便的，也可以方便的实现集合的交并补操作。
bitset仅重载了相等不等和位运算符，原生不支持四则运算和大小比较，所以很少代替高精度数。</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="n">bitset</span><span class="o">&lt;</span><span class="mi">127</span><span class="o">&gt;</span> <span class="n">Bint</span><span class="p">;</span>
<span class="cm">/*
Bint b(unsigned long long u=0);//用u的低N位初始化b，N是一个可转成ULL类型的常量表达式，高位补0
Bint bs(string s,int pos,int m=string::npos,char zero='0',char one='1');//用s从pos位开始的m位初始化b，s中只含zero和one

b.size();//b的大小，即N
b.count();//b中1的个数

b[pos];//b中pos位的引用

b.set();//b全赋1
b.reset();//b全赋0
b.flip();//b全反转

b.to_ull();//b转成unsigned long long，b.size()&gt;64时出错
b.to_string(char zero='0',char one='1');//按参数输出字符串

os&lt;&lt;b;//按'0'和'1'打印b
is&gt;&gt;b;//按'0'和'1'读入b，当下一个字符不是'0'或'1'或读到b.size()个数后停止

==、!=、&lt;&lt;、&gt;&gt;、&amp;、|、^//保持它们在整型运算中的含义
*/</span>
<span class="c1">//大小比较，其他运算符类似
</span><span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Bint</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Bint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">~</span><span class="n">i</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
			<span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Bint</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Bint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">~</span><span class="n">i</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//加法
</span><span class="n">Bint</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span> <span class="n">Bint</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Bint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">b</span><span class="p">.</span><span class="n">any</span><span class="p">()</span> <span class="o">?</span> <span class="p">(</span><span class="n">a</span> <span class="o">^</span> <span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">a</span> <span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span>
<span class="n">Bint</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">+=</span><span class="p">(</span><span class="n">Bint</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Bint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
<span class="c1">//减法
</span><span class="n">Bint</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="k">const</span> <span class="n">Bint</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Bint</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="o">~</span><span class="n">a</span><span class="p">;</span> <span class="p">}</span>
<span class="n">Bint</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">-=</span><span class="p">(</span><span class="n">Bint</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Bint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">+=</span> <span class="o">-</span><span class="n">b</span><span class="p">;</span> <span class="p">}</span>
<span class="n">Bint</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="n">Bint</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Bint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">-=</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
<span class="c1">//乘法
</span><span class="n">Bint</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="n">Bint</span> <span class="n">a</span><span class="p">,</span> <span class="n">Bint</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">Bint</span> <span class="n">r</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(;</span> <span class="n">b</span><span class="p">.</span><span class="n">any</span><span class="p">();</span> <span class="n">b</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span> <span class="o">+=</span> <span class="n">a</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">r</span> <span class="o">+=</span> <span class="n">a</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">Bint</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">*=</span><span class="p">(</span><span class="n">Bint</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Bint</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
<span class="c1">//整除，取模
</span><span class="n">Bint</span> <span class="k">operator</span><span class="o">%=</span><span class="p">(</span><span class="n">Bint</span> <span class="o">&amp;</span><span class="n">dividend</span><span class="p">,</span> <span class="k">const</span> <span class="n">Bint</span> <span class="o">&amp;</span><span class="n">divisor</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dividend</span> <span class="o">&lt;</span> <span class="n">divisor</span> <span class="o">||</span> <span class="n">divisor</span><span class="p">.</span><span class="n">none</span><span class="p">())</span>
		<span class="k">return</span> <span class="n">dividend</span><span class="p">;</span>
	<span class="n">Bint</span> <span class="n">c</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">;</span> <span class="n">divisor</span> <span class="o">&lt;</span> <span class="n">dividend</span><span class="p">;)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">divisor</span><span class="p">;</span> <span class="o">!</span><span class="p">(</span><span class="n">dividend</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">);</span> <span class="n">c</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dividend</span> <span class="o">&lt;</span> <span class="n">divisor</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">res</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">k</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">dividend</span> <span class="o">&lt;</span> <span class="n">divisor</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="n">res</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">dividend</span> <span class="o">-=</span> <span class="n">c</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">dividend</span><span class="p">;</span> <span class="c1">//res是商
</span><span class="p">}</span>
<span class="c1">//输入输出，bitset已经原生重载了输入输出运算符，避免歧义。
</span><span class="n">istream</span> <span class="o">&amp;</span><span class="n">getb</span><span class="p">(</span><span class="n">istream</span> <span class="o">&amp;</span><span class="n">is</span><span class="p">,</span> <span class="n">Bint</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">is</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
	<span class="k">for</span> <span class="p">(;</span> <span class="o">!</span><span class="n">isdigit</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">ch</span> <span class="o">!=</span> <span class="n">EOF</span><span class="p">;</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">is</span><span class="p">.</span><span class="n">get</span><span class="p">())</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="sc">'-'</span><span class="p">)</span>
			<span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="n">sign</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">isdigit</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">is</span><span class="p">.</span><span class="n">get</span><span class="p">())</span>
		<span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">ch</span> <span class="o">^</span> <span class="sc">'0'</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sign</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">val</span> <span class="o">=</span> <span class="o">-</span><span class="n">val</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">is</span><span class="p">.</span><span class="n">putback</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">putb</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Bint</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">Bint</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">val</span><span class="p">)</span>
		<span class="n">putb</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="n">val</span> <span class="o">/</span> <span class="mi">10</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">os</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="n">to_ulong</span><span class="p">()</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">+</span> <span class="sc">'0'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

  
  <h1>
    <a href="/posts/acm/template/C++%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3">
      C++语言相关
    </a>
  </h1>
  <h2 id="gcc内置位运算">GCC内置位运算</h2>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">__builtin_clz</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">x</span><span class="p">);</span>      <span class="c1">//求前缀0的个数
</span><span class="kt">int</span> <span class="n">__builtin_ctz</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">x</span><span class="p">);</span>      <span class="c1">//求后缀0的个数
</span><span class="kt">int</span> <span class="n">__builtin_ffs</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">x</span><span class="p">);</span>      <span class="c1">//x的二进制末尾最后一个1的位置，从1开始
</span><span class="kt">int</span> <span class="n">__builtin_popcount</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">x</span><span class="p">);</span> <span class="c1">//x二进制中1的个数，相当于bitset::count()
</span><span class="kt">int</span> <span class="n">__builtin_parity</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">x</span><span class="p">);</span>   <span class="c1">//判断x的二进制中1的个数的奇（1）偶（0）性，这些函数都有相应的usigned long和usigned long long版本，只需要在函数名后面加上l或ll就可以了，比如__builtin_clzll
</span></code></pre></div></div>
<h2 id="开栈">开栈</h2>
<h3 id="for-c">For C++</h3>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#pragma comment(linker, "/STACK:102400000,102400000") //For C++
</span></code></pre></div></div>
<h3 id="for-g">For G++</h3>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="c1">//For G++
</span><span class="p">{</span>
	<span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">256</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">;</span> <span class="c1">//256MB
</span>	<span class="kt">char</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="n">size</span><span class="p">;</span>
	<span class="n">__asm__</span> <span class="n">__volatile__</span><span class="p">(</span><span class="s">"movq %0, %%rsp</span><span class="se">\n</span><span class="s">"</span> <span class="o">::</span><span class="s">"r"</span><span class="p">(</span><span class="n">p</span><span class="p">));</span> <span class="c1">//64bit，一定要最后写一句`exit(0);`退出程序，否则会得到非零退出的错误，可能RE。
</span><span class="p">}</span>
</code></pre></div></div>
<h2 id="读入优化">读入优化</h2>
<h3 id="c文件指针版">C文件指针版</h3>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ll</span> <span class="nf">getll</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">in</span> <span class="o">=</span> <span class="n">stdin</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sgn</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">in</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(;</span> <span class="o">!</span><span class="n">isdigit</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">ch</span> <span class="o">!=</span> <span class="n">EOF</span><span class="p">;</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">in</span><span class="p">))</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="sc">'-'</span><span class="p">)</span>
			<span class="n">sgn</span> <span class="o">=</span> <span class="o">-</span><span class="n">sgn</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(;</span> <span class="n">isdigit</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">in</span><span class="p">))</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">ch</span> <span class="o">-</span> <span class="sc">'0'</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">ungetc</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="n">in</span><span class="p">),</span> <span class="n">sgn</span> <span class="o">*</span> <span class="n">val</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">lf</span> <span class="nf">getlf</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">in</span> <span class="o">=</span> <span class="n">stdin</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">val</span> <span class="o">=</span> <span class="n">getll</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="n">p</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">ll</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">in</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="sc">'.'</span><span class="p">)</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">ch</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">in</span><span class="p">);</span> <span class="n">isdigit</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">in</span><span class="p">))</span>
			<span class="n">val</span> <span class="o">+=</span> <span class="p">(</span><span class="n">p</span> <span class="o">/=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ch</span> <span class="o">-</span> <span class="sc">'0'</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ungetc</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="n">in</span><span class="p">),</span> <span class="n">val</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<h3 id="仿cio流沙雕版">仿C++IO流沙雕版</h3>
<p><a href="https://vjudge.net/solution/14388745">使用前</a></p>

<p><a href="https://vjudge.net/solution/14388713">使用后</a></p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define cin kin
</span><span class="k">struct</span> <span class="n">Istream</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">b</span><span class="p">[</span><span class="mi">20</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">],</span> <span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">e</span><span class="p">;</span> <span class="c1">//20MB
</span>	<span class="n">Istream</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">in</span><span class="p">)</span> <span class="o">:</span> <span class="n">i</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">e</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">fread</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">b</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">in</span><span class="p">))</span> <span class="p">{}</span>
	<span class="kt">bool</span> <span class="n">eof</span><span class="p">()</span> <span class="k">const</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="n">i</span> <span class="o">==</span> <span class="n">e</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">Istream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="n">val</span> <span class="o">=</span> <span class="n">strtoll</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i</span><span class="p">,</span> <span class="mi">10</span> <span class="cm">/*进制，取值2~36*/</span><span class="p">),</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">Istream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">ll</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">)</span> <span class="c1">//极限快
</span>	<span class="p">{</span>
		<span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">i</span> <span class="o">&lt;</span> <span class="sc">'0'</span><span class="p">)</span>
			<span class="o">++</span><span class="n">i</span><span class="p">;</span> <span class="c1">//无符号
</span>		<span class="k">for</span> <span class="p">(</span><span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">*</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="sc">'0'</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="o">*</span><span class="n">i</span> <span class="o">-</span> <span class="sc">'0'</span><span class="p">;</span>
		<span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">Istream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="kt">double</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="n">val</span> <span class="o">=</span> <span class="n">strtod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i</span><span class="p">),</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">Istream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">eof</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">isspace</span><span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">))</span>
			<span class="o">++</span><span class="n">i</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span> <span class="o">!</span><span class="n">eof</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">isspace</span><span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">);</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">s</span> <span class="o">+=</span> <span class="o">*</span><span class="n">i</span><span class="p">;</span>
		<span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span> <span class="n">kin</span><span class="p">(</span><span class="n">stdin</span><span class="p">);</span>
</code></pre></div></div>

  
  <script src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
  <script src="/public/js/katex.js"></script>
</body>

</html>
