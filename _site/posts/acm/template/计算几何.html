<!DOCTYPE html>

<head>
  <title>
    计算几何 &middot; wu-kan
  </title>
  
  <meta name="viewport"  content="width=device-width, initial-scale=1.0, maximum-scale=1"  />
  
  <meta http-equiv="X-UA-Compatible"  content="IE=edge"  />
  
  <meta http-equiv="content-type"  content="text/html; charset=utf-8"  />
  
  <meta name="google-site-verification"  content="YIKi1rBnyUaS-DMYiluseI5kZzTwjCkTFmKkSkMZDJk"  />
  
  <meta name="baidu-site-verification"  content="bEFDJ1LvXb"  />
  
  <meta name="yandex-verification"  content="52253e02830b443c"  />
  
  <link rel="profile"  href="//gmpg.org/xfn/11"  />
  
  <link rel="alternate"  href="/atom.xml"  title="RSS"  type="application/rss+xml"  />
  
  <link rel="apple-touch-icon-precomposed"  href="//www.gravatar.com/avatar/a12c5fff23dde00df79af9aca4e7b6e4?d=wavatar&s=144"  />
  
  <link rel="shortcut icon"  href="//www.gravatar.com/avatar/a12c5fff23dde00df79af9aca4e7b6e4?d=wavatar&s=32"  />
  
  <link rel="stylesheet"  href="//cdn.jsdelivr.net/gh/wu-kan/wu-kan.github.io/public/css/poole.css"  />
  
  <link rel="stylesheet"  href="//cdn.jsdelivr.net/gh/wu-kan/wu-kan.github.io/public/css/syntax.css"  />
  
  <link rel="stylesheet"  href="//cdn.jsdelivr.net/gh/wu-kan/wu-kan.github.io/public/css/lanyon.css"  />
  
  <link rel="stylesheet"  href="/public/css/wu-kan.css"  />
  
  <link rel="stylesheet"  href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.css"  />
  
</head>

<body
  class="theme-base-0d layout-reverse sidebar-overlay">
  
  <script  src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js" >
  </script>
  
  <script  src="//cdn.jsdelivr.net/npm/ribbon.js/dist/ribbon.min.js" >
  </script>
  
  <script  src="//cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget/autoload.js" >
  </script>
  
  <script  src="/public/js/prism.js" >
  </script>
  
  <script  src="/public/js/mermaid.js"  js="//cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"  stylesheet="//cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.css"  markdown_expand="true" >
  </script>
  
  <script  src="/public/js/katex.js"  js="//cdn.jsdelivr.net/npm/katex/dist/katex.min.js"  auto_render="//cdn.jsdelivr.net/npm/katex/dist/contrib/auto-render.min.js"  stylesheet="//cdn.jsdelivr.net/npm/katex/dist/katex.min.css"  delimiters="true" >
  </script>
  
  <script  src="/public/js/baidu_push.js" >
  </script>
  
  <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
  <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox" />
  <!-- Toggleable sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-item">
      
      <div class="ih-item circle effect right_to_left">
        <a class="blog-button" title="WuK">
          <img class="img" src="//www.gravatar.com/avatar/a12c5fff23dde00df79af9aca4e7b6e4?d=wavatar&s=600" alt="img" />
          <small class="info info-back">
            <br/>SYSU17级在读<br/>计科超算方向<br/>永远喜欢水野爱<br/>田宫例四驱车<br/>ACM&ASC
          </small>
        </a>
      </div>
      
      <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=100% height=52 src="//music.163.com/outchain/player?type=0&id=155059595&auto=0&height=32"></iframe>
      <div class="sidebar-social">
        
        <a href="/atom.xml" title="rss">
          <i class="fas fa-rss fa-fw"></i>
        </a>
        
        <a href="mailto:wu.kan@foxmail.com" title="wu.kan@foxmail.com">
          <i class="fas fa-envelope fa-fw"></i>
        </a>
        
        <a href="//codeforces.com/profile/WuK" title="WuK">
          <i class="fas fa-chart-bar fw"></i>
        </a>
        
        <a href="//vjudge.net/user/WuK" title="WuK">
          <i class="fas fa-smile fa-fw"></i>
        </a>
        
        <a href="" title="942759535">
          <i class="fab fa-qq fa-fw"></i>
        </a>
        
        <a href="" title="Wu-_-Kan">
          <i class="fab fa-weixin fa-fw"></i>
        </a>
        
        <a href="//github.com/wu-kan" title="github">
          <i class="fab fa-github fa-fw"></i>
        </a>
        
        <a href="//www.zhihu.com/people/wu.kan/activities" title="zhihu">
          <i class="fab fa-zhihu fa-fw"></i>
        </a>
        
      </div>
    </div>
    <nav class="sidebar-nav">
      
      <a class="sidebar-nav-item" href="/">
        <i class="fas fa-home fa-fw"></i> 首页
      </a>
      
      <a class="sidebar-nav-item" href="/about">
        <i class="fab fa-readme fa-fw"></i> 关于
      </a>
      
      <a class="sidebar-nav-item" href="/comments">
        <i class="fas fa-comments fa-fw"></i> 留言
      </a>
      
      <a class="sidebar-nav-item" href="/tags">
        <i class="fas fa-tags fa-fw"></i> 标签
      </a>
      
      <a class="sidebar-nav-item" href="/archive">
        <i class="fas fa-archive fa-fw"></i> 归档
      </a>
      
    </nav>
    <div class="sidebar-item">
      
      <div>
        <script src="/public/simple-jekyll-search/autoloader.js"></script>
      </div>
      
      
      <div>
        <script src="/public/js/jekyll_table_of_contents.js"></script>
      </div>
      
      
      <div>
        <script src="/public/js/run_time.js"></script>
      </div>
      
      
      <div>
        <i class="fas fa-eye fa-fw"></i>
        <span id="busuanzi_value_page_pv"></span>次
      </div>
      <div>
        <i class="fas fa-paw fa-fw"></i>
        <span id="busuanzi_value_site_pv"></span>枚
      </div>
      <div>
        <i class="fas fa-user-friends fa-fw"></i>
        <span id="busuanzi_value_site_uv"></span>人
      </div>
      <script src="//cdn.jsdelivr.net/npm/busuanzi/bsz.pure.mini.js"></script>
      
      
      <div>
        <i class="fas fa-user-edit fa-fw"></i>
        2019-11-09 17:38:24
      </div>
      
      
      <div>
        <i class="fas fa-copyright fa-fw"></i>
        2019
        WuK
        <script async defer src="https://buttons.github.io/buttons.js"></script><a class="github-button" aria-label="Star wu-kan/wu-kan.github.io on GitHub" href="https://github.com/wu-kan/wu-kan.github.io" data-icon="octicon-star" data-show-count="true">Star</a>
      </div>
      
    </div>
  </div>
  <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
  <div class="wrap">
    <h1 class="masthead masthead-title">
      <div class="container">
        计算几何
        <a href="/">
          <small>wu-kan</small>
        </a>
      </div>
    </h1>
    <div class="container content">
      <div class="post">
  
  <small class="post-date">
    
    <i class="fas fa-calendar-day"></i>
    27 Jan 2019
    
    
    <i class="fas fa-file-word"></i>
    15825字
    
    
    <i class="fas fa-coffee"></i>
    53分
    
    
    <span id="/posts/acm/template/%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95" class="leancloud-visitors" data-flag-title="计算几何">
      <i class="far fa-eye"></i>
      <span class="leancloud-visitors-count"></span>次
    </span>
    
    
    <i class="fas fa-tag"></i>
    ICPC模板
    
    </br>
    <i class="fab fa-creative-commons"></i> <a rel="license" href="//creativecommons.org/licenses/by-sa/4.0/deed.zh">BY-SA 4.0</a>（除特别声明或转载文章外）
  </small>
  
  
  <div class="post-content">
    <h2 id="二维">二维</h2>

<p>点和向量化为坐标Coord进行运算，使用stl中的complex实现。</p>

<p>复数相乘的几何意义为长度相乘，极角相加。</p>

<p>用直线上的一点p和方向向量v表示一条经过p的直线，直线上的所有点q满足q=p+t*v，其中t是参数；当限制t≥0时，该参数方程表示射线；限制0≤t≤1时，该参数方程表示线段。</p>

<p>此外，如果已知线段端点a1和a2，可以通过Line(a1,a2-a1)来得到对应的参数形式。</p>

<p>Morley定理：三角形每个内角的三等分线相交成等边三角形。</p>

<p>欧拉定理：平面图的点数V、边数E和面数F满足V+F-E=2。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="kt">double</span> <span class="n">lf</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">complex</span><span class="o">&lt;</span><span class="n">lf</span><span class="o">&gt;</span> <span class="n">Coord</span><span class="p">;</span>
<span class="k">const</span> <span class="n">lf</span> <span class="n">EPS</span> <span class="o">=</span> <span class="mf">1e-9</span><span class="p">;</span>
<span class="cp">#define X real()
#define Y imag()
</span><span class="k">struct</span> <span class="n">Line</span>
<span class="p">{</span>
	<span class="n">Coord</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
	<span class="n">Line</span><span class="p">(</span><span class="n">Coord</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Coord</span><span class="p">(),</span> <span class="n">Coord</span> <span class="n">v</span> <span class="o">=</span> <span class="n">Coord</span><span class="p">())</span> <span class="o">:</span> <span class="n">p</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">v</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">{}</span>
	<span class="n">Coord</span> <span class="n">point</span><span class="p">(</span><span class="n">lf</span> <span class="n">t</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">p</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span> <span class="n">t</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="n">Circle</span>
<span class="p">{</span>
	<span class="n">Coord</span> <span class="n">c</span><span class="p">;</span>
	<span class="n">lf</span> <span class="n">r</span><span class="p">;</span>
	<span class="n">Circle</span><span class="p">(</span><span class="n">Coord</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Coord</span><span class="p">(),</span> <span class="n">lf</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="n">c</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">r</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">{}</span>
	<span class="n">Coord</span> <span class="n">point</span><span class="p">(</span><span class="n">lf</span> <span class="n">t</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">c</span> <span class="o">+</span> <span class="n">polar</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//t为参数，幅角
</span><span class="p">};</span>
<span class="cm">/*
Coord(lf x=0,lf y=0);//构造函数
lf real(Coord a);//a的实部（复平面的横坐标）,也可写作a.real()
lf imag(Coord a);//a的虚部（复平面的纵坐标）,也可写作a.imag()

lf abs(Coord a);//向量a的模长，或是点a到原点的距离
lf norm(Coord a);//abs的平方，比abs快，但是要注意浮点数精度溢出

lf arg(Coord a);//a的幅角，与atan2(a.real(),a.imag())等价
Coord polar(lf r,lf t);//极坐标生成方式，r为幅值，t为幅角

//运算符重载+、-、*、/（以及对应的赋值运算，但是赋值运算不能写在表达式中，详见参考地址）、&lt;&lt;、&gt;&gt;（输出括号形式的坐标）
*/</span>
<span class="kt">int</span> <span class="nf">sgn</span><span class="p">(</span><span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">EPS</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">EPS</span><span class="p">);</span> <span class="p">}</span>

<span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span><span class="p">)</span> <span class="o">||</span> <span class="n">sgn</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//不等运算符，涉及到浮点数比较要重写
</span>
<span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">A</span> <span class="o">!=</span> <span class="n">B</span><span class="p">);</span> <span class="p">}</span>

<span class="kt">bool</span> <span class="n">cmpCoord</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span><span class="p">)</span> <span class="o">?</span> <span class="n">sgn</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">sgn</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//复数没有小于运算，只能这样定义一个比较函数
</span>
<span class="kt">bool</span> <span class="n">cmpLine</span><span class="p">(</span><span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="n">arg</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">v</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//按极角排序，求凸包中使用
</span>
<span class="n">lf</span> <span class="n">Dot</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span> <span class="o">+</span> <span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span> <span class="p">}</span>

<span class="n">lf</span> <span class="n">Cross</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">A</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span> <span class="p">}</span>

<span class="n">lf</span> <span class="n">Angle</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">acos</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">B</span><span class="p">));</span> <span class="p">}</span>

<span class="n">lf</span> <span class="n">Area2</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Cross</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//三角形ABC有向面积的两倍
</span>
<span class="n">Coord</span> <span class="n">Rotate</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="n">lf</span> <span class="n">rad</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">polar</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">rad</span><span class="p">);}</span> <span class="c1">//向量A逆时针旋转rad弧度
</span>
<span class="n">Coord</span> <span class="n">Normal</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">)</span> <span class="c1">//A的法向量，把A逆时针旋转九十度并长度化为1
</span><span class="p">{</span>
	<span class="n">lf</span> <span class="n">L</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">A</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Coord</span><span class="p">(</span><span class="o">-</span><span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">/</span> <span class="n">L</span><span class="p">,</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">/</span> <span class="n">L</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">onLeft</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">P</span> <span class="o">-</span> <span class="n">L</span><span class="p">.</span><span class="n">p</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//p是否在有向直线L左侧，不含线上
</span>
<span class="n">lf</span> <span class="n">DistanceToLine</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Cross</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">P</span> <span class="o">-</span> <span class="n">L</span><span class="p">.</span><span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//点到直线距离（有向）
</span>
<span class="n">lf</span> <span class="n">DistanceToLine</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">));</span> <span class="p">}</span>

<span class="n">lf</span> <span class="n">DistanceToSegment</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="c1">//点到线段的距离（无向）
</span><span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">A</span> <span class="o">==</span> <span class="n">B</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">P</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span>
	<span class="n">Coord</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">v3</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">B</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">v2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v3</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">v3</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">DistanceToLine</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">)));</span>
<span class="p">}</span>

<span class="n">Coord</span> <span class="n">getLineProjection</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">L</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">P</span> <span class="o">-</span> <span class="n">L</span><span class="p">.</span><span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">));</span> <span class="p">}</span> <span class="c1">//点在直线上的投影
</span>
<span class="n">Coord</span> <span class="n">getLineProjection</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">getLineProjection</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">));</span> <span class="p">}</span>

<span class="n">Coord</span> <span class="n">getSymmetry</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">O</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">O</span> <span class="o">+</span> <span class="n">O</span> <span class="o">-</span> <span class="n">P</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//P关于O的对称点
</span>
<span class="n">Coord</span> <span class="n">getSymmetry</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">getSymmetry</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">getLineProjection</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">L</span><span class="p">));</span> <span class="p">}</span> <span class="c1">//P关于L的对称点
</span>
<span class="n">Coord</span> <span class="n">getLineIntersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L2</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">L1</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">L2</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">L1</span><span class="p">.</span><span class="n">p</span> <span class="o">-</span> <span class="n">L2</span><span class="p">.</span><span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">Cross</span><span class="p">(</span><span class="n">L1</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">L2</span><span class="p">.</span><span class="n">v</span><span class="p">));</span> <span class="p">}</span> <span class="c1">//直线交点,须确保两直线相交
</span>
<span class="n">Coord</span> <span class="n">getLineIntersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A2</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B2</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">getLineIntersection</span><span class="p">(</span><span class="n">Line</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span> <span class="o">-</span> <span class="n">A1</span><span class="p">),</span> <span class="n">Line</span><span class="p">(</span><span class="n">B1</span><span class="p">,</span> <span class="n">B2</span> <span class="o">-</span> <span class="n">B1</span><span class="p">));</span> <span class="p">}</span>

<span class="kt">bool</span> <span class="n">SegmentProperIntersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A2</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B2</span><span class="p">)</span> <span class="c1">//线段相交判定，交点不在一条线段的端点
</span><span class="p">{</span>
	<span class="n">lf</span> <span class="n">C1</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">A2</span> <span class="o">-</span> <span class="n">A1</span><span class="p">,</span> <span class="n">B1</span> <span class="o">-</span> <span class="n">A1</span><span class="p">),</span> <span class="n">C2</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">A2</span> <span class="o">-</span> <span class="n">A1</span><span class="p">,</span> <span class="n">B2</span> <span class="o">-</span> <span class="n">A1</span><span class="p">),</span>
	   <span class="n">C3</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">B2</span> <span class="o">-</span> <span class="n">B1</span><span class="p">,</span> <span class="n">A1</span> <span class="o">-</span> <span class="n">B1</span><span class="p">),</span> <span class="n">C4</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">B2</span> <span class="o">-</span> <span class="n">B1</span><span class="p">,</span> <span class="n">A2</span> <span class="o">-</span> <span class="n">B1</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">C1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgn</span><span class="p">(</span><span class="n">C2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">C3</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgn</span><span class="p">(</span><span class="n">C4</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">onSegment</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A2</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">A1</span> <span class="o">-</span> <span class="n">P</span><span class="p">,</span> <span class="n">A2</span> <span class="o">-</span> <span class="n">P</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">A1</span> <span class="o">-</span> <span class="n">P</span><span class="p">,</span> <span class="n">A2</span> <span class="o">-</span> <span class="n">P</span><span class="p">));</span> <span class="p">}</span> <span class="c1">//判断点是否在线段上，不包含端点
</span>
<span class="n">lf</span> <span class="n">PolygonArea</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">)</span> <span class="c1">//计算多边形的有向面积，凸多边形即为面积
</span><span class="p">{</span>
	<span class="n">lf</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="n">s</span> <span class="o">+=</span> <span class="n">Area2</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="k">return</span> <span class="n">s</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">inPolygon</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">,</span> <span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">poly</span><span class="p">)</span> <span class="c1">//点在多边形内的判定，转角法，正值为内部，0为外部，-1在边界上
</span><span class="p">{</span>
	<span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">poly</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">onSegment</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">poly</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">]))</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">//在边界上
</span>		<span class="n">k</span> <span class="o">=</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">poly</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span> <span class="o">-</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
		<span class="n">d1</span> <span class="o">=</span> <span class="n">sgn</span><span class="p">(</span><span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Y</span> <span class="o">-</span> <span class="n">p</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
		<span class="n">d2</span> <span class="o">=</span> <span class="n">sgn</span><span class="p">(</span><span class="n">poly</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">].</span><span class="n">Y</span> <span class="o">-</span> <span class="n">p</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">d1</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">d2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="o">++</span><span class="n">ans</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">d2</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">d1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="o">--</span><span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">ConvexHull</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">collineation</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">//获得凸包，不希望凸包的边上有输入点第二个参数传0
</span><span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">ans</span><span class="p">;</span>
	<span class="n">sort</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">p</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">cmpCoord</span><span class="p">);</span> <span class="c1">//先比横坐标再比纵坐标
</span>	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>  <span class="c1">//求出下凸包
</span>	<span class="p">{</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Area2</span><span class="p">(</span><span class="n">ans</span><span class="p">[</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">],</span> <span class="n">ans</span><span class="p">[</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="n">collineation</span><span class="p">)</span>
			<span class="n">ans</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
		<span class="n">ans</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span> <span class="c1">//求出上凸包
</span>	<span class="p">{</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">k</span> <span class="o">&amp;&amp;</span> <span class="o">-</span><span class="n">sgn</span><span class="p">(</span><span class="n">Area2</span><span class="p">(</span><span class="n">ans</span><span class="p">[</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ans</span><span class="p">[</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="n">collineation</span><span class="p">)</span>
			<span class="n">ans</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
		<span class="n">ans</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">ans</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">cutPolygon</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">poly</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="c1">//用有向直线A-&gt;B切割多边形poly， 返回“左侧”。 如果退化，可能会返回一个单点或者线段，复杂度O(n^2)
</span><span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">newpoly</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">poly</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Coord</span> <span class="n">C</span> <span class="o">=</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">D</span> <span class="o">=</span> <span class="n">poly</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">A</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">newpoly</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">C</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">D</span><span class="p">)))</span>
		<span class="p">{</span>
			<span class="n">Coord</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">getLineIntersection</span><span class="p">(</span><span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">),</span> <span class="n">Line</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span> <span class="o">-</span> <span class="n">C</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">onSegment</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">))</span>
				<span class="n">newpoly</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ip</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">newpoly</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">getHalfPlaneIntersection</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Line</span><span class="o">&gt;</span> <span class="n">L</span><span class="p">)</span> <span class="c1">//半平面交
</span><span class="p">{</span>
	<span class="n">sort</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">L</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">cmpLine</span><span class="p">);</span>  <span class="c1">//按极角排序
</span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">Coord</span><span class="p">());</span> <span class="c1">//p[i]为q[i]和q[i+1]的交点
</span>	<span class="kt">int</span> <span class="n">first</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>			<span class="c1">//双端队列的第一个元素和最后一个元素
</span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Line</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">Line</span><span class="p">());</span>   <span class="c1">//双端队列
</span>	<span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>						<span class="c1">//队列初始化为只有一个半平面L[0]
</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">L</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">last</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">onLeft</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
			<span class="o">--</span><span class="n">last</span><span class="p">;</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">last</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">onLeft</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">first</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
			<span class="o">++</span><span class="n">first</span><span class="p">;</span>

		<span class="n">q</span><span class="p">[</span><span class="o">++</span><span class="n">last</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">last</span><span class="p">].</span><span class="n">v</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">v</span><span class="p">)))</span>
		<span class="p">{</span>
			<span class="o">--</span><span class="n">last</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">onLeft</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="n">last</span><span class="p">]))</span>
				<span class="n">q</span><span class="p">[</span><span class="n">last</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">last</span><span class="p">)</span>
			<span class="n">p</span><span class="p">[</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">getLineIntersection</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">last</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">last</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">onLeft</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">first</span><span class="p">]))</span>
		<span class="o">--</span><span class="n">last</span><span class="p">;</span> <span class="c1">//删除无用平面
</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span><span class="p">();</span> <span class="c1">//空集
</span>	<span class="n">p</span><span class="p">[</span><span class="n">last</span><span class="p">]</span> <span class="o">=</span> <span class="n">getLineIntersection</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">last</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">first</span><span class="p">]);</span>
	<span class="k">return</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">first</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">last</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">//从deque复制到输出中
</span><span class="p">}</span>

<span class="kt">int</span> <span class="n">getLineCircleIntersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">,</span> <span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">sol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">a</span> <span class="o">=</span> <span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">.</span><span class="n">X</span><span class="p">,</span>
	   <span class="n">b</span> <span class="o">=</span> <span class="n">L</span><span class="p">.</span><span class="n">p</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">.</span><span class="n">X</span><span class="p">,</span>
	   <span class="n">c</span> <span class="o">=</span> <span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span>
	   <span class="n">d</span> <span class="o">=</span> <span class="n">L</span><span class="p">.</span><span class="n">p</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span>
	   <span class="n">e</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">c</span><span class="p">,</span>
	   <span class="n">f</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">d</span><span class="p">),</span>
	   <span class="n">g</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">,</span>
	   <span class="n">delta</span> <span class="o">=</span> <span class="n">f</span> <span class="o">*</span> <span class="n">f</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">e</span> <span class="o">*</span> <span class="n">g</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">delta</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="o">-</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">e</span><span class="p">))),</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">point</span><span class="p">((</span><span class="o">-</span><span class="n">f</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">delta</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">e</span><span class="p">)));</span>
	<span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">point</span><span class="p">((</span><span class="o">-</span><span class="n">f</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">delta</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">e</span><span class="p">)));</span>
	<span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">getCircleIntersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C2</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">sol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">C1</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">C2</span><span class="p">.</span><span class="n">c</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">C2</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">//重合返回-1
</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">+</span> <span class="n">C2</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">sgn</span><span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">C2</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">//外离或内含
</span>		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">lf</span> <span class="n">a</span> <span class="o">=</span> <span class="n">arg</span><span class="p">(</span><span class="n">C2</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">C1</span><span class="p">.</span><span class="n">c</span><span class="p">),</span>
	   <span class="n">da</span> <span class="o">=</span> <span class="n">acos</span><span class="p">((</span><span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="n">C2</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C2</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">d</span><span class="p">));</span>

	<span class="n">Coord</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">C1</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">da</span><span class="p">),</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">C1</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">da</span><span class="p">);</span>

	<span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">p1</span> <span class="o">==</span> <span class="n">p2</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//相切
</span>	<span class="k">return</span> <span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p2</span><span class="p">),</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Line</span> <span class="n">getTangent</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Line</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Normal</span><span class="p">(</span><span class="n">C</span> <span class="o">-</span> <span class="n">P</span><span class="p">));</span> <span class="p">}</span> <span class="c1">//圆心C，圆上一点P处切线
</span>
<span class="kt">int</span> <span class="n">getTangents</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">,</span> <span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">sol</span><span class="p">)</span> <span class="c1">//点到圆的切点，返回个数
</span><span class="p">{</span>
	<span class="n">Coord</span> <span class="n">u</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">;</span>
	<span class="n">lf</span> <span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>	  <span class="c1">//点在圆内
</span>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">))</span> <span class="c1">//点在圆上
</span>		<span class="k">return</span> <span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">lf</span> <span class="n">base</span> <span class="o">=</span> <span class="n">arg</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">ang</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">/</span> <span class="n">d</span><span class="p">);</span>
	<span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">C</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ang</span><span class="p">));</span>
	<span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">C</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="n">ang</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">getTangents</span><span class="p">(</span><span class="n">Circle</span> <span class="n">A</span><span class="p">,</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="c1">//公共切线的切点
</span><span class="p">{</span>
	<span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">r</span> <span class="o">&lt;</span> <span class="n">B</span><span class="p">.</span><span class="n">r</span><span class="p">)</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">),</span> <span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span> <span class="c1">//有时需标记交换
</span>
	<span class="n">lf</span> <span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">c</span><span class="p">),</span>
	   <span class="n">rdiff</span> <span class="o">=</span> <span class="n">A</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">r</span><span class="p">,</span>
	   <span class="n">rsum</span> <span class="o">=</span> <span class="n">A</span><span class="p">.</span><span class="n">r</span> <span class="o">+</span> <span class="n">B</span><span class="p">.</span><span class="n">r</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">rdiff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//内含
</span>
	<span class="n">lf</span> <span class="n">base</span> <span class="o">=</span> <span class="n">arg</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">A</span><span class="p">.</span><span class="n">c</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">rdiff</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">//重合，无穷多条切线
</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">rdiff</span><span class="p">))</span> <span class="c1">//内切，外公切线
</span>	<span class="p">{</span>
		<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span><span class="p">));</span>
		<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span><span class="p">));</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="c1">//有外公切线的情形
</span>	<span class="n">lf</span> <span class="n">ang</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="n">rdiff</span> <span class="o">/</span> <span class="n">d</span><span class="p">);</span>
	<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ang</span><span class="p">));</span>
	<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ang</span><span class="p">));</span>
	<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="n">ang</span><span class="p">));</span>
	<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="n">ang</span><span class="p">));</span>
	<span class="n">cnt</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">rsum</span><span class="p">))</span>
	<span class="p">{</span>
		<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span><span class="p">));</span>
		<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">M_PI</span><span class="p">));</span>
		<span class="o">++</span><span class="n">cnt</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">rsum</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">lf</span> <span class="n">ang_in</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="n">rsum</span> <span class="o">/</span> <span class="n">d</span><span class="p">);</span>
		<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ang_in</span><span class="p">));</span>
		<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ang_in</span> <span class="o">+</span> <span class="n">M_PI</span><span class="p">));</span>
		<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="n">ang_in</span><span class="p">));</span>
		<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="n">ang_in</span> <span class="o">+</span> <span class="n">M_PI</span><span class="p">));</span>
		<span class="n">cnt</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">cnt</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">lf</span> <span class="n">AreaCircleWithTriangle</span><span class="p">(</span><span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="n">Coord</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord</span> <span class="n">B</span><span class="p">)</span> <span class="c1">//C和三角形OAB的相交面积，如果三角形顶点不在O上则把圆和三角形同时平移，直到有一个顶点在O上
</span><span class="p">{</span>
	<span class="kt">int</span> <span class="n">sg</span> <span class="o">=</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sg</span> <span class="o">||</span> <span class="n">A</span> <span class="o">==</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span> <span class="o">||</span> <span class="n">B</span> <span class="o">==</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">lf</span> <span class="n">OA</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">),</span> <span class="n">OB</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">),</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">),</span>
	   <span class="n">d</span> <span class="o">=</span> <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">Coord</span><span class="p">(),</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">OA</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">OB</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">Cross</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">OA</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">OB</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">sg</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">angle</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">OA</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">OB</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Coord</span> <span class="n">prj</span> <span class="o">=</span> <span class="n">getLineProjection</span><span class="p">(</span><span class="n">Coord</span><span class="p">(),</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">onSegment</span><span class="p">(</span><span class="n">prj</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">))</span>
			<span class="k">return</span> <span class="n">sg</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">angle</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

		<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">;</span>
		<span class="n">Line</span> <span class="n">L</span> <span class="o">=</span> <span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span>
		<span class="n">getLineCircleIntersection</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>

		<span class="n">lf</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">angle</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
		   <span class="n">s2</span> <span class="o">=</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">Angle</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">s2</span> <span class="o">-=</span> <span class="n">fabs</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">s1</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">-</span> <span class="n">s2</span><span class="p">;</span>

		<span class="k">return</span> <span class="n">sg</span> <span class="o">*</span> <span class="n">s1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">OB</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>

	<span class="n">Line</span> <span class="n">L</span> <span class="o">=</span> <span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">inter</span><span class="p">;</span>
	<span class="n">getLineCircleIntersection</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">inter</span><span class="p">);</span>
	<span class="n">Coord</span> <span class="n">inter_point</span> <span class="o">=</span> <span class="n">inter</span><span class="p">[</span><span class="o">!</span><span class="n">onSegment</span><span class="p">(</span><span class="n">inter</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)];</span>

	<span class="n">lf</span> <span class="n">s</span> <span class="o">=</span> <span class="n">fabs</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">inter_point</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">s</span> <span class="o">+=</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">Angle</span><span class="p">(</span><span class="n">inter_point</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">s</span> <span class="o">*</span> <span class="n">sg</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">lf</span> <span class="n">AreaCircleWithPolygon</span><span class="p">(</span><span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="n">ans</span> <span class="o">+=</span> <span class="n">AreaCircleWithTriangle</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()]);</span>
	<span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">ans</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">Coord</span> <span class="n">getGravityCenter</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">)</span> <span class="c1">//多边形重心
</span><span class="p">{</span>
	<span class="n">Coord</span> <span class="n">a</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lf</span> <span class="n">am</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mj</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">mj</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()]);</span>
		<span class="n">a</span> <span class="o">+=</span> <span class="n">mj</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()]);</span>
		<span class="n">am</span> <span class="o">+=</span> <span class="n">mj</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">am</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="三维">三维</h2>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="kt">double</span> <span class="n">lf</span><span class="p">;</span>
<span class="k">const</span> <span class="n">lf</span> <span class="n">EPS</span> <span class="o">=</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="n">INF</span> <span class="o">=</span> <span class="mf">1e9</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">sgn</span><span class="p">(</span><span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">EPS</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">EPS</span><span class="p">);</span> <span class="p">}</span>
<span class="k">struct</span> <span class="n">Coord3</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">;</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">X</span><span class="p">)</span> <span class="o">||</span> <span class="n">sgn</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span> <span class="o">||</span> <span class="n">sgn</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">Z</span><span class="p">);</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">);</span> <span class="p">}</span>
	<span class="n">Coord3</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">+=</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">X</span> <span class="o">+=</span> <span class="n">b</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">+=</span> <span class="n">b</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">+=</span> <span class="n">b</span><span class="p">.</span><span class="n">Z</span><span class="p">,</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">+=</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Coord3</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">-=</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">X</span> <span class="o">-=</span> <span class="n">b</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">-=</span> <span class="n">b</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">-=</span> <span class="n">b</span><span class="p">.</span><span class="n">Z</span><span class="p">,</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">-=</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Coord3</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">*=</span><span class="p">(</span><span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">X</span> <span class="o">*=</span> <span class="n">d</span><span class="p">,</span> <span class="n">Y</span> <span class="o">*=</span> <span class="n">d</span><span class="p">,</span> <span class="n">Z</span> <span class="o">*=</span> <span class="n">d</span><span class="p">,</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">a</span><span class="p">,</span> <span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">*=</span> <span class="n">d</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="n">lf</span> <span class="n">d</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">*=</span> <span class="n">d</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Coord3</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">/=</span><span class="p">(</span><span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">X</span> <span class="o">/=</span> <span class="n">d</span><span class="p">,</span> <span class="n">Y</span> <span class="o">/=</span> <span class="n">d</span><span class="p">,</span> <span class="n">Z</span> <span class="o">/=</span> <span class="n">d</span><span class="p">,</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="k">operator</span><span class="o">/</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">a</span><span class="p">,</span> <span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">/=</span> <span class="n">d</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">Dot</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span> <span class="o">+</span> <span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span> <span class="o">+</span> <span class="n">A</span><span class="p">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="n">Cross</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">{</span><span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">A</span><span class="p">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">A</span><span class="p">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span><span class="p">};</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">norm</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">A</span><span class="p">);</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">abs</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">A</span><span class="p">));</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">Angle</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">acos</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">B</span><span class="p">));</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">Area2</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">C</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">A</span><span class="p">));</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">Volume6</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">C</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">D</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Dot</span><span class="p">(</span><span class="n">D</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">Cross</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">A</span><span class="p">));</span> <span class="p">}</span>	 <span class="c1">//四面体体积
</span>	<span class="k">friend</span> <span class="n">Coord3</span> <span class="n">Centroid</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">C</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">D</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span><span class="p">)</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">;</span> <span class="p">}</span>		  <span class="c1">//四面体的重心
</span>	<span class="k">friend</span> <span class="n">lf</span> <span class="n">DistanceToPlane</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">p</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p0</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Dot</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">p0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">n</span><span class="p">);</span> <span class="p">}</span>		  <span class="c1">//点p到平面p0-n的有向距离
</span>	<span class="k">friend</span> <span class="n">Coord3</span> <span class="n">getPlaneProjection</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">p</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p0</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">p</span> <span class="o">-</span> <span class="n">n</span> <span class="o">*</span> <span class="n">Dot</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">p0</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//点p在平面p0-n上的投影。n必须为单位向量
</span>	<span class="k">friend</span> <span class="n">Coord3</span> <span class="n">LinePlaneIntersection</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">p1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p2</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p0</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">n</span><span class="p">)</span>							  <span class="c1">//直线p1-p2 与平面p0-n的交点，假设交点唯一存在
</span>	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">v</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span><span class="p">;</span>
		<span class="n">lf</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p0</span> <span class="o">-</span> <span class="n">p1</span><span class="p">)</span> <span class="o">/</span> <span class="n">Dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span><span class="p">);</span> <span class="c1">//分母为0，直线与平面平行或在平面上
</span>		<span class="k">return</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span> <span class="n">t</span><span class="p">;</span>						  <span class="c1">//如果是线段 判断t是否在0~1之间
</span>	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">P</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">)</span> <span class="c1">//点P到直线AB的距离
</span>	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">A</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">v1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">DistanceToSeg</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">P</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">)</span> <span class="c1">//点到线段的距离
</span>	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">A</span> <span class="o">==</span> <span class="n">B</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">P</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span>
		<span class="n">Coord3</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">v3</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">B</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">v2</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v3</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">v3</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">DistanceToLine</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">));</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">LineDistance3D</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">p1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">u</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p2</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">v</span><span class="p">,</span> <span class="n">lf</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="c1">//求异面直线 p1+s*u与p2+t*v的公垂线对应的s，如果平行|重合，返回0
</span>	<span class="p">{</span>
		<span class="n">lf</span> <span class="n">b</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="n">Dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">lf</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p2</span><span class="p">)</span> <span class="o">-</span> <span class="n">Dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p2</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">s</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">SameSide</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">p1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p2</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">a</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">a</span><span class="p">),</span> <span class="n">Cross</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">a</span><span class="p">)))</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//p1和p2是否在线段a-b的同侧
</span>	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">PointInTri</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">PP</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">P</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>																						 <span class="c1">//点P在三角形P0,P1,p中
</span>	<span class="p">{</span>
		<span class="k">return</span> <span class="n">SameSide</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;&amp;</span>
			   <span class="n">SameSide</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;&amp;</span>
			   <span class="n">SameSide</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">TriSegIntersection</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">P</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">,</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">PP</span><span class="p">)</span> <span class="c1">//三角形P0P1p是否和线段AB相交，如有则为PP
</span>	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">n</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>						 <span class="c1">//线段A-B和平面P0P1p平行或共面
</span>		<span class="n">lf</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">/</span> <span class="n">Dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span> <span class="c1">//平面A和直线P1-p有惟一交点
</span>		<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">sgn</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">//不在线段AB上
</span>		<span class="k">return</span> <span class="n">PointInTri</span><span class="p">(</span><span class="n">PP</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span> <span class="n">P</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">TriTriIntersection</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">T1</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">Coord3</span> <span class="n">T2</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="c1">//空间两三角形是否相交
</span>	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">P</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">TriSegIntersection</span><span class="p">(</span><span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">T2</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">],</span> <span class="n">P</span><span class="p">)</span> <span class="o">||</span>
				<span class="n">TriSegIntersection</span><span class="p">(</span><span class="n">T2</span><span class="p">,</span> <span class="n">T1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">T1</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">],</span> <span class="n">P</span><span class="p">))</span>
				<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">SegSegDistance</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">a1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">b1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">a2</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">b2</span><span class="p">,</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">ans1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">ans2</span><span class="p">)</span> <span class="c1">//空间两直线上最近点对 返回最近距离 点对保存在ans1 ans2中
</span>	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span> <span class="o">-</span> <span class="n">b1</span><span class="p">),</span> <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">a2</span> <span class="o">-</span> <span class="n">b2</span><span class="p">);</span>
		<span class="n">Coord3</span> <span class="n">N</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">);</span>
		<span class="n">Coord3</span> <span class="n">ab</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span> <span class="o">-</span> <span class="n">a2</span><span class="p">);</span>
		<span class="n">lf</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">ab</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>
		<span class="n">Coord3</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">b1</span> <span class="o">-</span> <span class="n">a1</span><span class="p">,</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">b2</span> <span class="o">-</span> <span class="n">a2</span><span class="p">,</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span>
		<span class="n">lf</span> <span class="n">nd</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">cd</span><span class="p">),</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">a2</span> <span class="o">-</span> <span class="n">a1</span><span class="p">,</span> <span class="n">d2</span><span class="p">),</span> <span class="n">cd</span><span class="p">)</span> <span class="o">/</span> <span class="n">nd</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">a2</span> <span class="o">-</span> <span class="n">a1</span><span class="p">,</span> <span class="n">d1</span><span class="p">),</span> <span class="n">cd</span><span class="p">)</span> <span class="o">/</span> <span class="n">nd</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">ans1</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">+</span> <span class="p">(</span><span class="n">b1</span> <span class="o">-</span> <span class="n">a1</span><span class="p">)</span> <span class="o">*</span> <span class="n">t1</span><span class="p">,</span> <span class="n">ans2</span> <span class="o">=</span> <span class="n">a2</span> <span class="o">+</span> <span class="p">(</span><span class="n">b2</span> <span class="o">-</span> <span class="n">a2</span><span class="p">)</span> <span class="o">*</span> <span class="n">t2</span><span class="p">,</span> <span class="n">fabs</span><span class="p">(</span><span class="n">ans</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">InsideWithMinDistance</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">PP</span><span class="p">,</span> <span class="n">Coord3</span> <span class="o">*</span><span class="n">P</span><span class="p">,</span> <span class="n">lf</span> <span class="n">dist</span><span class="p">)</span> <span class="c1">//判断PP是否在三角形P中，并且到三条边的距离都至少为dist。保证P,A,B,C共面
</span>	<span class="p">{</span>
		<span class="k">return</span> <span class="n">PointInTri</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
				   <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">dist</span> <span class="o">||</span>
			   <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">dist</span> <span class="o">||</span>
			   <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">dist</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">minBall</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord3</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="k">const</span> <span class="n">lf</span> <span class="n">eps</span> <span class="o">=</span> <span class="n">EPS</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">)</span> <span class="c1">//模拟退火求最小球覆盖，EPS玄学调整；返回半径
</span>	<span class="p">{</span>
		<span class="n">lf</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">Coord3</span> <span class="n">z</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">;</span> <span class="n">step</span> <span class="o">*=</span> <span class="mf">0.99</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">abs</span><span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
					<span class="n">s</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
			<span class="n">ans</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="n">abs</span><span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]));</span>
			<span class="n">z</span> <span class="o">-=</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="o">*</span> <span class="n">step</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="n">Sphere</span>
<span class="p">{</span>
	<span class="n">Coord3</span> <span class="n">o</span><span class="p">;</span>
	<span class="n">lf</span> <span class="n">r</span><span class="p">;</span>
	<span class="n">Coord3</span> <span class="n">point</span><span class="p">(</span><span class="n">lf</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lf</span> <span class="n">lng</span><span class="p">)</span> <span class="k">const</span> <span class="c1">//经纬度确定球面上一点
</span>	<span class="p">{</span>
		<span class="n">lat</span> <span class="o">*=</span> <span class="n">M_PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">;</span>
		<span class="n">lng</span> <span class="o">*=</span> <span class="n">M_PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">o</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">Coord3</span><span class="p">{</span><span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">lng</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">lng</span><span class="p">),</span> <span class="n">sin</span><span class="p">(</span><span class="n">lat</span><span class="p">)};</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="n">ConvexPolyhedron</span> <span class="c1">//空间多边形和凸包问题
</span><span class="p">{</span>
	<span class="k">struct</span> <span class="n">Face</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
		<span class="n">Face</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span> <span class="p">}</span>
		<span class="n">Coord3</span> <span class="n">Normal</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord3</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Cross</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">P</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="p">}</span>
		<span class="kt">bool</span> <span class="n">CanSee</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord3</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Dot</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">Normal</span><span class="p">(</span><span class="n">P</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//f是否能看见P[i]
</span>	<span class="p">};</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Face</span><span class="o">&gt;</span> <span class="n">faces</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord3</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">;</span>
	<span class="n">ConvexPolyhedron</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord3</span><span class="o">&gt;</span> <span class="n">P</span><span class="p">)</span> <span class="o">:</span> <span class="n">p</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Coord3</span><span class="p">{</span><span class="n">randEPS</span><span class="p">(),</span> <span class="n">randEPS</span><span class="p">(),</span> <span class="n">randEPS</span><span class="p">()};</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">vis</span><span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">size</span><span class="p">()));</span>
		<span class="n">faces</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Face</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span> <span class="c1">//由于已经进行扰动，前三个点不共线
</span>		<span class="n">faces</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Face</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">P</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">vector</span><span class="o">&lt;</span><span class="n">Face</span><span class="o">&gt;</span> <span class="n">next</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">faces</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="c1">//计算每条边的“左面”的可见性
</span>			<span class="p">{</span>
				<span class="n">Face</span> <span class="o">&amp;</span><span class="n">f</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
				<span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">CanSee</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">res</span><span class="p">)</span>
					<span class="n">next</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span>
					<span class="n">vis</span><span class="p">[</span><span class="n">f</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="n">f</span><span class="p">.</span><span class="n">v</span><span class="p">[(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="n">res</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">faces</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">b</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">v</span><span class="p">[(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">];</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">!=</span> <span class="n">vis</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="n">a</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">vis</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">])</span> <span class="c1">//(a,b)是分界线，左边对P[i]可见
</span>						<span class="n">next</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Face</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">i</span><span class="p">));</span>
				<span class="p">}</span>
			<span class="n">swap</span><span class="p">(</span><span class="n">faces</span><span class="p">,</span> <span class="n">next</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">lf</span> <span class="n">randEPS</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">rand</span><span class="p">()</span> <span class="o">/</span> <span class="n">lf</span><span class="p">(</span><span class="n">RAND_MAX</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">EPS</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Coord3</span> <span class="n">centroid</span><span class="p">()</span> <span class="c1">//三维凸包重心
</span>	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">C</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tot</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
		<span class="n">lf</span> <span class="n">totv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">faces</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">Coord3</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]];</span>
			<span class="n">lf</span> <span class="n">v</span> <span class="o">=</span> <span class="o">-</span><span class="n">Volume6</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">C</span><span class="p">);</span>
			<span class="n">totv</span> <span class="o">+=</span> <span class="n">v</span><span class="p">;</span>
			<span class="n">tot</span> <span class="o">+=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">Centroid</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">C</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">tot</span> <span class="o">/</span> <span class="n">totv</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">lf</span> <span class="n">dist</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">C</span><span class="p">)</span> <span class="c1">//凸包内一点到表面最近距离
</span>	<span class="p">{</span>
		<span class="n">lf</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">faces</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">Coord3</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]];</span>
			<span class="n">ans</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="n">fabs</span><span class="p">(</span><span class="o">-</span><span class="n">Volume6</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span> <span class="o">/</span> <span class="n">Area2</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)));</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

  </div>
  
  
  <div class="reward">
    <button id="rewardButton" disable="enable"
      onclick="var qr = document.getElementById('rewardQRs'); qr.style.display = (qr.style.display === 'block') ? 'none' : 'block';">
      如果我的博客帮助到你，可以请我喝一杯咖啡~
    </button>
    <div id="rewardQRs">
      <table>
        <tr>
          
          <td id="wechat" class="reward_qr">
            <img id="wechat_qr" src="/public/image/wechatpay.jpg" alt="WuKwechat">
          </td>
          
          <td id="alipay" class="reward_qr">
            <img id="alipay_qr" src="/public/image/alipay.jpg" alt="WuKalipay">
          </td>
          
        </tr>
      </table>
    </div>
  </div>
  
</div>


<script src="/public/js/valine.js"></script>


    </div>
  </div>
  <label for="sidebar-checkbox" class="sidebar-toggle fas fa-bars"></label>
</body>

</html>
